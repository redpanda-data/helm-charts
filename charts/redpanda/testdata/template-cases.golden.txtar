-- testdata/TestTemplate/01-default-values.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/02-one-node-cluster-no-tls-no-sasl-values.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    testlabel: exercise_common_labels_template
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    testlabel: exercise_common_labels_template
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="http://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail  ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent  ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX}  ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX}  ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    touch /tmp/preStopHookFinished
    echo "Not enough replicas or in recovery mode, cannot put a broker into maintenance mode."
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    testlabel: exercise_common_labels_template
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    testlabel: exercise_common_labels_template
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    retention_local_target_ms_default: 21600000
    storage_min_free_bytes: 161061273
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls: null
    pandaproxy_client:
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls: null
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls: null
      rpc_server:
        address: 0.0.0.0
        port: 33145
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        tls: null
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        tls: null
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        tls: null
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls: null
    schema_registry_client:
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    testlabel: exercise_common_labels_template
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      tls: null
    kafka_api:
      brokers:
      - redpanda-0:31092
      tls: null
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      tls: null
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    testlabel: exercise_common_labels_template
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: ""
          certFilepath: ""
          enabled: false
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - http://redpanda-0.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: ""
        certFilepath: ""
        enabled: false
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: ""
          certFilepath: ""
          enabled: false
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - http://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    testlabel: exercise_common_labels_template
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
    testlabel: exercise_common_labels_template
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: 8e295d714da59dddd171a1e22d24dbcc78ccfb3123ebddc0c14390bb736f6d65
        checksum/config: 8e295d714da59dddd171a1e22d24dbcc78ccfb3123ebddc0c14390bb736f6d65
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    testlabel: exercise_common_labels_template
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 6e5b1f11d8fb052222d9f4301284b0e91935dbf73c874ee624183b5a04cb9823
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
        testlabel: exercise_common_labels_template
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5  "http://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5  "http://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
        testlabel: exercise_common_labels_template
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 3Gi
    status: {}
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    testlabel: exercise_common_labels_template
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
        testlabel: exercise_common_labels_template
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/03-one-node-cluster-tls-no-sasl-values.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    touch /tmp/preStopHookFinished
    echo "Not enough replicas or in recovery mode, cannot put a broker into maintenance mode."
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 161061273
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: d736bbd4f157a579177ab56c0a9855484f1a234bf96de2d6cb762bae2f5ddf3d
        checksum/config: d736bbd4f157a579177ab56c0a9855484f1a234bf96de2d6cb762bae2f5ddf3d
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 6fd0ffd56475954e062f04d4d1c9393e016e8b66bfba64f6419c794861d1b9b2
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 3Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/04-one-node-cluster-no-tls-sasl-values.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="http://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail  ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent  ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX}  ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX}  ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    touch /tmp/preStopHookFinished
    echo "Not enough replicas or in recovery mode, cannot put a broker into maintenance mode."
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-users
  namespace: default
stringData:
  users.txt: admin:hunter2:SCRAM-SHA-256
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    while true; do
      echo "RUNNING: Monitoring and Updating SASL users"
      USERS_DIR="/etc/secrets/users"

      new_users_list(){
        LIST=$1
        NEW_USER=$2
        if [[ -n "${LIST}" ]]; then
          LIST="${NEW_USER},${LIST}"
        else
          LIST="${NEW_USER}"
        fi

        echo "${LIST}"
      }

      process_users() {
        USERS_DIR=${1-"/etc/secrets/users"}
        USERS_FILE=$(find ${USERS_DIR}/* -print)
        USERS_LIST="kubernetes-controller"
        READ_LIST_SUCCESS=0
        # Read line by line, handle a missing EOL at the end of file
        while read p || [ -n "$p" ] ; do
          IFS=":" read -r USER_NAME PASSWORD MECHANISM <<< $p
          # Do not process empty lines
          if [ -z "$USER_NAME" ]; then
            continue
          fi
          if [[ "${USER_NAME// /}" != "$USER_NAME" ]]; then
            continue
          fi
          echo "Creating user ${USER_NAME}..."
          MECHANISM=${MECHANISM:-SCRAM-SHA-512}
          creation_result=$(rpk acl user create ${USER_NAME} -p ${PASSWORD} --mechanism ${MECHANISM} 2>&1) && creation_result_exit_code=$? || creation_result_exit_code=$?  # On a non-success exit code
          if [[ $creation_result_exit_code -ne 0 ]]; then
            # Check if the stderr contains "User already exists"
            # this error occurs when password has changed
            if [[ $creation_result == *"User already exists"* ]]; then
              echo "Update user ${USER_NAME}"
              # we will try to update by first deleting
              deletion_result=$(rpk acl user delete ${USER_NAME} 2>&1) && deletion_result_exit_code=$? || deletion_result_exit_code=$?
              if [[ $deletion_result_exit_code -ne 0 ]]; then
                echo "deletion of user ${USER_NAME} failed: ${deletion_result}"
                READ_LIST_SUCCESS=1
                break
              fi
              # Now we update the user
              update_result=$(rpk acl user create ${USER_NAME} -p ${PASSWORD} --mechanism ${MECHANISM} 2>&1) && update_result_exit_code=$? || update_result_exit_code=$?  # On a non-success exit code
              if [[ $update_result_exit_code -ne 0 ]]; then
                echo "updating user ${USER_NAME} failed: ${update_result}"
                READ_LIST_SUCCESS=1
                break
              else
                echo "Updated user ${USER_NAME}..."
                USERS_LIST=$(new_users_list "${USERS_LIST}" "${USER_NAME}")
              fi
            else
              # Another error occurred, so output the original message and exit code
              echo "error creating user ${USER_NAME}: ${creation_result}"
              READ_LIST_SUCCESS=1
              break
            fi
          # On a success, the user was created so output that
          else
            echo "Created user ${USER_NAME}..."
            USERS_LIST=$(new_users_list "${USERS_LIST}" "${USER_NAME}")
          fi
        done < $USERS_FILE

        if [[ -n "${USERS_LIST}" && ${READ_LIST_SUCCESS} ]]; then
          echo "Setting superusers configurations with users [${USERS_LIST}]"
          superuser_result=$(rpk cluster config set superusers [${USERS_LIST}] 2>&1) && superuser_result_exit_code=$? || superuser_result_exit_code=$?
          if [[ $superuser_result_exit_code -ne 0 ]]; then
              echo "Setting superusers configurations failed: ${superuser_result}"
          else
              echo "Completed setting superusers configurations"
          fi
        fi
      }

      # before we do anything ensure we have the bootstrap user
      echo "Ensuring bootstrap user ${RPK_USER}..."
      creation_result=$(rpk acl user create ${RPK_USER} -p ${RPK_PASS} --mechanism ${RPK_SASL_MECHANISM} 2>&1) && creation_result_exit_code=$? || creation_result_exit_code=$?  # On a non-success exit code
      if [[ $creation_result_exit_code -ne 0 ]]; then
        if [[ $creation_result == *"User already exists"* ]]; then
          echo "Bootstrap user already created"
        else
          echo "error creating user ${RPK_USER}: ${creation_result}"
        fi
      fi

      # first time processing
      process_users $USERS_DIR

      # subsequent changes detected here
      # watching delete_self as documented in https://ahmet.im/blog/kubernetes-inotify/
      USERS_FILE=$(find ${USERS_DIR}/* -print)
      while RES=$(inotifywait -q -e delete_self ${USERS_FILE}); do
        process_users $USERS_DIR
      done
    done
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-bootstrap-user
  namespace: default
stringData:
  password: changeme
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    enable_rack_awareness: false
    enable_sasl: true
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: true
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 161061273
    superusers:
    - kubernetes-controller
    - admin
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        authentication_method: http_basic
        name: internal
        port: 8082
      - address: 0.0.0.0
        authentication_method: http_basic
        name: default
        port: 8083
      pandaproxy_api_tls: null
    pandaproxy_client:
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls: null
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        authentication_method: sasl
        name: internal
        port: 9093
      - address: 0.0.0.0
        authentication_method: sasl
        name: default
        port: 9094
      kafka_api_tls: null
      rpc_server:
        address: 0.0.0.0
        port: 33145
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        tls: null
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        tls: null
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        tls: null
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        authentication_method: http_basic
        name: internal
        port: 8081
      - address: 0.0.0.0
        authentication_method: http_basic
        name: default
        port: 8084
      schema_registry_api_tls: null
    schema_registry_client:
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      tls: null
    kafka_api:
      brokers:
      - redpanda-0:31092
      tls: null
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      tls: null
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: true
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: ""
          certFilepath: ""
          enabled: false
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - http://redpanda-0.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: ""
        certFilepath: ""
        enabled: false
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: ""
          certFilepath: ""
          enabled: false
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - http://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: 1065bc2e7f874eda3abe8ffce90d6b430d8334187d3841d4d7e8897de4ac977e
        checksum/config: 1065bc2e7f874eda3abe8ffce90d6b430d8334187d3841d4d7e8897de4ac977e
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command:
        - sh
        - -c
        - set -e; IFS=':' read -r KAFKA_SASL_USERNAME KAFKA_SASL_PASSWORD KAFKA_SASL_MECHANISM
          < <(grep "" $(find /mnt/users/* -print)); KAFKA_SASL_MECHANISM=${KAFKA_SASL_MECHANISM:-SCRAM-SHA-512};
          export KAFKA_SASL_USERNAME KAFKA_SASL_PASSWORD KAFKA_SASL_MECHANISM; export
          KAFKA_SCHEMAREGISTRY_USERNAME=$KAFKA_SASL_USERNAME; export KAFKA_SCHEMAREGISTRY_PASSWORD=$KAFKA_SASL_PASSWORD;
          export REDPANDA_ADMINAPI_USERNAME=$KAFKA_SASL_USERNAME; export REDPANDA_ADMINAPI_PASSWORD=$KAFKA_SASL_PASSWORD;
          /app/console $@
        - ' --'
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /mnt/users
          name: redpanda-users
          readOnly: true
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-users
        secret:
          secretName: redpanda-users
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 5265a0c42c9888cd69e394a959677e44c5909408f1c85c570bb56e6262285b1a
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        - name: RP_BOOTSTRAP_USER
          value: $(RPK_USER):$(RPK_PASS):$(RPK_SASL_MECHANISM)
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5  "http://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5  "http://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env:
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: users
        secret:
          secretName: redpanda-users
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 3Gi
    status: {}
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        - name: RP_BOOTSTRAP_USER
          value: $(RPK_USER):$(RPK_PASS):$(RPK_SASL_MECHANISM)
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: users
        secret:
          secretName: redpanda-users
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/05-one-node-cluster-tls-sasl-values.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    touch /tmp/preStopHookFinished
    echo "Not enough replicas or in recovery mode, cannot put a broker into maintenance mode."
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-users
  namespace: default
stringData:
  users.txt: admins:change-me:SCRAM-SHA-256
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    while true; do
      echo "RUNNING: Monitoring and Updating SASL users"
      USERS_DIR="/etc/secrets/users"

      new_users_list(){
        LIST=$1
        NEW_USER=$2
        if [[ -n "${LIST}" ]]; then
          LIST="${NEW_USER},${LIST}"
        else
          LIST="${NEW_USER}"
        fi

        echo "${LIST}"
      }

      process_users() {
        USERS_DIR=${1-"/etc/secrets/users"}
        USERS_FILE=$(find ${USERS_DIR}/* -print)
        USERS_LIST="kubernetes-controller"
        READ_LIST_SUCCESS=0
        # Read line by line, handle a missing EOL at the end of file
        while read p || [ -n "$p" ] ; do
          IFS=":" read -r USER_NAME PASSWORD MECHANISM <<< $p
          # Do not process empty lines
          if [ -z "$USER_NAME" ]; then
            continue
          fi
          if [[ "${USER_NAME// /}" != "$USER_NAME" ]]; then
            continue
          fi
          echo "Creating user ${USER_NAME}..."
          MECHANISM=${MECHANISM:-SCRAM-SHA-512}
          creation_result=$(rpk acl user create ${USER_NAME} -p ${PASSWORD} --mechanism ${MECHANISM} 2>&1) && creation_result_exit_code=$? || creation_result_exit_code=$?  # On a non-success exit code
          if [[ $creation_result_exit_code -ne 0 ]]; then
            # Check if the stderr contains "User already exists"
            # this error occurs when password has changed
            if [[ $creation_result == *"User already exists"* ]]; then
              echo "Update user ${USER_NAME}"
              # we will try to update by first deleting
              deletion_result=$(rpk acl user delete ${USER_NAME} 2>&1) && deletion_result_exit_code=$? || deletion_result_exit_code=$?
              if [[ $deletion_result_exit_code -ne 0 ]]; then
                echo "deletion of user ${USER_NAME} failed: ${deletion_result}"
                READ_LIST_SUCCESS=1
                break
              fi
              # Now we update the user
              update_result=$(rpk acl user create ${USER_NAME} -p ${PASSWORD} --mechanism ${MECHANISM} 2>&1) && update_result_exit_code=$? || update_result_exit_code=$?  # On a non-success exit code
              if [[ $update_result_exit_code -ne 0 ]]; then
                echo "updating user ${USER_NAME} failed: ${update_result}"
                READ_LIST_SUCCESS=1
                break
              else
                echo "Updated user ${USER_NAME}..."
                USERS_LIST=$(new_users_list "${USERS_LIST}" "${USER_NAME}")
              fi
            else
              # Another error occurred, so output the original message and exit code
              echo "error creating user ${USER_NAME}: ${creation_result}"
              READ_LIST_SUCCESS=1
              break
            fi
          # On a success, the user was created so output that
          else
            echo "Created user ${USER_NAME}..."
            USERS_LIST=$(new_users_list "${USERS_LIST}" "${USER_NAME}")
          fi
        done < $USERS_FILE

        if [[ -n "${USERS_LIST}" && ${READ_LIST_SUCCESS} ]]; then
          echo "Setting superusers configurations with users [${USERS_LIST}]"
          superuser_result=$(rpk cluster config set superusers [${USERS_LIST}] 2>&1) && superuser_result_exit_code=$? || superuser_result_exit_code=$?
          if [[ $superuser_result_exit_code -ne 0 ]]; then
              echo "Setting superusers configurations failed: ${superuser_result}"
          else
              echo "Completed setting superusers configurations"
          fi
        fi
      }

      # before we do anything ensure we have the bootstrap user
      echo "Ensuring bootstrap user ${RPK_USER}..."
      creation_result=$(rpk acl user create ${RPK_USER} -p ${RPK_PASS} --mechanism ${RPK_SASL_MECHANISM} 2>&1) && creation_result_exit_code=$? || creation_result_exit_code=$?  # On a non-success exit code
      if [[ $creation_result_exit_code -ne 0 ]]; then
        if [[ $creation_result == *"User already exists"* ]]; then
          echo "Bootstrap user already created"
        else
          echo "error creating user ${RPK_USER}: ${creation_result}"
        fi
      fi

      # first time processing
      process_users $USERS_DIR

      # subsequent changes detected here
      # watching delete_self as documented in https://ahmet.im/blog/kubernetes-inotify/
      USERS_FILE=$(find ${USERS_DIR}/* -print)
      while RES=$(inotifywait -q -e delete_self ${USERS_FILE}); do
        process_users $USERS_DIR
      done
    done
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-bootstrap-user
  namespace: default
stringData:
  password: changeme
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    enable_rack_awareness: false
    enable_sasl: true
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: true
    kafka_nodelete_topics:
    - audit
    - consumer_offsets
    - _schemas
    - my_sample_topic
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 161061273
    superusers:
    - kubernetes-controller
    - admins
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        authentication_method: http_basic
        name: internal
        port: 8082
      - address: 0.0.0.0
        authentication_method: http_basic
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        authentication_method: sasl
        name: internal
        port: 9093
      - address: 0.0.0.0
        authentication_method: sasl
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        authentication_method: http_basic
        name: internal
        port: 8081
      - address: 0.0.0.0
        authentication_method: http_basic
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: true
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: b61e56acd844faac80ce86bcafb5402bc25d7f9eb65f079a97bb5ef701728307
        checksum/config: b61e56acd844faac80ce86bcafb5402bc25d7f9eb65f079a97bb5ef701728307
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command:
        - sh
        - -c
        - set -e; IFS=':' read -r KAFKA_SASL_USERNAME KAFKA_SASL_PASSWORD KAFKA_SASL_MECHANISM
          < <(grep "" $(find /mnt/users/* -print)); KAFKA_SASL_MECHANISM=${KAFKA_SASL_MECHANISM:-SCRAM-SHA-512};
          export KAFKA_SASL_USERNAME KAFKA_SASL_PASSWORD KAFKA_SASL_MECHANISM; export
          KAFKA_SCHEMAREGISTRY_USERNAME=$KAFKA_SASL_USERNAME; export KAFKA_SCHEMAREGISTRY_PASSWORD=$KAFKA_SASL_PASSWORD;
          export REDPANDA_ADMINAPI_USERNAME=$KAFKA_SASL_USERNAME; export REDPANDA_ADMINAPI_PASSWORD=$KAFKA_SASL_PASSWORD;
          /app/console $@
        - ' --'
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /mnt/users
          name: redpanda-users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-users
        secret:
          secretName: redpanda-users
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: fc10e3af9a4f7ff7f2e7f76110e0ad824999092e8012a745bc1168ead31e43ad
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        - name: RP_BOOTSTRAP_USER
          value: $(RPK_USER):$(RPK_PASS):$(RPK_SASL_MECHANISM)
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env:
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: users
        secret:
          secretName: redpanda-users
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 3Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        - name: RP_BOOTSTRAP_USER
          value: $(RPK_USER):$(RPK_PASS):$(RPK_SASL_MECHANISM)
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: users
        secret:
          secretName: redpanda-users
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/06-rack-awareness-values.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"

    # Configure Rack Awareness
    set +x
    RACK=$(curl --silent --cacert /run/secrets/kubernetes.io/serviceaccount/ca.crt --fail -H 'Authorization: Bearer '$(cat /run/secrets/kubernetes.io/serviceaccount/token) "https://${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT_HTTPS}/api/v1/nodes/${KUBERNETES_NODE_NAME}?pretty=true" | grep '"topology.kubernetes.io/zone"' | grep -v '\"key\":' | sed 's/.*": "\([^"]\+\).*/\1/')
    set -x
    rpk --config "$CONFIG" redpanda config set redpanda.rack "${RACK}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: true
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
rules:
- apiGroups:
  - ""
  resources:
  - nodes
  verbs:
  - get
  - list
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk-bundle
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  - endpoints
  - events
  - limitranges
  - persistentvolumeclaims
  - pods
  - pods/log
  - replicationcontrollers
  - resourcequotas
  - serviceaccounts
  - services
  verbs:
  - get
  - list
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: redpanda
subjects:
- kind: ServiceAccount
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk-bundle
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: redpanda-rpk-bundle
subjects:
- kind: ServiceAccount
  name: redpanda
  namespace: default
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
          name: kube-api-access
          readOnly: true
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: redpanda
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
      - name: kube-api-access
        projected:
          defaultMode: 420
          sources:
          - serviceAccountToken:
              expirationSeconds: 3607
              path: token
          - configMap:
              items:
              - key: ca.crt
                path: ca.crt
              name: kube-root-ca.crt
          - downwardAPI:
              items:
              - fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.namespace
                path: namespace
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: redpanda
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/07-multiple-listeners-values.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext2\",\"port\":31292}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext2\",\"port\":31292}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext2\",\"port\":31292}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[2] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext3\",\"port\":31392}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext3\",\"port\":31392}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext3\",\"port\":31392}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[3] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext2\",\"port\":30183}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext2\",\"port\":30183}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext2\",\"port\":30183}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[2] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext3\",\"port\":30283}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext3\",\"port\":30283}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext3\",\"port\":30283}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[3] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      - address: 0.0.0.0
        name: ext2
        port: 18083
      - address: 0.0.0.0
        name: ext3
        port: 28083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: ext2
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/cert2/tls.crt
        enabled: true
        key_file: /etc/tls/certs/cert2/tls.key
        name: ext3
        require_client_auth: true
        truststore_file: /etc/ssl/certs/ca-certificates.crt
    pandaproxy_client:
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      - address: 0.0.0.0
        name: ext2
        port: 19094
      - address: 0.0.0.0
        name: ext3
        port: 29094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: ext2
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/cert2/tls.crt
        enabled: true
        key_file: /etc/tls/certs/cert2/tls.key
        name: ext3
        require_client_auth: true
        truststore_file: /etc/ssl/certs/ca-certificates.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls: null
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls: null
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      - address: 0.0.0.0
        name: ext2
        port: 18081
      - address: 0.0.0.0
        name: ext3
        port: 28081
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: ext2
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/cert2/tls.crt
        enabled: true
        key_file: /etc/tls/certs/cert2/tls.key
        name: ext3
        require_client_auth: true
        truststore_file: /etc/ssl/certs/ca-certificates.crt
    schema_registry_client:
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls: null
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls: null
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: ""
          certFilepath: ""
          enabled: false
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - http://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - http://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - http://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: ""
        certFilepath: ""
        enabled: false
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: kafka-ext2
    nodePort: 31292
    port: 19094
    protocol: TCP
    targetPort: 0
  - name: kafka-ext3
    nodePort: 31392
    port: 29094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: http-ext2
    nodePort: 30183
    port: 18083
    protocol: TCP
    targetPort: 0
  - name: http-ext3
    nodePort: 30283
    port: 28083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  - name: schema-ext2
    nodePort: 30181
    port: 18081
    protocol: TCP
    targetPort: 0
  - name: schema-ext3
    nodePort: 30281
    port: 28081
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: 721d4f3f7ab8e76694c1d5ccab48c84cd30b5c9711b5d9b1a6d69d1a3cbf69e8
        checksum/config: 721d4f3f7ab8e76694c1d5ccab48c84cd30b5c9711b5d9b1a6d69d1a3cbf69e8
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 6efc2c489543f3f84c0105524bea43a1fb61e5a3925046cb0a60551f23959964
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 18083
          name: http-ext2
        - containerPort: 28083
          name: http-ext3
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 19094
          name: kafka-ext2
        - containerPort: 29094
          name: kafka-ext3
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        - containerPort: 18081
          name: schema-ext2
        - containerPort: 28081
          name: schema-ext3
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/cert2
          name: redpanda-cert2-cert
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/cert2
          name: redpanda-cert2-cert
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/cert2
          name: redpanda-cert2-cert
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/cert2
          name: redpanda-cert2-cert
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-cert2-cert
        secret:
          defaultMode: 288
          secretName: redpanda-cert2-cert
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-cert2-root-certificate
  namespace: default
spec:
  commonName: redpanda-cert2-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-cert2-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-cert2-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-cert2-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-cert2-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-cert2-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-cert2-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-cert2-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-cert2-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/cert2
          name: redpanda-cert2-cert
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-cert2-cert
        secret:
          defaultMode: 288
          secretName: redpanda-cert2-cert
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/08-custom-podantiaffinity-values.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/09-initcontainers-resources-values.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-fs-validator
  namespace: default
stringData:
  fsValidator.sh: |-
    set -e
    EXPECTED_FS_TYPE=$1

    DATA_DIR="/var/lib/redpanda/data"
    TEST_FILE="testfile"

    echo "checking data directory exist..."
    if [ ! -d "${DATA_DIR}" ]; then
      echo "data directory does not exists, exiting"
      exit 1
    fi

    echo "checking filesystem type..."
    FS_TYPE=$(df -T $DATA_DIR  | tail -n +2 | awk '{print $2}')

    if [ "${FS_TYPE}" != "${EXPECTED_FS_TYPE}" ]; then
      echo "file system found to be ${FS_TYPE} when expected ${EXPECTED_FS_TYPE}"
      exit 1
    fi

    echo "checking if able to create a test file..."

    touch ${DATA_DIR}/${TEST_FILE}
    result=$(touch ${DATA_DIR}/${TEST_FILE} 2> /dev/null; echo $?)
    if [ "${result}" != "0" ]; then
      echo "could not write testfile, may not have write permission"
      exit 1
    fi

    echo "checking if able to delete a test file..."

    result=$(rm ${DATA_DIR}/${TEST_FILE} 2> /dev/null; echo $?)
    if [ "${result}" != "0" ]; then
      echo "could not delete testfile"
      exit 1
    fi

    echo "passed"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
        - mountPath: /fake/lifecycle
          name: test-extra-volume
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
        - mountPath: /fake/lifecycle
          name: test-extra-volume
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /fake/lifecycle
          name: test-extra-volume
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/sh
        - -c
        - chown 101:101 -R /var/lib/redpanda/data
        env: null
        image: busybox:latest
        name: set-datadir-ownership
        resources:
          limits:
            cpu: 200m
            memory: 60Mi
          requests:
            cpu: 100m
            memory: 20Mi
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /fake/lifecycle
          name: test-extra-volume
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/fs-validator/scripts/fsValidator.sh
          ext4 & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: fs-validator
        resources:
          limits:
            cpu: 200m
            memory: 60Mi
          requests:
            cpu: 100m
            memory: 20Mi
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /fake/lifecycle
          name: test-extra-volume
        - mountPath: /etc/secrets/fs-validator/scripts/
          name: redpanda-fs-validator
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources:
          limits:
            cpu: 200m
            memory: 60Mi
          requests:
            cpu: 100m
            memory: 20Mi
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /fake/lifecycle
          name: test-extra-volume
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      - args:
        - |-
          set -xe
          echo "Hello World!"
        command:
        - /bin/bash
        - -c
        env: null
        image: mintel/docker-alpine-bash-curl-jq:latest
        name: test-init-container
        volumeMounts: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: redpanda-fs-validator
        secret:
          defaultMode: 509
          secretName: redpanda-fs-validator
      - name: test-extra-volume
        secret:
          defaultMode: 508
          secretName: redpanda-sts-lifecycle
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/10-external-addresses-values.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"redpanda-1.my-domain\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"127.0.0.1.my-domain\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"192.168.0.1.my-domain\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"redpanda-1.my-domain\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"127.0.0.1.my-domain\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"192.168.0.1.my-domain\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-1.my-domain:31644
      - 127.0.0.1.my-domain:31644
      - 192.168.0.1.my-domain:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-1.my-domain:31092
      - 127.0.0.1.my-domain:31092
      - 192.168.0.1.my-domain:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-1.my-domain:30081
      - 127.0.0.1.my-domain:30081
      - 192.168.0.1.my-domain:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: fc549ca23d4e1dff27e530265d59be059368cd4866ee0ca938c73ceff6815b57
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  - my-domain
  - '*.my-domain'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  - my-domain
  - '*.my-domain'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/11-update-sasl-users-values.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: some-users
  namespace: default
stringData:
  users.txt: |-
    admin:badpassword:SCRAM-SHA-256
    user1:pass1word:SCRAM-SHA-512
    someuser:ABC123r:SCRAM-SHA-512
    anotherme:blah2784a:SCRAM-SHA-512
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    while true; do
      echo "RUNNING: Monitoring and Updating SASL users"
      USERS_DIR="/etc/secrets/users"

      new_users_list(){
        LIST=$1
        NEW_USER=$2
        if [[ -n "${LIST}" ]]; then
          LIST="${NEW_USER},${LIST}"
        else
          LIST="${NEW_USER}"
        fi

        echo "${LIST}"
      }

      process_users() {
        USERS_DIR=${1-"/etc/secrets/users"}
        USERS_FILE=$(find ${USERS_DIR}/* -print)
        USERS_LIST="kubernetes-controller"
        READ_LIST_SUCCESS=0
        # Read line by line, handle a missing EOL at the end of file
        while read p || [ -n "$p" ] ; do
          IFS=":" read -r USER_NAME PASSWORD MECHANISM <<< $p
          # Do not process empty lines
          if [ -z "$USER_NAME" ]; then
            continue
          fi
          if [[ "${USER_NAME// /}" != "$USER_NAME" ]]; then
            continue
          fi
          echo "Creating user ${USER_NAME}..."
          MECHANISM=${MECHANISM:-SCRAM-SHA-512}
          creation_result=$(rpk acl user create ${USER_NAME} -p ${PASSWORD} --mechanism ${MECHANISM} 2>&1) && creation_result_exit_code=$? || creation_result_exit_code=$?  # On a non-success exit code
          if [[ $creation_result_exit_code -ne 0 ]]; then
            # Check if the stderr contains "User already exists"
            # this error occurs when password has changed
            if [[ $creation_result == *"User already exists"* ]]; then
              echo "Update user ${USER_NAME}"
              # we will try to update by first deleting
              deletion_result=$(rpk acl user delete ${USER_NAME} 2>&1) && deletion_result_exit_code=$? || deletion_result_exit_code=$?
              if [[ $deletion_result_exit_code -ne 0 ]]; then
                echo "deletion of user ${USER_NAME} failed: ${deletion_result}"
                READ_LIST_SUCCESS=1
                break
              fi
              # Now we update the user
              update_result=$(rpk acl user create ${USER_NAME} -p ${PASSWORD} --mechanism ${MECHANISM} 2>&1) && update_result_exit_code=$? || update_result_exit_code=$?  # On a non-success exit code
              if [[ $update_result_exit_code -ne 0 ]]; then
                echo "updating user ${USER_NAME} failed: ${update_result}"
                READ_LIST_SUCCESS=1
                break
              else
                echo "Updated user ${USER_NAME}..."
                USERS_LIST=$(new_users_list "${USERS_LIST}" "${USER_NAME}")
              fi
            else
              # Another error occurred, so output the original message and exit code
              echo "error creating user ${USER_NAME}: ${creation_result}"
              READ_LIST_SUCCESS=1
              break
            fi
          # On a success, the user was created so output that
          else
            echo "Created user ${USER_NAME}..."
            USERS_LIST=$(new_users_list "${USERS_LIST}" "${USER_NAME}")
          fi
        done < $USERS_FILE

        if [[ -n "${USERS_LIST}" && ${READ_LIST_SUCCESS} ]]; then
          echo "Setting superusers configurations with users [${USERS_LIST}]"
          superuser_result=$(rpk cluster config set superusers [${USERS_LIST}] 2>&1) && superuser_result_exit_code=$? || superuser_result_exit_code=$?
          if [[ $superuser_result_exit_code -ne 0 ]]; then
              echo "Setting superusers configurations failed: ${superuser_result}"
          else
              echo "Completed setting superusers configurations"
          fi
        fi
      }

      # before we do anything ensure we have the bootstrap user
      echo "Ensuring bootstrap user ${RPK_USER}..."
      creation_result=$(rpk acl user create ${RPK_USER} -p ${RPK_PASS} --mechanism ${RPK_SASL_MECHANISM} 2>&1) && creation_result_exit_code=$? || creation_result_exit_code=$?  # On a non-success exit code
      if [[ $creation_result_exit_code -ne 0 ]]; then
        if [[ $creation_result == *"User already exists"* ]]; then
          echo "Bootstrap user already created"
        else
          echo "error creating user ${RPK_USER}: ${creation_result}"
        fi
      fi

      # first time processing
      process_users $USERS_DIR

      # subsequent changes detected here
      # watching delete_self as documented in https://ahmet.im/blog/kubernetes-inotify/
      USERS_FILE=$(find ${USERS_DIR}/* -print)
      while RES=$(inotifywait -q -e delete_self ${USERS_FILE}); do
        process_users $USERS_DIR
      done
    done
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-bootstrap-user
  namespace: default
stringData:
  password: changeme
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: true
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: true
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
    superusers:
    - kubernetes-controller
    - admin
    - user1
    - someuser
    - anotherme
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        authentication_method: http_basic
        name: internal
        port: 8082
      - address: 0.0.0.0
        authentication_method: http_basic
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        authentication_method: sasl
        name: internal
        port: 9093
      - address: 0.0.0.0
        authentication_method: sasl
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        authentication_method: http_basic
        name: internal
        port: 8081
      - address: 0.0.0.0
        authentication_method: http_basic
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: true
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: 7c7f4a111865610cc9487cc076a984b8603c6ede97a620f4731d55bb0acde7b5
        checksum/config: 7c7f4a111865610cc9487cc076a984b8603c6ede97a620f4731d55bb0acde7b5
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command:
        - sh
        - -c
        - set -e; IFS=':' read -r KAFKA_SASL_USERNAME KAFKA_SASL_PASSWORD KAFKA_SASL_MECHANISM
          < <(grep "" $(find /mnt/users/* -print)); KAFKA_SASL_MECHANISM=${KAFKA_SASL_MECHANISM:-SCRAM-SHA-512};
          export KAFKA_SASL_USERNAME KAFKA_SASL_PASSWORD KAFKA_SASL_MECHANISM; export
          KAFKA_SCHEMAREGISTRY_USERNAME=$KAFKA_SASL_USERNAME; export KAFKA_SCHEMAREGISTRY_PASSWORD=$KAFKA_SASL_PASSWORD;
          export REDPANDA_ADMINAPI_USERNAME=$KAFKA_SASL_USERNAME; export REDPANDA_ADMINAPI_PASSWORD=$KAFKA_SASL_PASSWORD;
          /app/console $@
        - ' --'
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /mnt/users
          name: redpanda-users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-users
        secret:
          secretName: some-users
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: ddcf6376732939f810acb684cafac205507b50b966e5714f128ed87a56fb10f6
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        - name: RP_BOOTSTRAP_USER
          value: $(RPK_USER):$(RPK_PASS):$(RPK_SASL_MECHANISM)
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env:
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: users
        secret:
          secretName: some-users
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        - name: RP_BOOTSTRAP_USER
          value: $(RPK_USER):$(RPK_PASS):$(RPK_SASL_MECHANISM)
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: users
        secret:
          secretName: some-users
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/12-external-cert-secrets-values.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.random-domain\",\"name\":\"default\",\"port\":30090}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.random-domain\",\"name\":\"default\",\"port\":30090}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.random-domain\",\"name\":\"default\",\"port\":30090}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.random-domain\",\"name\":\"default\",\"port\":30070}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.random-domain\",\"name\":\"default\",\"port\":30070}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.random-domain\",\"name\":\"default\",\"port\":30070}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0.random-domain:31644
      - redpanda-1.random-domain:31644
      - redpanda-2.random-domain:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0.random-domain:30090
      - redpanda-1.random-domain:30090
      - redpanda-2.random-domain:30090
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0.random-domain:30080
      - redpanda-1.random-domain:30080
      - redpanda-2.random-domain:30080
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 30090
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30070
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30080
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 48ad7b247c147d3bd7bcbc3357d831d21016fbd8ca0022343a14dbb23c15a9ae
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: external-tls-secret
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  - random-domain
  - '*.random-domain'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: external-tls-secret
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/13-loadbalancer-tls-values.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.random-domain\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.random-domain\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.random-domain\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.random-domain\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.random-domain\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.random-domain\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0.random-domain:31644
      - redpanda-1.random-domain:31644
      - redpanda-2.random-domain:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0.random-domain:31092
      - redpanda-1.random-domain:31092
      - redpanda-2.random-domain:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0.random-domain:30081
      - redpanda-1.random-domain:30081
      - redpanda-2.random-domain:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    repdanda.com/type: loadbalancer
  name: lb-redpanda-0
  namespace: default
spec:
  externalTrafficPolicy: Local
  loadBalancerSourceRanges: null
  ports:
  - name: admin-default
    port: 31644
    protocol: TCP
    targetPort: 9645
  - name: kafka-default
    port: 31092
    protocol: TCP
    targetPort: 9094
  - name: http-default
    port: 30082
    protocol: TCP
    targetPort: 8083
  - name: schema-default
    port: 30081
    protocol: TCP
    targetPort: 8084
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
    statefulset.kubernetes.io/pod-name: redpanda-0
  sessionAffinity: None
  type: LoadBalancer
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    repdanda.com/type: loadbalancer
  name: lb-redpanda-1
  namespace: default
spec:
  externalTrafficPolicy: Local
  loadBalancerSourceRanges: null
  ports:
  - name: admin-default
    port: 31644
    protocol: TCP
    targetPort: 9645
  - name: kafka-default
    port: 31092
    protocol: TCP
    targetPort: 9094
  - name: http-default
    port: 30082
    protocol: TCP
    targetPort: 8083
  - name: schema-default
    port: 30081
    protocol: TCP
    targetPort: 8084
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
    statefulset.kubernetes.io/pod-name: redpanda-1
  sessionAffinity: None
  type: LoadBalancer
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    repdanda.com/type: loadbalancer
  name: lb-redpanda-2
  namespace: default
spec:
  externalTrafficPolicy: Local
  loadBalancerSourceRanges: null
  ports:
  - name: admin-default
    port: 31644
    protocol: TCP
    targetPort: 9645
  - name: kafka-default
    port: 31092
    protocol: TCP
    targetPort: 9094
  - name: http-default
    port: 30082
    protocol: TCP
    targetPort: 8083
  - name: schema-default
    port: 30081
    protocol: TCP
    targetPort: 8084
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
    statefulset.kubernetes.io/pod-name: redpanda-2
  sessionAffinity: None
  type: LoadBalancer
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 48ad7b247c147d3bd7bcbc3357d831d21016fbd8ca0022343a14dbb23c15a9ae
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: external-tls-secret
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  - random-domain
  - '*.random-domain'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: external-tls-secret
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/14-prometheus-no-tls-values.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="http://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail  ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent  ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX}  ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX}  ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls: null
    pandaproxy_client:
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls: null
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls: null
      rpc_server:
        address: 0.0.0.0
        port: 33145
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls: null
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls: null
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls: null
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls: null
    schema_registry_client:
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls: null
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls: null
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls: null
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: ""
          certFilepath: ""
          enabled: false
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - http://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - http://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - http://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: ""
        certFilepath: ""
        enabled: false
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: ""
          certFilepath: ""
          enabled: false
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - http://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "true"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: 83a571bb3ef213bdf428747ccfc45e87986518e632b69ef2c02aaec57d53a8c9
        checksum/config: 83a571bb3ef213bdf428747ccfc45e87986518e632b69ef2c02aaec57d53a8c9
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 148733ee0ada31cbc1a8fda54191ad29425f8b3dea458814fac1938671843141
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5  "http://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5  "http://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    release: prometheus
  name: redpanda
  namespace: default
spec:
  endpoints:
  - enableHttp2: null
    interval: 30s
    path: /public_metrics
    port: admin
    scheme: http
  namespaceSelector: {}
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      monitoring.redpanda.com/enabled: "true"
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/15-prometheus-tls-values.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "true"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    release: prometheus
  name: redpanda
  namespace: default
spec:
  endpoints:
  - enableHttp2: null
    interval: 30s
    path: /public_metrics
    port: admin
    scheme: https
    tlsConfig:
      ca: {}
      cert: {}
      insecureSkipVerify: true
  namespaceSelector: {}
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      monitoring.redpanda.com/enabled: "true"
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/16-controller-sidecar-values.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
rules:
- apiGroups:
  - ""
  resources:
  - nodes
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - persistentvolumes
  verbs:
  - delete
  - get
  - list
  - patch
  - update
  - watch
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
rules:
- apiGroups:
  - ""
  resources:
  - nodes
  verbs:
  - get
  - list
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk-bundle
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  - endpoints
  - events
  - limitranges
  - persistentvolumeclaims
  - pods
  - pods/log
  - replicationcontrollers
  - resourcequotas
  - serviceaccounts
  - services
  verbs:
  - get
  - list
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: redpanda-sidecar-controllers
subjects:
- kind: ServiceAccount
  name: default
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: redpanda
subjects:
- kind: ServiceAccount
  name: default
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk-bundle
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: redpanda-rpk-bundle
subjects:
- kind: ServiceAccount
  name: default
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
  namespace: default
rules:
- apiGroups:
  - apps
  resources:
  - statefulsets/status
  verbs:
  - patch
  - update
- apiGroups:
  - ""
  resources:
  - secrets
  - pods
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - apps
  resources:
  - statefulsets
  verbs:
  - get
  - patch
  - update
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - persistentvolumeclaims
  verbs:
  - delete
  - get
  - list
  - patch
  - update
  - watch
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
  namespace: default
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: redpanda-sidecar-controllers
subjects:
- kind: ServiceAccount
  name: default
  namespace: default
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      - args:
        - --operator-mode=false
        - --namespace=default
        - --health-probe-bind-address=:8085
        - --metrics-bind-address=:9082
        - --pprof-bind-address=:9083
        - --additional-controllers=all
        command:
        - /manager
        env:
        - name: REDPANDA_HELM_RELEASE_NAME
          value: redpanda
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: redpanda-controllers
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
          name: kube-api-access
          readOnly: true
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
      - name: kube-api-access
        projected:
          defaultMode: 420
          sources:
          - serviceAccountToken:
              expirationSeconds: 3607
              path: token
          - configMap:
              items:
              - key: ca.crt
                path: ca.crt
              name: kube-root-ca.crt
          - downwardAPI:
              items:
              - fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.namespace
                path: namespace
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/17-resources-without-unit-values.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2000M
      - --reserve-memory=0M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: f20d341fb81aa7ed6ced1fad2af7b611113cb255d137392a3d2485781a045a19
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: "1"
            memory: 2500Mi
          requests:
            cpu: "1"
            memory: 2500Mi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/18-single-external-address-values.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE="$POD_ORDINAL-XYZ-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.my-domain\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE="$POD_ORDINAL-XYZ-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.my-domain\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE="$POD_ORDINAL-XYZ-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.my-domain\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE="$POD_ORDINAL-XYZ-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.my-domain\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE="$POD_ORDINAL-XYZ-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.my-domain\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE="$POD_ORDINAL-XYZ-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.my-domain\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - $PREFIX_TEMPLATE.my-domain:31644
      - $PREFIX_TEMPLATE.my-domain:31644
      - $PREFIX_TEMPLATE.my-domain:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - $PREFIX_TEMPLATE.my-domain:31092
      - $PREFIX_TEMPLATE.my-domain:31092
      - $PREFIX_TEMPLATE.my-domain:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - $PREFIX_TEMPLATE.my-domain:30081
      - $PREFIX_TEMPLATE.my-domain:30081
      - $PREFIX_TEMPLATE.my-domain:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 9802162e4b8b9aaf699d67337e3ee45299ff93beb822d0842765ce1c5a4c911b
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  - my-domain
  - '*.my-domain'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  - my-domain
  - '*.my-domain'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/21-eks-tiered-storage-with-creds-values.yaml.tpl.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
stringData:
  enterprise-license: ${REDPANDA_SAMPLE_LICENSE}
  kafka-protobuf-git-basicauth-password: ""
  kafka-sasl-aws-msk-iam-secret-key: ""
  kafka-sasl-password: ""
  kafka-schema-registry-password: ""
  kafka-schemaregistry-tls-ca: ""
  kafka-schemaregistry-tls-cert: ""
  kafka-schemaregistry-tls-key: ""
  kafka-tls-ca: ""
  kafka-tls-cert: ""
  kafka-tls-key: ""
  login-github-oauth-client-secret: ""
  login-github-personal-access-token: ""
  login-google-groups-service-account.json: ""
  login-google-oauth-client-secret: ""
  login-jwt-secret: SECRETKEY
  login-oidc-client-secret: ""
  login-okta-client-secret: ""
  login-okta-directory-api-token: ""
  redpanda-admin-api-password: ""
  redpanda-admin-api-tls-ca: ""
  redpanda-admin-api-tls-cert: ""
  redpanda-admin-api-tls-key: ""
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_access_key: ${AWS_ACCESS_KEY_ID}
    cloud_storage_bucket: ${TEST_BUCKET}
    cloud_storage_cache_size: 5368709120
    cloud_storage_credentials_source: config_file
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: true
    cloud_storage_region: ${AWS_REGION}
    cloud_storage_secret_key: ${AWS_SECRET_ACCESS_KEY}
    cloud_storage_segment_max_upload_interval_sec: 1
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env:
        - name: LOGIN_JWTSECRET
          valueFrom:
            secretKeyRef:
              key: login-jwt-secret
              name: redpanda-console
        - name: LICENSE
          valueFrom:
            secretKeyRef:
              key: enterprise-license
              name: redpanda-console
        envFrom: []
        image: redpandadata/console-unstable:master-8a51854
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/console/secrets
          name: secrets
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: secrets
        secret:
          secretName: redpanda-console
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/sh
        - -c
        - mkdir -p /var/lib/redpanda/data/cloud_storage_cache; chown 101:101 -R /var/lib/redpanda/data/cloud_storage_cache
        env: null
        image: busybox:latest
        name: set-tiered-storage-cache-dir-ownership
        resources: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          value: ${REDPANDA_SAMPLE_LICENSE}
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/22-gke-tiered-storage-with-creds-values.yaml.tpl.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
stringData:
  enterprise-license: ${REDPANDA_SAMPLE_LICENSE}
  kafka-protobuf-git-basicauth-password: ""
  kafka-sasl-aws-msk-iam-secret-key: ""
  kafka-sasl-password: ""
  kafka-schema-registry-password: ""
  kafka-schemaregistry-tls-ca: ""
  kafka-schemaregistry-tls-cert: ""
  kafka-schemaregistry-tls-key: ""
  kafka-tls-ca: ""
  kafka-tls-cert: ""
  kafka-tls-key: ""
  login-github-oauth-client-secret: ""
  login-github-personal-access-token: ""
  login-google-groups-service-account.json: ""
  login-google-oauth-client-secret: ""
  login-jwt-secret: SECRETKEY
  login-oidc-client-secret: ""
  login-okta-client-secret: ""
  login-okta-directory-api-token: ""
  redpanda-admin-api-password: ""
  redpanda-admin-api-tls-ca: ""
  redpanda-admin-api-tls-cert: ""
  redpanda-admin-api-tls-key: ""
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_access_key: ${GCP_ACCESS_KEY_ID}
    cloud_storage_api_endpoint: storage.googleapis.com
    cloud_storage_bucket: ${TEST_BUCKET}
    cloud_storage_cache_size: 5368709120
    cloud_storage_credentials_source: config_file
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: true
    cloud_storage_region: US-WEST1
    cloud_storage_secret_key: ${GCP_SECRET_ACCESS_KEY}
    cloud_storage_segment_max_upload_interval_sec: 1
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=1024M
      - --reserve-memory=100M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: true
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env:
        - name: LOGIN_JWTSECRET
          valueFrom:
            secretKeyRef:
              key: login-jwt-secret
              name: redpanda-console
        - name: LICENSE
          valueFrom:
            secretKeyRef:
              key: enterprise-license
              name: redpanda-console
        envFrom: []
        image: redpandadata/console-unstable:master-8a51854
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/console/secrets
          name: secrets
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: secrets
        secret:
          secretName: redpanda-console
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 6e125110db4b6706f6338010ad36c50316395111aea32b3a9d4f4984a32501f9
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 400m
            memory: 2.0Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/sh
        - -c
        - mkdir -p /var/lib/redpanda/data/cloud_storage_cache; chown 101:101 -R /var/lib/redpanda/data/cloud_storage_cache
        env: null
        image: busybox:latest
        name: set-tiered-storage-cache-dir-ownership
        resources: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          value: ${REDPANDA_SAMPLE_LICENSE}
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/23-aks-tiered-storage-with-creds-values.yaml.tpl.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
stringData:
  enterprise-license: ${REDPANDA_SAMPLE_LICENSE}
  kafka-protobuf-git-basicauth-password: ""
  kafka-sasl-aws-msk-iam-secret-key: ""
  kafka-sasl-password: ""
  kafka-schema-registry-password: ""
  kafka-schemaregistry-tls-ca: ""
  kafka-schemaregistry-tls-cert: ""
  kafka-schemaregistry-tls-key: ""
  kafka-tls-ca: ""
  kafka-tls-cert: ""
  kafka-tls-key: ""
  login-github-oauth-client-secret: ""
  login-github-personal-access-token: ""
  login-google-groups-service-account.json: ""
  login-google-oauth-client-secret: ""
  login-jwt-secret: SECRETKEY
  login-oidc-client-secret: ""
  login-okta-client-secret: ""
  login-okta-directory-api-token: ""
  redpanda-admin-api-password: ""
  redpanda-admin-api-tls-ca: ""
  redpanda-admin-api-tls-cert: ""
  redpanda-admin-api-tls-key: ""
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_azure_container: ${TEST_STORAGE_CONTAINER}
    cloud_storage_azure_shared_key: ${TEST_AZURE_SHARED_KEY}
    cloud_storage_azure_storage_account: ${TEST_STORAGE_ACCOUNT}
    cloud_storage_cache_size: 5368709120
    cloud_storage_credentials_source: config_file
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: true
    cloud_storage_segment_max_upload_interval_sec: 1
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=1024M
      - --reserve-memory=100M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: true
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env:
        - name: LOGIN_JWTSECRET
          valueFrom:
            secretKeyRef:
              key: login-jwt-secret
              name: redpanda-console
        - name: LICENSE
          valueFrom:
            secretKeyRef:
              key: enterprise-license
              name: redpanda-console
        envFrom: []
        image: redpandadata/console-unstable:master-8a51854
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/console/secrets
          name: secrets
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: secrets
        secret:
          secretName: redpanda-console
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 6e125110db4b6706f6338010ad36c50316395111aea32b3a9d4f4984a32501f9
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 400m
            memory: 2.0Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/sh
        - -c
        - mkdir -p /var/lib/redpanda/data/cloud_storage_cache; chown 101:101 -R /var/lib/redpanda/data/cloud_storage_cache
        env: null
        image: busybox:latest
        name: set-tiered-storage-cache-dir-ownership
        resources: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
      storageClassName: managed-csi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          value: ${REDPANDA_SAMPLE_LICENSE}
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/23-aks-tiered-storage-without-creds-novalues.yaml.tpl.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_azure_container: ${TEST_STORAGE_CONTAINER}
    cloud_storage_azure_shared_key: ${TEST_AZURE_SHARED_KEY}
    cloud_storage_azure_storage_account: TestForStringThatShouldNotBeWrappedWithQuotes
    cloud_storage_cache_size: 5368709120
    cloud_storage_credentials_source: config_file
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: true
    cloud_storage_segment_max_upload_interval_sec: 1
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=1024M
      - --reserve-memory=100M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: true
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: redpandadata/console-unstable:master-8a51854
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 6e125110db4b6706f6338010ad36c50316395111aea32b3a9d4f4984a32501f9
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 400m
            memory: 2.0Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/sh
        - -c
        - mkdir -p /var/lib/redpanda/data/cloud_storage_cache; chown 101:101 -R /var/lib/redpanda/data/cloud_storage_cache
        env: null
        image: busybox:latest
        name: set-tiered-storage-cache-dir-ownership
        resources: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
      storageClassName: managed-csi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/24-eks-tiered-storage-persistent-with-creds-values.yaml.tpl.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
stringData:
  enterprise-license: ${REDPANDA_SAMPLE_LICENSE}
  kafka-protobuf-git-basicauth-password: ""
  kafka-sasl-aws-msk-iam-secret-key: ""
  kafka-sasl-password: ""
  kafka-schema-registry-password: ""
  kafka-schemaregistry-tls-ca: ""
  kafka-schemaregistry-tls-cert: ""
  kafka-schemaregistry-tls-key: ""
  kafka-tls-ca: ""
  kafka-tls-cert: ""
  kafka-tls-key: ""
  login-github-oauth-client-secret: ""
  login-github-personal-access-token: ""
  login-google-groups-service-account.json: ""
  login-google-oauth-client-secret: ""
  login-jwt-secret: SECRETKEY
  login-oidc-client-secret: ""
  login-okta-client-secret: ""
  login-okta-directory-api-token: ""
  redpanda-admin-api-password: ""
  redpanda-admin-api-tls-ca: ""
  redpanda-admin-api-tls-cert: ""
  redpanda-admin-api-tls-key: ""
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_access_key: ${AWS_ACCESS_KEY_ID}
    cloud_storage_bucket: ${TEST_BUCKET}
    cloud_storage_cache_size: 5368709120
    cloud_storage_credentials_source: config_file
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: true
    cloud_storage_region: ${AWS_REGION}
    cloud_storage_secret_key: ${AWS_SECRET_ACCESS_KEY}
    cloud_storage_segment_max_upload_interval_sec: 1
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env:
        - name: LOGIN_JWTSECRET
          valueFrom:
            secretKeyRef:
              key: login-jwt-secret
              name: redpanda-console
        - name: LICENSE
          valueFrom:
            secretKeyRef:
              key: enterprise-license
              name: redpanda-console
        envFrom: []
        image: redpandadata/console-unstable:master-8a51854
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/console/secrets
          name: secrets
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: secrets
        secret:
          secretName: redpanda-console
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
        - mountPath: /var/lib/redpanda/data/cloud_storage_cache
          name: tiered-storage-dir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/sh
        - -c
        - mkdir -p /var/lib/redpanda/data/cloud_storage_cache; chown 101:101 -R /var/lib/redpanda/data/cloud_storage_cache
        env: null
        image: busybox:latest
        name: set-tiered-storage-cache-dir-ownership
        resources: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /var/lib/redpanda/data
          name: datadir
        - mountPath: /var/lib/redpanda/data/cloud_storage_cache
          name: tiered-storage-dir
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: tiered-storage-dir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 5368709120
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          value: ${REDPANDA_SAMPLE_LICENSE}
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/25-gke-tiered-storage-persistent-with-creds-values.yaml.tpl.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
stringData:
  enterprise-license: ${REDPANDA_SAMPLE_LICENSE}
  kafka-protobuf-git-basicauth-password: ""
  kafka-sasl-aws-msk-iam-secret-key: ""
  kafka-sasl-password: ""
  kafka-schema-registry-password: ""
  kafka-schemaregistry-tls-ca: ""
  kafka-schemaregistry-tls-cert: ""
  kafka-schemaregistry-tls-key: ""
  kafka-tls-ca: ""
  kafka-tls-cert: ""
  kafka-tls-key: ""
  login-github-oauth-client-secret: ""
  login-github-personal-access-token: ""
  login-google-groups-service-account.json: ""
  login-google-oauth-client-secret: ""
  login-jwt-secret: SECRETKEY
  login-oidc-client-secret: ""
  login-okta-client-secret: ""
  login-okta-directory-api-token: ""
  redpanda-admin-api-password: ""
  redpanda-admin-api-tls-ca: ""
  redpanda-admin-api-tls-cert: ""
  redpanda-admin-api-tls-key: ""
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_access_key: ${GCP_ACCESS_KEY_ID}
    cloud_storage_api_endpoint: storage.googleapis.com
    cloud_storage_bucket: ${TEST_BUCKET}
    cloud_storage_cache_size: 5368709120
    cloud_storage_credentials_source: config_file
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: true
    cloud_storage_region: US-WEST1
    cloud_storage_secret_key: ${GCP_SECRET_ACCESS_KEY}
    cloud_storage_segment_max_upload_interval_sec: 1
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=1024M
      - --reserve-memory=100M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: true
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env:
        - name: LOGIN_JWTSECRET
          valueFrom:
            secretKeyRef:
              key: login-jwt-secret
              name: redpanda-console
        - name: LICENSE
          valueFrom:
            secretKeyRef:
              key: enterprise-license
              name: redpanda-console
        envFrom: []
        image: redpandadata/console-unstable:master-8a51854
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/console/secrets
          name: secrets
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: secrets
        secret:
          secretName: redpanda-console
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 6e125110db4b6706f6338010ad36c50316395111aea32b3a9d4f4984a32501f9
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 400m
            memory: 2.0Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
        - mountPath: /var/lib/redpanda/data/cloud_storage_cache
          name: tiered-storage-dir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/sh
        - -c
        - mkdir -p /var/lib/redpanda/data/cloud_storage_cache; chown 101:101 -R /var/lib/redpanda/data/cloud_storage_cache
        env: null
        image: busybox:latest
        name: set-tiered-storage-cache-dir-ownership
        resources: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /var/lib/redpanda/data
          name: datadir
        - mountPath: /var/lib/redpanda/data/cloud_storage_cache
          name: tiered-storage-dir
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: tiered-storage-dir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 5368709120
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          value: ${REDPANDA_SAMPLE_LICENSE}
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/26-aks-tiered-storage-persistent-with-creds-values.yaml.tpl.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
stringData:
  enterprise-license: ${REDPANDA_SAMPLE_LICENSE}
  kafka-protobuf-git-basicauth-password: ""
  kafka-sasl-aws-msk-iam-secret-key: ""
  kafka-sasl-password: ""
  kafka-schema-registry-password: ""
  kafka-schemaregistry-tls-ca: ""
  kafka-schemaregistry-tls-cert: ""
  kafka-schemaregistry-tls-key: ""
  kafka-tls-ca: ""
  kafka-tls-cert: ""
  kafka-tls-key: ""
  login-github-oauth-client-secret: ""
  login-github-personal-access-token: ""
  login-google-groups-service-account.json: ""
  login-google-oauth-client-secret: ""
  login-jwt-secret: SECRETKEY
  login-oidc-client-secret: ""
  login-okta-client-secret: ""
  login-okta-directory-api-token: ""
  redpanda-admin-api-password: ""
  redpanda-admin-api-tls-ca: ""
  redpanda-admin-api-tls-cert: ""
  redpanda-admin-api-tls-key: ""
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_azure_container: ${TEST_STORAGE_CONTAINER}
    cloud_storage_azure_shared_key: ${TEST_AZURE_SHARED_KEY}
    cloud_storage_azure_storage_account: ${TEST_STORAGE_ACCOUNT}
    cloud_storage_cache_size: 5368709120
    cloud_storage_credentials_source: config_file
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: true
    cloud_storage_segment_max_upload_interval_sec: 1
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=1024M
      - --reserve-memory=100M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: true
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env:
        - name: LOGIN_JWTSECRET
          valueFrom:
            secretKeyRef:
              key: login-jwt-secret
              name: redpanda-console
        - name: LICENSE
          valueFrom:
            secretKeyRef:
              key: enterprise-license
              name: redpanda-console
        envFrom: []
        image: redpandadata/console-unstable:master-8a51854
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/console/secrets
          name: secrets
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: secrets
        secret:
          secretName: redpanda-console
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 6e125110db4b6706f6338010ad36c50316395111aea32b3a9d4f4984a32501f9
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 400m
            memory: 2.0Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
        - mountPath: /var/lib/redpanda/data/cloud_storage_cache
          name: tiered-storage-dir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/sh
        - -c
        - mkdir -p /var/lib/redpanda/data/cloud_storage_cache; chown 101:101 -R /var/lib/redpanda/data/cloud_storage_cache
        env: null
        image: busybox:latest
        name: set-tiered-storage-cache-dir-ownership
        resources: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /var/lib/redpanda/data
          name: datadir
        - mountPath: /var/lib/redpanda/data/cloud_storage_cache
          name: tiered-storage-dir
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
      storageClassName: managed-csi
    status: {}
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: tiered-storage-dir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 5368709120
      storageClassName: managed-csi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          value: ${REDPANDA_SAMPLE_LICENSE}
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/26-aks-tiered-storage-persistent-without-creds-novalues.yaml.tpl.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_azure_container: ${TEST_STORAGE_CONTAINER}
    cloud_storage_azure_shared_key: ${TEST_AZURE_SHARED_KEY}
    cloud_storage_azure_storage_account: ${TEST_STORAGE_ACCOUNT}
    cloud_storage_cache_size: 5368709120
    cloud_storage_credentials_source: config_file
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: true
    cloud_storage_segment_max_upload_interval_sec: 1
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=1024M
      - --reserve-memory=100M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: true
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: redpandadata/console-unstable:master-8a51854
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 6e125110db4b6706f6338010ad36c50316395111aea32b3a9d4f4984a32501f9
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 400m
            memory: 2.0Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
        - mountPath: /var/lib/redpanda/data/cloud_storage_cache
          name: tiered-storage-dir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/sh
        - -c
        - mkdir -p /var/lib/redpanda/data/cloud_storage_cache; chown 101:101 -R /var/lib/redpanda/data/cloud_storage_cache
        env: null
        image: busybox:latest
        name: set-tiered-storage-cache-dir-ownership
        resources: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /var/lib/redpanda/data
          name: datadir
        - mountPath: /var/lib/redpanda/data/cloud_storage_cache
          name: tiered-storage-dir
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
      storageClassName: managed-csi
    status: {}
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: tiered-storage-dir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 5368709120
      storageClassName: managed-csi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/27-eks-tiered-storage-persistent-nameoverwrite-with-creds-values.yaml.tpl.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
stringData:
  enterprise-license: ${REDPANDA_SAMPLE_LICENSE}
  kafka-protobuf-git-basicauth-password: ""
  kafka-sasl-aws-msk-iam-secret-key: ""
  kafka-sasl-password: ""
  kafka-schema-registry-password: ""
  kafka-schemaregistry-tls-ca: ""
  kafka-schemaregistry-tls-cert: ""
  kafka-schemaregistry-tls-key: ""
  kafka-tls-ca: ""
  kafka-tls-cert: ""
  kafka-tls-key: ""
  login-github-oauth-client-secret: ""
  login-github-personal-access-token: ""
  login-google-groups-service-account.json: ""
  login-google-oauth-client-secret: ""
  login-jwt-secret: SECRETKEY
  login-oidc-client-secret: ""
  login-okta-client-secret: ""
  login-okta-directory-api-token: ""
  redpanda-admin-api-password: ""
  redpanda-admin-api-tls-ca: ""
  redpanda-admin-api-tls-cert: ""
  redpanda-admin-api-tls-key: ""
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_access_key: ${AWS_ACCESS_KEY_ID}
    cloud_storage_bucket: ${TEST_BUCKET}
    cloud_storage_cache_size: 5368709120
    cloud_storage_credentials_source: config_file
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: true
    cloud_storage_region: ${AWS_REGION}
    cloud_storage_secret_key: ${AWS_SECRET_ACCESS_KEY}
    cloud_storage_segment_max_upload_interval_sec: 1
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env:
        - name: LOGIN_JWTSECRET
          valueFrom:
            secretKeyRef:
              key: login-jwt-secret
              name: redpanda-console
        - name: LICENSE
          valueFrom:
            secretKeyRef:
              key: enterprise-license
              name: redpanda-console
        envFrom: []
        image: redpandadata/console-unstable:master-8a51854
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/console/secrets
          name: secrets
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: secrets
        secret:
          secretName: redpanda-console
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
        - mountPath: /var/lib/redpanda/data/cloud_storage_cache
          name: shadow-index-cache
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/sh
        - -c
        - mkdir -p /var/lib/redpanda/data/cloud_storage_cache; chown 101:101 -R /var/lib/redpanda/data/cloud_storage_cache
        env: null
        image: busybox:latest
        name: set-tiered-storage-cache-dir-ownership
        resources: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /var/lib/redpanda/data
          name: datadir
        - mountPath: /var/lib/redpanda/data/cloud_storage_cache
          name: shadow-index-cache
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: shadow-index-cache
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 5368709120
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          value: ${REDPANDA_SAMPLE_LICENSE}
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/28-gke-tiered-storage-persistent-nameoverwrite-with-creds-values.yaml.tpl.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
stringData:
  enterprise-license: ${REDPANDA_SAMPLE_LICENSE}
  kafka-protobuf-git-basicauth-password: ""
  kafka-sasl-aws-msk-iam-secret-key: ""
  kafka-sasl-password: ""
  kafka-schema-registry-password: ""
  kafka-schemaregistry-tls-ca: ""
  kafka-schemaregistry-tls-cert: ""
  kafka-schemaregistry-tls-key: ""
  kafka-tls-ca: ""
  kafka-tls-cert: ""
  kafka-tls-key: ""
  login-github-oauth-client-secret: ""
  login-github-personal-access-token: ""
  login-google-groups-service-account.json: ""
  login-google-oauth-client-secret: ""
  login-jwt-secret: SECRETKEY
  login-oidc-client-secret: ""
  login-okta-client-secret: ""
  login-okta-directory-api-token: ""
  redpanda-admin-api-password: ""
  redpanda-admin-api-tls-ca: ""
  redpanda-admin-api-tls-cert: ""
  redpanda-admin-api-tls-key: ""
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_access_key: ${GCP_ACCESS_KEY_ID}
    cloud_storage_api_endpoint: storage.googleapis.com
    cloud_storage_bucket: ${TEST_BUCKET}
    cloud_storage_cache_size: 5368709120
    cloud_storage_credentials_source: config_file
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: true
    cloud_storage_region: US-WEST1
    cloud_storage_secret_key: ${GCP_SECRET_ACCESS_KEY}
    cloud_storage_segment_max_upload_interval_sec: 1
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=1024M
      - --reserve-memory=100M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: true
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env:
        - name: LOGIN_JWTSECRET
          valueFrom:
            secretKeyRef:
              key: login-jwt-secret
              name: redpanda-console
        - name: LICENSE
          valueFrom:
            secretKeyRef:
              key: enterprise-license
              name: redpanda-console
        envFrom: []
        image: redpandadata/console-unstable:master-8a51854
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/console/secrets
          name: secrets
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: secrets
        secret:
          secretName: redpanda-console
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 6e125110db4b6706f6338010ad36c50316395111aea32b3a9d4f4984a32501f9
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 400m
            memory: 2.0Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
        - mountPath: /var/lib/redpanda/data/cloud_storage_cache
          name: shadow-index-cache
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/sh
        - -c
        - mkdir -p /var/lib/redpanda/data/cloud_storage_cache; chown 101:101 -R /var/lib/redpanda/data/cloud_storage_cache
        env: null
        image: busybox:latest
        name: set-tiered-storage-cache-dir-ownership
        resources: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /var/lib/redpanda/data
          name: datadir
        - mountPath: /var/lib/redpanda/data/cloud_storage_cache
          name: shadow-index-cache
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: shadow-index-cache
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 5368709120
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          value: ${REDPANDA_SAMPLE_LICENSE}
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/29-aks-tiered-storage-persistent-nameoverwrite-with-creds-values.yaml.tpl.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
stringData:
  enterprise-license: ${REDPANDA_SAMPLE_LICENSE}
  kafka-protobuf-git-basicauth-password: ""
  kafka-sasl-aws-msk-iam-secret-key: ""
  kafka-sasl-password: ""
  kafka-schema-registry-password: ""
  kafka-schemaregistry-tls-ca: ""
  kafka-schemaregistry-tls-cert: ""
  kafka-schemaregistry-tls-key: ""
  kafka-tls-ca: ""
  kafka-tls-cert: ""
  kafka-tls-key: ""
  login-github-oauth-client-secret: ""
  login-github-personal-access-token: ""
  login-google-groups-service-account.json: ""
  login-google-oauth-client-secret: ""
  login-jwt-secret: SECRETKEY
  login-oidc-client-secret: ""
  login-okta-client-secret: ""
  login-okta-directory-api-token: ""
  redpanda-admin-api-password: ""
  redpanda-admin-api-tls-ca: ""
  redpanda-admin-api-tls-cert: ""
  redpanda-admin-api-tls-key: ""
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_azure_container: ${TEST_STORAGE_CONTAINER}
    cloud_storage_azure_shared_key: ${TEST_AZURE_SHARED_KEY}
    cloud_storage_azure_storage_account: ${TEST_STORAGE_ACCOUNT}
    cloud_storage_cache_size: 5368709120
    cloud_storage_credentials_source: config_file
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: true
    cloud_storage_segment_max_upload_interval_sec: 1
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=1024M
      - --reserve-memory=100M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: true
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env:
        - name: LOGIN_JWTSECRET
          valueFrom:
            secretKeyRef:
              key: login-jwt-secret
              name: redpanda-console
        - name: LICENSE
          valueFrom:
            secretKeyRef:
              key: enterprise-license
              name: redpanda-console
        envFrom: []
        image: redpandadata/console-unstable:master-8a51854
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/console/secrets
          name: secrets
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: secrets
        secret:
          secretName: redpanda-console
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 6e125110db4b6706f6338010ad36c50316395111aea32b3a9d4f4984a32501f9
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 400m
            memory: 2.0Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
        - mountPath: /var/lib/redpanda/data/cloud_storage_cache
          name: shadow-index-cache
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/sh
        - -c
        - mkdir -p /var/lib/redpanda/data/cloud_storage_cache; chown 101:101 -R /var/lib/redpanda/data/cloud_storage_cache
        env: null
        image: busybox:latest
        name: set-tiered-storage-cache-dir-ownership
        resources: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /var/lib/redpanda/data
          name: datadir
        - mountPath: /var/lib/redpanda/data/cloud_storage_cache
          name: shadow-index-cache
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
      storageClassName: managed-csi
    status: {}
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: shadow-index-cache
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 5368709120
      storageClassName: managed-csi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          value: ${REDPANDA_SAMPLE_LICENSE}
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/29-aks-tiered-storage-persistent-nameoverwrite-without-creds-novalues.yaml.tpl.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_azure_container: ${TEST_STORAGE_CONTAINER}
    cloud_storage_azure_shared_key: ${TEST_AZURE_SHARED_KEY}
    cloud_storage_azure_storage_account: ${TEST_STORAGE_ACCOUNT}
    cloud_storage_cache_size: 5368709120
    cloud_storage_credentials_source: config_file
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: true
    cloud_storage_segment_max_upload_interval_sec: 1
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=1024M
      - --reserve-memory=100M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: true
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: redpandadata/console-unstable:master-8a51854
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 6e125110db4b6706f6338010ad36c50316395111aea32b3a9d4f4984a32501f9
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 400m
            memory: 2.0Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
        - mountPath: /var/lib/redpanda/data/cloud_storage_cache
          name: shadow-index-cache
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/sh
        - -c
        - mkdir -p /var/lib/redpanda/data/cloud_storage_cache; chown 101:101 -R /var/lib/redpanda/data/cloud_storage_cache
        env: null
        image: busybox:latest
        name: set-tiered-storage-cache-dir-ownership
        resources: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /var/lib/redpanda/data
          name: datadir
        - mountPath: /var/lib/redpanda/data/cloud_storage_cache
          name: shadow-index-cache
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
      storageClassName: managed-csi
    status: {}
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: shadow-index-cache
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 5368709120
      storageClassName: managed-csi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/30-additional-flags-override-novalues.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --smp=99
      - --reserve-memory=9999
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 154bbf670b25a84e084af1f1a6777450206fdb2f3014a881f8350fe0371cdc54
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/31-overwrite-statefulset-pod-labels-values.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        azure.workload.identity/use: "true"
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/32-statefulset-podspec-novalues.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          value: This is an override and will break the deployment
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        - name: EXTRA_ENV_VAR
          value: THIS_IS_AN_EXAMPLE
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/33-advertised-ports-values.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE="ext2-$POD_ORDINAL"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext2\",\"port\":22220}")

    PREFIX_TEMPLATE="ext2-$POD_ORDINAL"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext2\",\"port\":22221}")

    PREFIX_TEMPLATE="ext2-$POD_ORDINAL"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext2\",\"port\":22222}")

    PREFIX_TEMPLATE="ext2-$POD_ORDINAL"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext2\",\"port\":22223}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[2] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE="ext3-$POD_ORDINAL"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext3\",\"port\":33330}")

    PREFIX_TEMPLATE="ext3-$POD_ORDINAL"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext3\",\"port\":33331}")

    PREFIX_TEMPLATE="ext3-$POD_ORDINAL"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext3\",\"port\":33332}")

    PREFIX_TEMPLATE="ext3-$POD_ORDINAL"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext3\",\"port\":33333}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[3] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE="ext4-$POD_ORDINAL"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext4\",\"port\":44440}")

    PREFIX_TEMPLATE="ext4-$POD_ORDINAL"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext4\",\"port\":44441}")

    PREFIX_TEMPLATE="ext4-$POD_ORDINAL"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext4\",\"port\":44442}")

    PREFIX_TEMPLATE="ext4-$POD_ORDINAL"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext4\",\"port\":44443}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[2] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE="ext5-$POD_ORDINAL"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext5\",\"port\":55550}")

    PREFIX_TEMPLATE="ext5-$POD_ORDINAL"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext5\",\"port\":55551}")

    PREFIX_TEMPLATE="ext5-$POD_ORDINAL"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext5\",\"port\":55552}")

    PREFIX_TEMPLATE="ext5-$POD_ORDINAL"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"ext5\",\"port\":55553}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[3] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      - address: 0.0.0.0
        name: ext4
        port: 44449
      - address: 0.0.0.0
        name: ext5
        port: 55559
      pandaproxy_api_tls: null
    pandaproxy_client:
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-3.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      - address: 0.0.0.0
        name: ext2
        port: 22229
      - address: 0.0.0.0
        name: ext3
        port: 33339
      kafka_api_tls: null
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-3.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        - redpanda-3.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        - redpanda-3.redpanda.default.svc.cluster.local.:9093
        tls: null
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        - redpanda-3.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-3.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      - redpanda-3:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      - redpanda-3:31092
      tls: null
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      - redpanda-3:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      - redpanda-3.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-3.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: ""
        certFilepath: ""
        enabled: false
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: kafka-ext2
    nodePort: 22220
    port: 22229
    protocol: TCP
    targetPort: 0
  - name: kafka-ext3
    nodePort: 33330
    port: 33339
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: http-ext4
    nodePort: 44440
    port: 44449
    protocol: TCP
    targetPort: 0
  - name: http-ext5
    nodePort: 55550
    port: 55559
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: 0fa9347997916af52bc48424c8328cbec3039389d78a7444dab61e8c0d1ee8c0
        checksum/config: 0fa9347997916af52bc48424c8328cbec3039389d78a7444dab61e8c0d1ee8c0
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 4
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 52c4224ef1d61d20c262460abf0216fe9307e5d6a7f850500acf83a9fae73176
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 44449
          name: http-ext4
        - containerPort: 55559
          name: http-ext5
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 22229
          name: kafka-ext2
        - containerPort: 33339
          name: kafka-ext3
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/33-pod-selector-lables-novalues.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
      redpanda.com/testing: "true"
      redpanda.com/testing-samples: sample
      redpanda.com/testing-samples-two: two
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
    redpanda.com/testing: "true"
    redpanda.com/testing-samples: sample
    redpanda.com/testing-samples-two: two
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
    redpanda.com/testing: "true"
    redpanda.com/testing-samples: sample
    redpanda.com/testing-samples-two: two
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/testing: "true"
      redpanda.com/testing-samples: sample
      redpanda.com/testing-samples-two: two
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
        redpanda.com/testing: "true"
        redpanda.com/testing-samples: sample
        redpanda.com/testing-samples-two: two
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
                redpanda.com/testing: "true"
                redpanda.com/testing-samples: sample
                redpanda.com/testing-samples-two: two
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
            redpanda.com/testing: "true"
            redpanda.com/testing-samples: sample
            redpanda.com/testing-samples-two: two
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/34-security-contexts-novalues.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
rules:
- apiGroups:
  - ""
  resources:
  - nodes
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - persistentvolumes
  verbs:
  - delete
  - get
  - list
  - patch
  - update
  - watch
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
rules:
- apiGroups:
  - ""
  resources:
  - nodes
  verbs:
  - get
  - list
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk-bundle
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  - endpoints
  - events
  - limitranges
  - persistentvolumeclaims
  - pods
  - pods/log
  - replicationcontrollers
  - resourcequotas
  - serviceaccounts
  - services
  verbs:
  - get
  - list
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: redpanda-sidecar-controllers
subjects:
- kind: ServiceAccount
  name: default
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: redpanda
subjects:
- kind: ServiceAccount
  name: default
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk-bundle
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: redpanda-rpk-bundle
subjects:
- kind: ServiceAccount
  name: default
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
  namespace: default
rules:
- apiGroups:
  - apps
  resources:
  - statefulsets/status
  verbs:
  - patch
  - update
- apiGroups:
  - ""
  resources:
  - secrets
  - pods
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - apps
  resources:
  - statefulsets
  verbs:
  - get
  - patch
  - update
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - persistentvolumeclaims
  verbs:
  - delete
  - get
  - list
  - patch
  - update
  - watch
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
  namespace: default
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: redpanda-sidecar-controllers
subjects:
- kind: ServiceAccount
  name: default
  namespace: default
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 2222
          runAsUser: 1111
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext:
          allowPrivilegeEscalation: false
          privileged: false
          readOnlyRootFilesystem: false
          runAsGroup: 7777
          runAsNonRoot: true
          runAsUser: 8888
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      - args:
        - --operator-mode=false
        - --namespace=default
        - --health-probe-bind-address=:8085
        - --metrics-bind-address=:9082
        - --pprof-bind-address=:9083
        - --additional-controllers=all
        command:
        - /manager
        env:
        - name: REDPANDA_HELM_RELEASE_NAME
          value: redpanda
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: redpanda-controllers
        resources: {}
        securityContext:
          allowPrivilegeEscalation: false
          privileged: false
          readOnlyRootFilesystem: false
          runAsGroup: 1234
          runAsNonRoot: true
          runAsUser: 5678
        volumeMounts:
        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
          name: kube-api-access
          readOnly: true
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 2222
          runAsNonRoot: null
          runAsUser: 1111
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 3333
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
      - name: kube-api-access
        projected:
          defaultMode: 420
          sources:
          - serviceAccountToken:
              expirationSeconds: 3607
              path: token
          - configMap:
              items:
              - key: ca.crt
                path: ca.crt
              name: kube-root-ca.crt
          - downwardAPI:
              items:
              - fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.namespace
                path: namespace
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 2222
          runAsUser: 1111
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 3333
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/34-statefulset-sidecars-novalues.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-fs-validator
  namespace: default
stringData:
  fsValidator.sh: |-
    set -e
    EXPECTED_FS_TYPE=$1

    DATA_DIR="/var/lib/redpanda/data"
    TEST_FILE="testfile"

    echo "checking data directory exist..."
    if [ ! -d "${DATA_DIR}" ]; then
      echo "data directory does not exists, exiting"
      exit 1
    fi

    echo "checking filesystem type..."
    FS_TYPE=$(df -T $DATA_DIR  | tail -n +2 | awk '{print $2}')

    if [ "${FS_TYPE}" != "${EXPECTED_FS_TYPE}" ]; then
      echo "file system found to be ${FS_TYPE} when expected ${EXPECTED_FS_TYPE}"
      exit 1
    fi

    echo "checking if able to create a test file..."

    touch ${DATA_DIR}/${TEST_FILE}
    result=$(touch ${DATA_DIR}/${TEST_FILE} 2> /dev/null; echo $?)
    if [ "${result}" != "0" ]; then
      echo "could not write testfile, may not have write permission"
      exit 1
    fi

    echo "checking if able to delete a test file..."

    result=$(rm ${DATA_DIR}/${TEST_FILE} 2> /dev/null; echo $?)
    if [ "${result}" != "0" ]; then
      echo "could not delete testfile"
      exit 1
    fi

    echo "passed"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
rules:
- apiGroups:
  - ""
  resources:
  - nodes
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - persistentvolumes
  verbs:
  - delete
  - get
  - list
  - patch
  - update
  - watch
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: redpanda-sidecar-controllers
subjects:
- kind: ServiceAccount
  name: default
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
  namespace: default
rules:
- apiGroups:
  - apps
  resources:
  - statefulsets/status
  verbs:
  - patch
  - update
- apiGroups:
  - ""
  resources:
  - secrets
  - pods
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - apps
  resources:
  - statefulsets
  verbs:
  - get
  - patch
  - update
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - persistentvolumeclaims
  verbs:
  - delete
  - get
  - list
  - patch
  - update
  - watch
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
  namespace: default
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: redpanda-sidecar-controllers
subjects:
- kind: ServiceAccount
  name: default
  namespace: default
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/sh
        - -c
        - chown 101:101 -R /var/lib/redpanda/data
        env: null
        image: busybox:latest
        name: set-datadir-ownership
        resources: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/fs-validator/scripts/fsValidator.sh
          xfs & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: fs-validator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/secrets/fs-validator/scripts/
          name: redpanda-fs-validator
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: redpanda-fs-validator
        secret:
          defaultMode: 509
          secretName: redpanda-fs-validator
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/35-connectors-novalues.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    connect:
      clusters:
      - name: connectors
        password: ""
        tls:
          caFilepath: ""
          certFilepath: ""
          enabled: false
          insecureSkipTlsVerify: false
          keyFilepath: ""
        token: ""
        url: http://redpanda-connectors.default.svc.cluster.local:8083
        username: ""
      connectTimeout: 0
      enabled: true
      readTimeout: 0
      requestTimeout: 0
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/connectors/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: connectors
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: connectors
    helm.sh/chart: connectors-0.1.14
  name: redpanda-connectors
spec:
  ipFamilies:
  - IPv4
  ipFamilyPolicy: SingleStack
  ports:
  - name: rest-api
    port: 8083
    protocol: TCP
    targetPort: 8083
  - name: prometheus
    port: 9404
    protocol: TCP
    targetPort: 9404
  selector:
    app.kubernetes.io/component: connectors
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: connectors
  sessionAffinity: None
  type: ClusterIP
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: 1894d433f8a13a5d76ec09415a79b012be1f5fd3c528f7e41b040909a8092a28
        checksum/config: 1894d433f8a13a5d76ec09415a79b012be1f5fd3c528f7e41b040909a8092a28
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: connectors
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: connectors
    helm.sh/chart: connectors-0.1.14
  name: redpanda-connectors
spec:
  progressDeadlineSeconds: 600
  replicas: 2
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app.kubernetes.io/component: connectors
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: connectors
  strategy:
    type: RollingUpdate
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: connectors
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: connectors
    spec:
      affinity:
        nodeAffinity: {}
        podAffinity: {}
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: connectors
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: connectors
            namespaces:
            - default
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command: null
        env:
        - name: CONNECT_CONFIGURATION
          value: |-
            rest.advertised.port=8083
            rest.port=8083
            key.converter=org.apache.kafka.connect.converters.ByteArrayConverter
            value.converter=org.apache.kafka.connect.converters.ByteArrayConverter
            group.id=connectors-cluster
            offset.storage.topic=_internal_connectors_offsets
            config.storage.topic=_internal_connectors_configs
            status.storage.topic=_internal_connectors_status
            offset.storage.redpanda.remote.read=false
            offset.storage.redpanda.remote.write=false
            config.storage.redpanda.remote.read=false
            config.storage.redpanda.remote.write=false
            status.storage.redpanda.remote.read=false
            status.storage.redpanda.remote.write=false
            offset.storage.replication.factor=-1
            config.storage.replication.factor=-1
            status.storage.replication.factor=-1
            producer.linger.ms=1
            producer.batch.size=131072
            config.providers=file,secretsManager,env
            config.providers.file.class=org.apache.kafka.common.config.provider.FileConfigProvider
            config.providers.env.class=org.apache.kafka.common.config.provider.EnvVarConfigProvider
        - name: CONNECT_ADDITIONAL_CONFIGURATION
          value: ""
        - name: CONNECT_BOOTSTRAP_SERVERS
          value: redpanda-0.redpanda.default.svc.cluster.local.:9093,redpanda-1.redpanda.default.svc.cluster.local.:9093,redpanda-2.redpanda.default.svc.cluster.local.:9093
        - name: CONNECT_GC_LOG_ENABLED
          value: "false"
        - name: CONNECT_HEAP_OPTS
          value: -Xms256M -Xmx2G
        - name: CONNECT_LOG_LEVEL
          value: warn
        - name: CONNECT_TLS_ENABLED
          value: "true"
        - name: CONNECT_TRUSTED_CERTS
          value: ca/ca.crt
        envFrom: []
        image: docker.redpanda.com/redpandadata/connectors:v1.0.31
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /
            port: rest-api
            scheme: HTTP
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: connectors-cluster
        ports:
        - containerPort: 8083
          name: rest-api
          protocol: TCP
        - containerPort: 9404
          name: prometheus
          protocol: TCP
        readinessProbe:
          failureThreshold: 2
          httpGet:
            path: /connectors
            port: rest-api
            scheme: HTTP
          initialDelaySeconds: 60
          periodSeconds: 10
          successThreshold: 3
          timeoutSeconds: 5
        resources:
          limits:
            cpu: "1"
            memory: 2350Mi
          requests:
            cpu: "1"
            memory: 2350Mi
        securityContext:
          allowPrivilegeEscalation: false
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /opt/kafka/connect-certs/ca
          name: truststore
        - mountPath: /tmp
          name: rp-connect-tmp
      dnsPolicy: ClusterFirst
      imagePullSecrets: []
      nodeSelector: {}
      restartPolicy: Always
      schedulerName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
        runAsUser: 101
      serviceAccountName: default
      terminationGracePeriodSeconds: 30
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: connectors
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: connectors
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: truststore
        secret:
          defaultMode: 292
          secretName: redpanda-default-cert
      - emptyDir:
          medium: Memory
          sizeLimit: 5Mi
        name: rp-connect-tmp
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/36-single-external-address-with-template-domain-novalues.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.REDPANDAREDPANDAREDPANDA-testing\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.REDPANDAREDPANDAREDPANDA-testing\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.REDPANDAREDPANDAREDPANDA-testing\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.REDPANDAREDPANDAREDPANDA-testing\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.REDPANDAREDPANDAREDPANDA-testing\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.REDPANDAREDPANDAREDPANDA-testing\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0.REDPANDAREDPANDAREDPANDA-testing:31644
      - redpanda-1.REDPANDAREDPANDAREDPANDA-testing:31644
      - redpanda-2.REDPANDAREDPANDAREDPANDA-testing:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0.REDPANDAREDPANDAREDPANDA-testing:31092
      - redpanda-1.REDPANDAREDPANDAREDPANDA-testing:31092
      - redpanda-2.REDPANDAREDPANDAREDPANDA-testing:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0.REDPANDAREDPANDAREDPANDA-testing:30081
      - redpanda-1.REDPANDAREDPANDAREDPANDA-testing:30081
      - redpanda-2.REDPANDAREDPANDAREDPANDA-testing:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 4dd7f27eb2c63130aae3cb9fb56e906fe64581f6bf10fbfd9cbd78af4538ad4f
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  - REDPANDAREDPANDAREDPANDA-testing
  - '*.REDPANDAREDPANDAREDPANDA-testing'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  - REDPANDAREDPANDAREDPANDA-testing
  - '*.REDPANDAREDPANDAREDPANDA-testing'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/37-internal-service-changed-name-and-annotations-novalues.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
      test: test
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.change-name.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.change-name.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.change-name.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.change-name.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.change-name.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.change-name.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.change-name.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.change-name.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.change-name.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.change-name.default.svc.cluster.local.:9644
        - redpanda-1.change-name.default.svc.cluster.local.:9644
        - redpanda-2.change-name.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.change-name.default.svc.cluster.local.:9093
        - redpanda-1.change-name.default.svc.cluster.local.:9093
        - redpanda-2.change-name.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.change-name.default.svc.cluster.local.:8081
        - redpanda-1.change-name.default.svc.cluster.local.:8081
        - redpanda-2.change-name.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.change-name.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.change-name.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.change-name.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.change-name.default.svc.cluster.local.:9093
      - redpanda-1.change-name.default.svc.cluster.local.:9093
      - redpanda-2.change-name.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.change-name.default.svc.cluster.local.:8081
        - https://redpanda-1.change-name.default.svc.cluster.local.:8081
        - https://redpanda-2.change-name.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://change-name.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: change-name-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
    test: test
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations:
    test: test
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "true"
  name: change-name
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
    test: test
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: 20cd6cbc36825de9d72e07cfd13dd0f51a51c2d4e921ca7be261fe8902edd674
        checksum/config: 20cd6cbc36825de9d72e07cfd13dd0f51a51c2d4e921ca7be261fe8902edd674
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      test: test
  serviceName: change-name
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: d36e92a8c61e842dcb008c69f388e92e82e8bac4773ca194fac0b13ab573a5d7
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
        test: test
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
                test: test
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).change-name.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.change-name.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.change-name.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
            test: test
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.change-name.default.svc.cluster.local
  - redpanda-cluster.change-name.default.svc
  - redpanda-cluster.change-name.default
  - '*.redpanda-cluster.change-name.default.svc.cluster.local'
  - '*.redpanda-cluster.change-name.default.svc'
  - '*.redpanda-cluster.change-name.default'
  - change-name.default.svc.cluster.local
  - change-name.default.svc
  - change-name.default
  - '*.change-name.default.svc.cluster.local'
  - '*.change-name.default.svc'
  - '*.change-name.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.change-name.default.svc.cluster.local
  - redpanda-cluster.change-name.default.svc
  - redpanda-cluster.change-name.default
  - '*.redpanda-cluster.change-name.default.svc.cluster.local'
  - '*.redpanda-cluster.change-name.default.svc'
  - '*.redpanda-cluster.change-name.default'
  - change-name.default.svc.cluster.local
  - change-name.default.svc
  - change-name.default
  - '*.change-name.default.svc.cluster.local'
  - '*.change-name.default.svc'
  - '*.change-name.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  endpoints:
  - enableHttp2: null
    interval: 2m
    path: /public_metrics
    port: admin
    scheme: https
    tlsConfig:
      ca: {}
      cert: {}
      insecureSkipVerify: true
  namespaceSelector: {}
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      monitoring.redpanda.com/enabled: "true"
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/38-post-install-upgrade-merges-novalues.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: topology.kubernetes.io/zone
                operator: In
                values:
                - antarctica-east1
                - antarctica-west1
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 1000
          runAsUser: 1000
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 1000
          runAsNonRoot: null
          runAsUser: 1000
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations:
      - effect: NoSchedule
        key: example-key
        operator: Exists
      - effect: NoExecute
        key: example-key-2
        operator: Exists
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: topology.kubernetes.io/zone
                operator: In
                values:
                - arctic-east1
                - arctic-west1
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources:
          limits:
            cpu: 200m
          requests:
            cpu: 2
        securityContext:
          runAsGroup: 1000
          runAsUser: 2000
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations:
      - effect: NoSchedule
        key: example-key
        operator: Exists
      - effect: NoExecute
        key: example-key-2
        operator: Exists
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/38-post-install-upgrade-no-overrides-novalues.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: topology.kubernetes.io/zone
                operator: In
                values:
                - antarctica-east1
                - antarctica-west1
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 1000
          runAsUser: 1000
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 1000
          runAsNonRoot: null
          runAsUser: 1000
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations:
      - effect: NoSchedule
        key: example-key
        operator: Exists
      - effect: NoExecute
        key: example-key-2
        operator: Exists
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: topology.kubernetes.io/zone
                operator: In
                values:
                - antarctica-east1
                - antarctica-west1
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources:
          limits:
            cpu: 200m
            memory: 1Gi
          requests:
            cpu: 2
            memory: 2Gi
        securityContext:
          runAsGroup: 1000
          runAsUser: 1000
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations:
      - effect: NoSchedule
        key: example-key
        operator: Exists
      - effect: NoExecute
        key: example-key-2
        operator: Exists
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/39-default-image-pull-secrets-novalues.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      imagePullSecrets:
      - name: secret-1
      - name: secret-2
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      imagePullSecrets:
      - name: secret-1
      - name: secret-2
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/40-empty-string-tls-novalues.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="http://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail  ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent  ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX}  ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX}  ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9092}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 5368709120
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        authentication_method: none
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls: null
    pandaproxy_client:
      broker_tls:
        cert_file: /etc/tls/certs/redpanda-client/tls.crt
        enabled: true
        key_file: /etc/tls/certs/redpanda-client/tls.key
        require_client_auth: true
        truststore_file: /etc/tls/certs/kafka-internal-0/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9092
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9092
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9092
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls: null
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        authentication_method: none
        name: internal
        port: 9092
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/kafka-internal-0/tls.crt
        enabled: true
        key_file: /etc/tls/certs/kafka-internal-0/tls.key
        name: internal
        require_client_auth: true
        truststore_file: /etc/tls/certs/kafka-internal-0/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=trace
      - --memory=1638M
      - --reserve-memory=204M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls: null
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9092
        - redpanda-1.redpanda.default.svc.cluster.local.:9092
        - redpanda-2.redpanda.default.svc.cluster.local.:9092
        tls:
          ca_file: /etc/tls/certs/kafka-internal-0/ca.crt
          cert_file: /etc/tls/certs/redpanda-client/tls.crt
          key_file: /etc/tls/certs/redpanda-client/tls.key
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        cert_file: /etc/tls/certs/redpanda-client/tls.crt
        enabled: true
        key_file: /etc/tls/certs/redpanda-client/tls.key
        require_client_auth: true
        truststore_file: /etc/tls/certs/kafka-internal-0/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9092
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9092
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9092
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls: null
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
        cert_file: /etc/tls/certs/redpanda-client/tls.crt
        key_file: /etc/tls/certs/redpanda-client/tls.key
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9092
    protocol: TCP
    targetPort: 9092
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: e4a33e06a3a848411b8c96665793b25fe19f6633e1dba4696815c7c709e55670
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.2.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5  "http://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9092
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2Gi
          requests:
            cpu: 1
            memory: 2Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5  "http://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/tls/certs/kafka-internal-0
          name: redpanda-kafka-internal-0-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.2.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/tls/certs/kafka-internal-0
          name: redpanda-kafka-internal-0-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.2.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/tls/certs/kafka-internal-0
          name: redpanda-kafka-internal-0-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.2.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/tls/certs/kafka-internal-0
          name: redpanda-kafka-internal-0-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: redpanda-kafka-internal-0-cert
        secret:
          defaultMode: 288
          secretName: redpanda-kafka-internal-0-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 100Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-kafka-internal-0-root-certificate
  namespace: default
spec:
  commonName: redpanda-kafka-internal-0-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-kafka-internal-0-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-kafka-internal-0-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-kafka-internal-0-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-kafka-internal-0-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-kafka-internal-0-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-client
spec:
  commonName: redpanda-client
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-kafka-internal-0-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-client
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-kafka-internal-0-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-kafka-internal-0-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-kafka-internal-0-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/tls/certs/kafka-internal-0
          name: redpanda-kafka-internal-0-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: redpanda-kafka-internal-0-cert
        secret:
          defaultMode: 288
          secretName: redpanda-kafka-internal-0-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/41-external-issuers-novalues.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames: null
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cas-issuer.jetstack.io
    kind: GoogleCASClusterIssuer
    name: my-cas-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames: null
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cas-issuer.jetstack.io
    kind: GoogleCASClusterIssuer
    name: my-cas-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/96-audit-logging-values.yaml.tpl.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-users
  namespace: default
stringData:
  users.txt: admin:change-me:SCRAM-SHA-512
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    while true; do
      echo "RUNNING: Monitoring and Updating SASL users"
      USERS_DIR="/etc/secrets/users"

      new_users_list(){
        LIST=$1
        NEW_USER=$2
        if [[ -n "${LIST}" ]]; then
          LIST="${NEW_USER},${LIST}"
        else
          LIST="${NEW_USER}"
        fi

        echo "${LIST}"
      }

      process_users() {
        USERS_DIR=${1-"/etc/secrets/users"}
        USERS_FILE=$(find ${USERS_DIR}/* -print)
        USERS_LIST="kubernetes-controller"
        READ_LIST_SUCCESS=0
        # Read line by line, handle a missing EOL at the end of file
        while read p || [ -n "$p" ] ; do
          IFS=":" read -r USER_NAME PASSWORD MECHANISM <<< $p
          # Do not process empty lines
          if [ -z "$USER_NAME" ]; then
            continue
          fi
          if [[ "${USER_NAME// /}" != "$USER_NAME" ]]; then
            continue
          fi
          echo "Creating user ${USER_NAME}..."
          MECHANISM=${MECHANISM:-SCRAM-SHA-512}
          creation_result=$(rpk acl user create ${USER_NAME} -p ${PASSWORD} --mechanism ${MECHANISM} 2>&1) && creation_result_exit_code=$? || creation_result_exit_code=$?  # On a non-success exit code
          if [[ $creation_result_exit_code -ne 0 ]]; then
            # Check if the stderr contains "User already exists"
            # this error occurs when password has changed
            if [[ $creation_result == *"User already exists"* ]]; then
              echo "Update user ${USER_NAME}"
              # we will try to update by first deleting
              deletion_result=$(rpk acl user delete ${USER_NAME} 2>&1) && deletion_result_exit_code=$? || deletion_result_exit_code=$?
              if [[ $deletion_result_exit_code -ne 0 ]]; then
                echo "deletion of user ${USER_NAME} failed: ${deletion_result}"
                READ_LIST_SUCCESS=1
                break
              fi
              # Now we update the user
              update_result=$(rpk acl user create ${USER_NAME} -p ${PASSWORD} --mechanism ${MECHANISM} 2>&1) && update_result_exit_code=$? || update_result_exit_code=$?  # On a non-success exit code
              if [[ $update_result_exit_code -ne 0 ]]; then
                echo "updating user ${USER_NAME} failed: ${update_result}"
                READ_LIST_SUCCESS=1
                break
              else
                echo "Updated user ${USER_NAME}..."
                USERS_LIST=$(new_users_list "${USERS_LIST}" "${USER_NAME}")
              fi
            else
              # Another error occurred, so output the original message and exit code
              echo "error creating user ${USER_NAME}: ${creation_result}"
              READ_LIST_SUCCESS=1
              break
            fi
          # On a success, the user was created so output that
          else
            echo "Created user ${USER_NAME}..."
            USERS_LIST=$(new_users_list "${USERS_LIST}" "${USER_NAME}")
          fi
        done < $USERS_FILE

        if [[ -n "${USERS_LIST}" && ${READ_LIST_SUCCESS} ]]; then
          echo "Setting superusers configurations with users [${USERS_LIST}]"
          superuser_result=$(rpk cluster config set superusers [${USERS_LIST}] 2>&1) && superuser_result_exit_code=$? || superuser_result_exit_code=$?
          if [[ $superuser_result_exit_code -ne 0 ]]; then
              echo "Setting superusers configurations failed: ${superuser_result}"
          else
              echo "Completed setting superusers configurations"
          fi
        fi
      }

      # before we do anything ensure we have the bootstrap user
      echo "Ensuring bootstrap user ${RPK_USER}..."
      creation_result=$(rpk acl user create ${RPK_USER} -p ${RPK_PASS} --mechanism ${RPK_SASL_MECHANISM} 2>&1) && creation_result_exit_code=$? || creation_result_exit_code=$?  # On a non-success exit code
      if [[ $creation_result_exit_code -ne 0 ]]; then
        if [[ $creation_result == *"User already exists"* ]]; then
          echo "Bootstrap user already created"
        else
          echo "error creating user ${RPK_USER}: ${creation_result}"
        fi
      fi

      # first time processing
      process_users $USERS_DIR

      # subsequent changes detected here
      # watching delete_self as documented in https://ahmet.im/blog/kubernetes-inotify/
      USERS_FILE=$(find ${USERS_DIR}/* -print)
      while RES=$(inotifywait -q -e delete_self ${USERS_FILE}); do
        process_users $USERS_DIR
      done
    done
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-bootstrap-user
  namespace: default
stringData:
  password: changeme
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
stringData:
  enterprise-license: ${REDPANDA_LICENSE}
  kafka-protobuf-git-basicauth-password: ""
  kafka-sasl-aws-msk-iam-secret-key: ""
  kafka-sasl-password: ""
  kafka-schema-registry-password: ""
  kafka-schemaregistry-tls-ca: ""
  kafka-schemaregistry-tls-cert: ""
  kafka-schemaregistry-tls-key: ""
  kafka-tls-ca: ""
  kafka-tls-cert: ""
  kafka-tls-key: ""
  login-github-oauth-client-secret: ""
  login-github-personal-access-token: ""
  login-google-groups-service-account.json: ""
  login-google-oauth-client-secret: ""
  login-jwt-secret: SECRETKEY
  login-oidc-client-secret: ""
  login-okta-client-secret: ""
  login-okta-directory-api-token: ""
  redpanda-admin-api-password: ""
  redpanda-admin-api-tls-ca: ""
  redpanda-admin-api-tls-cert: ""
  redpanda-admin-api-tls-key: ""
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: true
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    cluster_id: cluster-id-test
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: true
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: true
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
    superusers:
    - kubernetes-controller
    - admin
  redpanda.yaml: |-
    audit_log_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        authentication_method: http_basic
        name: internal
        port: 8082
      - address: 0.0.0.0
        authentication_method: http_basic
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        authentication_method: sasl
        name: internal
        port: 9093
      - address: 0.0.0.0
        authentication_method: sasl
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        authentication_method: http_basic
        name: internal
        port: 8081
      - address: 0.0.0.0
        authentication_method: http_basic
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: true
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: 7c7f4a111865610cc9487cc076a984b8603c6ede97a620f4731d55bb0acde7b5
        checksum/config: 7c7f4a111865610cc9487cc076a984b8603c6ede97a620f4731d55bb0acde7b5
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command:
        - sh
        - -c
        - set -e; IFS=':' read -r KAFKA_SASL_USERNAME KAFKA_SASL_PASSWORD KAFKA_SASL_MECHANISM
          < <(grep "" $(find /mnt/users/* -print)); KAFKA_SASL_MECHANISM=${KAFKA_SASL_MECHANISM:-SCRAM-SHA-512};
          export KAFKA_SASL_USERNAME KAFKA_SASL_PASSWORD KAFKA_SASL_MECHANISM; export
          KAFKA_SCHEMAREGISTRY_USERNAME=$KAFKA_SASL_USERNAME; export KAFKA_SCHEMAREGISTRY_PASSWORD=$KAFKA_SASL_PASSWORD;
          export REDPANDA_ADMINAPI_USERNAME=$KAFKA_SASL_USERNAME; export REDPANDA_ADMINAPI_PASSWORD=$KAFKA_SASL_PASSWORD;
          /app/console $@
        - ' --'
        env:
        - name: LOGIN_JWTSECRET
          valueFrom:
            secretKeyRef:
              key: login-jwt-secret
              name: redpanda-console
        - name: LICENSE
          valueFrom:
            secretKeyRef:
              key: enterprise-license
              name: redpanda-console
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/console/secrets
          name: secrets
          readOnly: true
        - mountPath: /mnt/users
          name: redpanda-users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: secrets
        secret:
          secretName: redpanda-console
      - name: redpanda-users
        secret:
          secretName: redpanda-users
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: bd246fb96aa20556886caa8b87c2670c88c07301ead21f08a9686f6516d3e550
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        - name: RP_BOOTSTRAP_USER
          value: $(RPK_USER):$(RPK_PASS):$(RPK_SASL_MECHANISM)
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env:
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: users
        secret:
          secretName: redpanda-users
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          value: ${REDPANDA_LICENSE}
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        - name: RP_BOOTSTRAP_USER
          value: $(RPK_USER):$(RPK_PASS):$(RPK_SASL_MECHANISM)
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: users
        secret:
          secretName: redpanda-users
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/97-license-key-values.yaml.tpl.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
stringData:
  enterprise-license: ${REDPANDA_LICENSE}
  kafka-protobuf-git-basicauth-password: ""
  kafka-sasl-aws-msk-iam-secret-key: ""
  kafka-sasl-password: ""
  kafka-schema-registry-password: ""
  kafka-schemaregistry-tls-ca: ""
  kafka-schemaregistry-tls-cert: ""
  kafka-schemaregistry-tls-key: ""
  kafka-tls-ca: ""
  kafka-tls-cert: ""
  kafka-tls-key: ""
  login-github-oauth-client-secret: ""
  login-github-personal-access-token: ""
  login-google-groups-service-account.json: ""
  login-google-oauth-client-secret: ""
  login-jwt-secret: SECRETKEY
  login-oidc-client-secret: ""
  login-okta-client-secret: ""
  login-okta-directory-api-token: ""
  redpanda-admin-api-password: ""
  redpanda-admin-api-tls-ca: ""
  redpanda-admin-api-tls-cert: ""
  redpanda-admin-api-tls-key: ""
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env:
        - name: LOGIN_JWTSECRET
          valueFrom:
            secretKeyRef:
              key: login-jwt-secret
              name: redpanda-console
        - name: LICENSE
          valueFrom:
            secretKeyRef:
              key: enterprise-license
              name: redpanda-console
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/console/secrets
          name: secrets
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: secrets
        secret:
          secretName: redpanda-console
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          value: ${REDPANDA_LICENSE}
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/98-license-secret-values.yaml.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env:
        - name: LICENSE
          valueFrom:
            secretKeyRef:
              key: license-key
              name: redpanda-license
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          valueFrom:
            secretKeyRef:
              key: license-key
              name: redpanda-license
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/all-possible-objects.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    connect:
      clusters:
      - name: connectors
        password: ""
        tls:
          caFilepath: ""
          certFilepath: ""
          enabled: false
          insecureSkipTlsVerify: false
          keyFilepath: ""
        token: ""
        url: http://redpanda-connectors.default.svc.cluster.local:8083
        username: ""
      connectTimeout: 0
      enabled: true
      readTimeout: 0
      requestTimeout: 0
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/connectors/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: connectors
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: connectors
    helm.sh/chart: connectors-0.1.14
  name: redpanda-connectors
spec:
  ipFamilies:
  - IPv4
  ipFamilyPolicy: SingleStack
  ports:
  - name: rest-api
    port: 8083
    protocol: TCP
    targetPort: 8083
  - name: prometheus
    port: 9404
    protocol: TCP
    targetPort: 9404
  selector:
    app.kubernetes.io/component: connectors
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: connectors
  sessionAffinity: None
  type: ClusterIP
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: null
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: 1894d433f8a13a5d76ec09415a79b012be1f5fd3c528f7e41b040909a8092a28
        checksum/config: 1894d433f8a13a5d76ec09415a79b012be1f5fd3c528f7e41b040909a8092a28
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: connectors
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: connectors
    helm.sh/chart: connectors-0.1.14
  name: redpanda-connectors
spec:
  progressDeadlineSeconds: 600
  replicas: null
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app.kubernetes.io/component: connectors
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: connectors
  strategy:
    type: RollingUpdate
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: connectors
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: connectors
    spec:
      affinity:
        nodeAffinity: {}
        podAffinity: {}
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: connectors
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: connectors
            namespaces:
            - default
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command: null
        env:
        - name: CONNECT_CONFIGURATION
          value: |-
            rest.advertised.port=8083
            rest.port=8083
            key.converter=org.apache.kafka.connect.converters.ByteArrayConverter
            value.converter=org.apache.kafka.connect.converters.ByteArrayConverter
            group.id=connectors-cluster
            offset.storage.topic=_internal_connectors_offsets
            config.storage.topic=_internal_connectors_configs
            status.storage.topic=_internal_connectors_status
            offset.storage.redpanda.remote.read=false
            offset.storage.redpanda.remote.write=false
            config.storage.redpanda.remote.read=false
            config.storage.redpanda.remote.write=false
            status.storage.redpanda.remote.read=false
            status.storage.redpanda.remote.write=false
            offset.storage.replication.factor=-1
            config.storage.replication.factor=-1
            status.storage.replication.factor=-1
            producer.linger.ms=1
            producer.batch.size=131072
            config.providers=file,secretsManager,env
            config.providers.file.class=org.apache.kafka.common.config.provider.FileConfigProvider
            config.providers.env.class=org.apache.kafka.common.config.provider.EnvVarConfigProvider
        - name: CONNECT_ADDITIONAL_CONFIGURATION
          value: ""
        - name: CONNECT_BOOTSTRAP_SERVERS
          value: redpanda-0.redpanda.default.svc.cluster.local.:9093,redpanda-1.redpanda.default.svc.cluster.local.:9093,redpanda-2.redpanda.default.svc.cluster.local.:9093
        - name: CONNECT_GC_LOG_ENABLED
          value: "false"
        - name: CONNECT_HEAP_OPTS
          value: -Xms256M -Xmx2G
        - name: CONNECT_LOG_LEVEL
          value: warn
        - name: CONNECT_TLS_ENABLED
          value: "true"
        - name: CONNECT_TRUSTED_CERTS
          value: ca/ca.crt
        envFrom: []
        image: docker.redpanda.com/redpandadata/connectors:v1.0.31
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /
            port: rest-api
            scheme: HTTP
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: connectors-cluster
        ports:
        - containerPort: 8083
          name: rest-api
          protocol: TCP
        - containerPort: 9404
          name: prometheus
          protocol: TCP
        readinessProbe:
          failureThreshold: 2
          httpGet:
            path: /connectors
            port: rest-api
            scheme: HTTP
          initialDelaySeconds: 60
          periodSeconds: 10
          successThreshold: 3
          timeoutSeconds: 5
        resources:
          limits:
            cpu: "1"
            memory: 2350Mi
          requests:
            cpu: "1"
            memory: 2350Mi
        securityContext:
          allowPrivilegeEscalation: false
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /opt/kafka/connect-certs/ca
          name: truststore
        - mountPath: /tmp
          name: rp-connect-tmp
      dnsPolicy: ClusterFirst
      imagePullSecrets: []
      nodeSelector: {}
      restartPolicy: Always
      schedulerName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
        runAsUser: 101
      serviceAccountName: default
      terminationGracePeriodSeconds: 30
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: connectors
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: connectors
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: truststore
        secret:
          defaultMode: 292
          secretName: redpanda-default-cert
      - emptyDir:
          medium: Memory
          sizeLimit: 5Mi
        name: rp-connect-tmp
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
spec:
  maxReplicas: 100
  metrics:
  - resource:
      name: cpu
      target:
        averageUtilization: 80
        type: Utilization
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: redpanda-console
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
spec:
  ingressClassName: null
  rules:
  - host: chart-example.local
    http:
      paths:
      - backend:
          service:
            name: redpanda-console
            port:
              number: 8080
        path: /
        pathType: ImplementationSpecific
  tls: null
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/connectors/templates/entry-point.yaml
apiVersion: monitoring.coreos.com/v1
kind: PodMonitor
metadata:
  annotations: {}
  creationTimestamp: null
  labels: {}
  name: redpanda-connectors
spec:
  namespaceSelector:
    any: true
  podMetricsEndpoints:
  - bearerTokenSecret:
      key: ""
    path: /
    port: prometheus
  selector:
    matchLabels:
      app.kubernetes.io/component: connectors
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: connectors
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/allowpriviledgeescalation-regression.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          allowPrivilegeEscalation: false
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: false
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          allowPrivilegeEscalation: false
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/allowprivilegeescalation-regression.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          allowPrivilegeEscalation: false
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: false
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          allowPrivilegeEscalation: false
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/app-protocol-regression.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: http
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/azure-values.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations:
    azure.workload.identity/client-id: someclientid
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: someaccountname
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/selfsigned/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/selfsigned/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/selfsigned/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/selfsigned/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    while true; do
      echo "RUNNING: Monitoring and Updating SASL users"
      USERS_DIR="/etc/secrets/users"

      new_users_list(){
        LIST=$1
        NEW_USER=$2
        if [[ -n "${LIST}" ]]; then
          LIST="${NEW_USER},${LIST}"
        else
          LIST="${NEW_USER}"
        fi

        echo "${LIST}"
      }

      process_users() {
        USERS_DIR=${1-"/etc/secrets/users"}
        USERS_FILE=$(find ${USERS_DIR}/* -print)
        USERS_LIST="kubernetes-controller"
        READ_LIST_SUCCESS=0
        # Read line by line, handle a missing EOL at the end of file
        while read p || [ -n "$p" ] ; do
          IFS=":" read -r USER_NAME PASSWORD MECHANISM <<< $p
          # Do not process empty lines
          if [ -z "$USER_NAME" ]; then
            continue
          fi
          if [[ "${USER_NAME// /}" != "$USER_NAME" ]]; then
            continue
          fi
          echo "Creating user ${USER_NAME}..."
          MECHANISM=${MECHANISM:-SCRAM-SHA-512}
          creation_result=$(rpk acl user create ${USER_NAME} -p ${PASSWORD} --mechanism ${MECHANISM} 2>&1) && creation_result_exit_code=$? || creation_result_exit_code=$?  # On a non-success exit code
          if [[ $creation_result_exit_code -ne 0 ]]; then
            # Check if the stderr contains "User already exists"
            # this error occurs when password has changed
            if [[ $creation_result == *"User already exists"* ]]; then
              echo "Update user ${USER_NAME}"
              # we will try to update by first deleting
              deletion_result=$(rpk acl user delete ${USER_NAME} 2>&1) && deletion_result_exit_code=$? || deletion_result_exit_code=$?
              if [[ $deletion_result_exit_code -ne 0 ]]; then
                echo "deletion of user ${USER_NAME} failed: ${deletion_result}"
                READ_LIST_SUCCESS=1
                break
              fi
              # Now we update the user
              update_result=$(rpk acl user create ${USER_NAME} -p ${PASSWORD} --mechanism ${MECHANISM} 2>&1) && update_result_exit_code=$? || update_result_exit_code=$?  # On a non-success exit code
              if [[ $update_result_exit_code -ne 0 ]]; then
                echo "updating user ${USER_NAME} failed: ${update_result}"
                READ_LIST_SUCCESS=1
                break
              else
                echo "Updated user ${USER_NAME}..."
                USERS_LIST=$(new_users_list "${USERS_LIST}" "${USER_NAME}")
              fi
            else
              # Another error occurred, so output the original message and exit code
              echo "error creating user ${USER_NAME}: ${creation_result}"
              READ_LIST_SUCCESS=1
              break
            fi
          # On a success, the user was created so output that
          else
            echo "Created user ${USER_NAME}..."
            USERS_LIST=$(new_users_list "${USERS_LIST}" "${USER_NAME}")
          fi
        done < $USERS_FILE

        if [[ -n "${USERS_LIST}" && ${READ_LIST_SUCCESS} ]]; then
          echo "Setting superusers configurations with users [${USERS_LIST}]"
          superuser_result=$(rpk cluster config set superusers [${USERS_LIST}] 2>&1) && superuser_result_exit_code=$? || superuser_result_exit_code=$?
          if [[ $superuser_result_exit_code -ne 0 ]]; then
              echo "Setting superusers configurations failed: ${superuser_result}"
          else
              echo "Completed setting superusers configurations"
          fi
        fi
      }

      # before we do anything ensure we have the bootstrap user
      echo "Ensuring bootstrap user ${RPK_USER}..."
      creation_result=$(rpk acl user create ${RPK_USER} -p ${RPK_PASS} --mechanism ${RPK_SASL_MECHANISM} 2>&1) && creation_result_exit_code=$? || creation_result_exit_code=$?  # On a non-success exit code
      if [[ $creation_result_exit_code -ne 0 ]]; then
        if [[ $creation_result == *"User already exists"* ]]; then
          echo "Bootstrap user already created"
        else
          echo "error creating user ${RPK_USER}: ${creation_result}"
        fi
      fi

      # first time processing
      process_users $USERS_DIR

      # subsequent changes detected here
      # watching delete_self as documented in https://ahmet.im/blog/kubernetes-inotify/
      USERS_FILE=$(find ${USERS_DIR}/* -print)
      while RES=$(inotifywait -q -e delete_self ${USERS_FILE}); do
        process_users $USERS_DIR
      done
    done
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9092}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE="${POD_ORDINAL}-uniquevalue-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.some.local.dev.domain\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE="${POD_ORDINAL}-uniquevalue-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.some.local.dev.domain\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE="${POD_ORDINAL}-uniquevalue-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.some.local.dev.domain\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE="${POD_ORDINAL}-uniquevalue-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.some.local.dev.domain\",\"name\":\"kafka-api-0\",\"port\":30092}")

    PREFIX_TEMPLATE="${POD_ORDINAL}-uniquevalue-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.some.local.dev.domain\",\"name\":\"kafka-api-0\",\"port\":30092}")

    PREFIX_TEMPLATE="${POD_ORDINAL}-uniquevalue-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.some.local.dev.domain\",\"name\":\"kafka-api-0\",\"port\":30092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[2] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE="${POD_ORDINAL}-uniquevalue-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.some.local.dev.domain\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE="${POD_ORDINAL}-uniquevalue-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.some.local.dev.domain\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE="${POD_ORDINAL}-uniquevalue-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.some.local.dev.domain\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE="${POD_ORDINAL}-uniquevalue-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.some.local.dev.domain\",\"name\":\"http-proxy\",\"port\":30082}")

    PREFIX_TEMPLATE="${POD_ORDINAL}-uniquevalue-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.some.local.dev.domain\",\"name\":\"http-proxy\",\"port\":30082}")

    PREFIX_TEMPLATE="${POD_ORDINAL}-uniquevalue-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.some.local.dev.domain\",\"name\":\"http-proxy\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[2] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-fs-validator
  namespace: default
stringData:
  fsValidator.sh: |-
    set -e
    EXPECTED_FS_TYPE=$1

    DATA_DIR="/var/lib/redpanda/data"
    TEST_FILE="testfile"

    echo "checking data directory exist..."
    if [ ! -d "${DATA_DIR}" ]; then
      echo "data directory does not exists, exiting"
      exit 1
    fi

    echo "checking filesystem type..."
    FS_TYPE=$(df -T $DATA_DIR  | tail -n +2 | awk '{print $2}')

    if [ "${FS_TYPE}" != "${EXPECTED_FS_TYPE}" ]; then
      echo "file system found to be ${FS_TYPE} when expected ${EXPECTED_FS_TYPE}"
      exit 1
    fi

    echo "checking if able to create a test file..."

    touch ${DATA_DIR}/${TEST_FILE}
    result=$(touch ${DATA_DIR}/${TEST_FILE} 2> /dev/null; echo $?)
    if [ "${result}" != "0" ]; then
      echo "could not write testfile, may not have write permission"
      exit 1
    fi

    echo "checking if able to delete a test file..."

    result=$(rm ${DATA_DIR}/${TEST_FILE} 2> /dev/null; echo $?)
    if [ "${result}" != "0" ]; then
      echo "could not delete testfile"
      exit 1
    fi

    echo "passed"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-bootstrap-user
  namespace: default
stringData:
  password: changeme
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    aggregate_metrics: "true"
    audit_enabled: true
    cloud_storage_azure_container: somecontainer
    cloud_storage_azure_hierarchical_namespace_enabled: "true"
    cloud_storage_azure_storage_account: someaccount
    cloud_storage_cache_size: 5368709120
    cloud_storage_cache_size_percent: "15"
    cloud_storage_credentials_source: azure_aks_oidc_federation
    cloud_storage_enable_remote_read: "true"
    cloud_storage_enable_remote_write: "true"
    cloud_storage_enabled: "true"
    cloud_storage_manifest_cache_size: "16777216"
    cloud_storage_max_throughput_per_shard: "40000000"
    cloud_storage_segment_max_upload_interval_sec: "3600"
    cloud_storage_spillover_manifest_size: "65536"
    cluster_id: someclusterid
    compacted_log_segment_size: "14680064"
    core_balancing_continuous: "true"
    default_topic_replications: "3"
    disk_reservation_percent: "0"
    enable_controller_log_rate_limiting: "true"
    enable_rack_awareness: false
    enable_sasl: true
    enable_usage: "true"
    fetch_reads_debounce_timeout: "5"
    group_topic_partitions: "6"
    initial_retention_local_target_ms_default: "3600000"
    kafka_batch_max_bytes: "1048576"
    kafka_connection_rate_limit: "1000"
    kafka_connections_max: "3700"
    kafka_enable_authorization: true
    kafka_enable_partition_reassignment: "false"
    kafka_throughput_limit_node_in_bps: "13333334"
    kafka_throughput_limit_node_out_bps: "40000000"
    log_segment_ms_min: "300000"
    log_segment_size: "29360128"
    log_segment_size_max: "29360128"
    log_segment_size_min: "16777216"
    max_compacted_log_segment_size: "58720256"
    max_concurrent_producer_ids: "3700"
    minimum_topic_replications: "3"
    partition_autobalancing_mode: continuous
    raft_learner_recovery_rate: "104857600"
    retention_local_strict: "false"
    retention_local_strict_override: "false"
    retention_local_target_capacity_percent: "70"
    retention_local_target_ms_default: "21600000"
    rpc_client_connections_per_peer: "80"
    rpc_server_listen_backlog: "1000"
    rps_limit_acls_and_users_operations: "100"
    rps_limit_configuration_operations: "10"
    rps_limit_move_operations: "1000"
    rps_limit_node_management_operations: "10"
    rps_limit_topic_operations: "100"
    space_management_enable: "true"
    space_management_enable_override: "true"
    storage_min_free_bytes: 5368709120
    superusers:
    - kubernetes-controller
    topic_memory_per_partition: "3145728"
    topic_partitions_per_shard: "1066"
    transaction_coordinator_partitions: "6"
    use_fetch_scheduler_group: "true"
  redpanda.yaml: |-
    audit_log_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/selfsigned/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9092
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9092
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9092
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        authentication_method: http_basic
        name: internal
        port: 8082
      - address: 0.0.0.0
        authentication_method: http_basic
        name: default
        port: 8083
      - address: 0.0.0.0
        authentication_method: http_basic
        name: http-proxy
        port: 30082
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/selfsigned/tls.crt
        enabled: true
        key_file: /etc/tls/certs/selfsigned/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/selfsigned/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      - cert_file: /etc/tls/certs/letsencrypt/tls.crt
        enabled: true
        key_file: /etc/tls/certs/letsencrypt/tls.key
        name: http-proxy
        require_client_auth: false
        truststore_file: /etc/ssl/certs/ca-certificates.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/selfsigned/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9092
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9092
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9092
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/selfsigned/tls.crt
        enabled: true
        key_file: /etc/tls/certs/selfsigned/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/selfsigned/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 9999
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        authentication_method: sasl
        name: internal
        port: 9092
      - address: 0.0.0.0
        authentication_method: sasl
        name: default
        port: 9094
      - address: 0.0.0.0
        authentication_method: sasl
        name: kafka-api-0
        port: 30092
      kafka_api_tls:
      - cert_file: /etc/tls/certs/selfsigned/tls.crt
        enabled: true
        key_file: /etc/tls/certs/selfsigned/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/selfsigned/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      - cert_file: /etc/tls/certs/letsencrypt/tls.crt
        enabled: true
        key_file: /etc/tls/certs/letsencrypt/tls.key
        name: kafka-api-0
        require_client_auth: false
        truststore_file: /etc/ssl/certs/ca-certificates.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/selfsigned/tls.crt
        enabled: true
        key_file: /etc/tls/certs/selfsigned/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/selfsigned/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --smp=1
      - --memory=5G
      - --reserve-memory=1G
      - --abort-on-seastar-bad-alloc
      - --dump-memory-diagnostics-on-alloc-failure-kind=all
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/selfsigned/ca.crt
      enable_memory_locking: true
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9092
        - redpanda-1.redpanda.default.svc.cluster.local.:9092
        - redpanda-2.redpanda.default.svc.cluster.local.:9092
        tls:
          ca_file: /etc/tls/certs/selfsigned/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/selfsigned/ca.crt
      tune_aio_events: false
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        authentication_method: http_basic
        name: internal
        port: 8081
      - address: 0.0.0.0
        authentication_method: http_basic
        name: default
        port: 8084
      - address: 0.0.0.0
        authentication_method: http_basic
        name: schema-registry
        port: 30081
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/selfsigned/tls.crt
        enabled: true
        key_file: /etc/tls/certs/selfsigned/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/selfsigned/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      - cert_file: /etc/tls/certs/letsencrypt/tls.crt
        enabled: true
        key_file: /etc/tls/certs/letsencrypt/tls.key
        name: schema-registry
        require_client_auth: false
        truststore_file: /etc/ssl/certs/ca-certificates.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/selfsigned/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9092
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9092
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9092
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations:
    azure.workload.identity/client-id: someclientid
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
rules:
- apiGroups:
  - ""
  resources:
  - nodes
  verbs:
  - get
  - list
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations:
    azure.workload.identity/client-id: someclientid
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk-bundle
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  - endpoints
  - events
  - limitranges
  - persistentvolumeclaims
  - pods
  - pods/log
  - replicationcontrollers
  - resourcequotas
  - serviceaccounts
  - services
  verbs:
  - get
  - list
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations:
    azure.workload.identity/client-id: someclientid
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: redpanda
subjects:
- kind: ServiceAccount
  name: someaccountname
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations:
    azure.workload.identity/client-id: someclientid
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk-bundle
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: redpanda-rpk-bundle
subjects:
- kind: ServiceAccount
  name: someaccountname
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "true"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9092
    protocol: TCP
    targetPort: 9092
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 69e9dd514b47e871ffed51f91c705708156ff083623eccd0d138847850a6858b
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        azure.workload.identity/use: "true"
        cloud.redpanda.com/network-loadbalancer-access: "true"
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        - name: RP_BOOTSTRAP_USER
          value: $(RPK_USER):$(RPK_PASS):$(RPK_SASL_MECHANISM)
        image: docker.io/redpandadata/redpanda:v24.2.12
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 60 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 60 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/selfsigned/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 30082
          name: http-http-pro
        - containerPort: 9092
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 30092
          name: kafka-kafka-ap
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        - containerPort: 30081
          name: schema-schema-r
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 6554Mi
          requests:
            cpu: 1
            memory: 6554Mi
        securityContext:
          allowPrivilegeEscalation: false
          runAsGroup: 65534
          runAsNonRoot: true
          runAsUser: 65534
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/selfsigned/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/tls/certs/letsencrypt
          name: redpanda-letsencrypt-cert
        - mountPath: /etc/tls/certs/selfsigned
          name: redpanda-selfsigned-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
        - mountPath: /etc/ssl/certs/redpanda-truststore.crt
          name: redpanda-truststore
          readOnly: true
          subPath: redpanda-truststore.crt
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env:
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        image: docker.io/redpandadata/redpanda:v24.2.12
        name: config-watcher
        resources:
          limits:
            cpu: 256m
            memory: 256Mi
          requests:
            cpu: 256m
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          runAsGroup: 65534
          runAsNonRoot: true
          runAsUser: 65534
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/tls/certs/letsencrypt
          name: redpanda-letsencrypt-cert
        - mountPath: /etc/tls/certs/selfsigned
          name: redpanda-selfsigned-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/fs-validator/scripts/fsValidator.sh
          xfs & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.io/redpandadata/redpanda:v24.2.12
        name: fs-validator
        resources:
          limits:
            cpu: 100m
            memory: 256Mi
          requests:
            cpu: 100m
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          runAsGroup: 65534
          runAsNonRoot: true
          runAsUser: 65534
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/tls/certs/letsencrypt
          name: redpanda-letsencrypt-cert
        - mountPath: /etc/tls/certs/selfsigned
          name: redpanda-selfsigned-cert
        - mountPath: /etc/secrets/fs-validator/scripts/
          name: redpanda-fs-validator
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        image: docker.io/redpandadata/redpanda:v24.2.12
        name: redpanda-configurator
        resources:
          limits:
            cpu: 100m
            memory: 256Mi
          requests:
            cpu: 100m
            memory: 256Mi
        securityContext:
          allowPrivilegeEscalation: false
          runAsGroup: 65534
          runAsNonRoot: true
          runAsUser: 65534
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/tls/certs/letsencrypt
          name: redpanda-letsencrypt-cert
        - mountPath: /etc/tls/certs/selfsigned
          name: redpanda-selfsigned-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector:
        cloud.redpanda.com/role: redpanda
      priorityClassName: system-node-critical
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: someaccountname
      terminationGracePeriodSeconds: 120
      tolerations:
      - effect: NoSchedule
        key: cloud.redpanda.com/role
        operator: Equal
        value: redpanda
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: redpanda-letsencrypt-cert
        secret:
          defaultMode: 288
          secretName: letsencrypt-cert
      - name: redpanda-selfsigned-cert
        secret:
          defaultMode: 288
          secretName: selfsigned-cert
      - name: users
        secret:
          secretName: redpanda-superusers
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: redpanda-fs-validator
        secret:
          defaultMode: 509
          secretName: redpanda-fs-validator
      - configMap:
          defaultMode: 420
          items:
          - key: redpanda-truststore.pem
            path: redpanda-truststore.crt
          name: redpanda-truststore.crt
          optional: false
        name: redpanda-truststore
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 4096Gi
      storageClassName: local-path
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  - some.local.dev.domain
  - '*.some.local.dev.domain'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  - some.local.dev.domain
  - '*.some.local.dev.domain'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  endpoints:
  - enableHttp2: null
    interval: 30s
    path: /public_metrics
    port: admin
    scheme: https
    tlsConfig:
      ca: {}
      cert: {}
      insecureSkipVerify: true
  namespaceSelector: {}
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      monitoring.redpanda.com/enabled: "true"
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          valueFrom:
            secretKeyRef:
              key: license
              name: redpanda-license
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        - name: RP_BOOTSTRAP_USER
          value: $(RPK_USER):$(RPK_PASS):$(RPK_SASL_MECHANISM)
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources:
          requests:
            memory: 16Mi
        securityContext:
          allowPrivilegeEscalation: false
          runAsGroup: 65534
          runAsNonRoot: true
          runAsUser: 65534
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/tls/certs/letsencrypt
          name: redpanda-letsencrypt-cert
        - mountPath: /etc/tls/certs/selfsigned
          name: redpanda-selfsigned-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 16Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector:
        cloud.redpanda.com/role: redpanda
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: someaccountname
      tolerations:
      - effect: NoSchedule
        key: cloud.redpanda.com/role
        operator: Equal
        value: redpanda
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: redpanda-letsencrypt-cert
        secret:
          defaultMode: 288
          secretName: letsencrypt-cert
      - name: redpanda-selfsigned-cert
        secret:
          defaultMode: 288
          secretName: selfsigned-cert
      - name: users
        secret:
          secretName: redpanda-superusers
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/console-with-extra-volumes.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /tmp/role-bindings.yml
          name: role-bindings-volume
          readOnly: true
          subPath: role-bindings.yml
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
      - configMap:
          name: role-bindings-configmap
        name: role-bindings-volume
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/default-sasl-mechanism-regression.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-users
  namespace: default
stringData:
  users.txt: |-
    empty-mechanism:valid
    mechanism-256:valid:SCRAM-SHA-256
    mechanism-512:valid:SCRAM-SHA-512
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    while true; do
      echo "RUNNING: Monitoring and Updating SASL users"
      USERS_DIR="/etc/secrets/users"

      new_users_list(){
        LIST=$1
        NEW_USER=$2
        if [[ -n "${LIST}" ]]; then
          LIST="${NEW_USER},${LIST}"
        else
          LIST="${NEW_USER}"
        fi

        echo "${LIST}"
      }

      process_users() {
        USERS_DIR=${1-"/etc/secrets/users"}
        USERS_FILE=$(find ${USERS_DIR}/* -print)
        USERS_LIST="kubernetes-controller"
        READ_LIST_SUCCESS=0
        # Read line by line, handle a missing EOL at the end of file
        while read p || [ -n "$p" ] ; do
          IFS=":" read -r USER_NAME PASSWORD MECHANISM <<< $p
          # Do not process empty lines
          if [ -z "$USER_NAME" ]; then
            continue
          fi
          if [[ "${USER_NAME// /}" != "$USER_NAME" ]]; then
            continue
          fi
          echo "Creating user ${USER_NAME}..."
          MECHANISM=${MECHANISM:-SCRAM-SHA-512}
          creation_result=$(rpk acl user create ${USER_NAME} -p ${PASSWORD} --mechanism ${MECHANISM} 2>&1) && creation_result_exit_code=$? || creation_result_exit_code=$?  # On a non-success exit code
          if [[ $creation_result_exit_code -ne 0 ]]; then
            # Check if the stderr contains "User already exists"
            # this error occurs when password has changed
            if [[ $creation_result == *"User already exists"* ]]; then
              echo "Update user ${USER_NAME}"
              # we will try to update by first deleting
              deletion_result=$(rpk acl user delete ${USER_NAME} 2>&1) && deletion_result_exit_code=$? || deletion_result_exit_code=$?
              if [[ $deletion_result_exit_code -ne 0 ]]; then
                echo "deletion of user ${USER_NAME} failed: ${deletion_result}"
                READ_LIST_SUCCESS=1
                break
              fi
              # Now we update the user
              update_result=$(rpk acl user create ${USER_NAME} -p ${PASSWORD} --mechanism ${MECHANISM} 2>&1) && update_result_exit_code=$? || update_result_exit_code=$?  # On a non-success exit code
              if [[ $update_result_exit_code -ne 0 ]]; then
                echo "updating user ${USER_NAME} failed: ${update_result}"
                READ_LIST_SUCCESS=1
                break
              else
                echo "Updated user ${USER_NAME}..."
                USERS_LIST=$(new_users_list "${USERS_LIST}" "${USER_NAME}")
              fi
            else
              # Another error occurred, so output the original message and exit code
              echo "error creating user ${USER_NAME}: ${creation_result}"
              READ_LIST_SUCCESS=1
              break
            fi
          # On a success, the user was created so output that
          else
            echo "Created user ${USER_NAME}..."
            USERS_LIST=$(new_users_list "${USERS_LIST}" "${USER_NAME}")
          fi
        done < $USERS_FILE

        if [[ -n "${USERS_LIST}" && ${READ_LIST_SUCCESS} ]]; then
          echo "Setting superusers configurations with users [${USERS_LIST}]"
          superuser_result=$(rpk cluster config set superusers [${USERS_LIST}] 2>&1) && superuser_result_exit_code=$? || superuser_result_exit_code=$?
          if [[ $superuser_result_exit_code -ne 0 ]]; then
              echo "Setting superusers configurations failed: ${superuser_result}"
          else
              echo "Completed setting superusers configurations"
          fi
        fi
      }

      # before we do anything ensure we have the bootstrap user
      echo "Ensuring bootstrap user ${RPK_USER}..."
      creation_result=$(rpk acl user create ${RPK_USER} -p ${RPK_PASS} --mechanism ${RPK_SASL_MECHANISM} 2>&1) && creation_result_exit_code=$? || creation_result_exit_code=$?  # On a non-success exit code
      if [[ $creation_result_exit_code -ne 0 ]]; then
        if [[ $creation_result == *"User already exists"* ]]; then
          echo "Bootstrap user already created"
        else
          echo "error creating user ${RPK_USER}: ${creation_result}"
        fi
      fi

      # first time processing
      process_users $USERS_DIR

      # subsequent changes detected here
      # watching delete_self as documented in https://ahmet.im/blog/kubernetes-inotify/
      USERS_FILE=$(find ${USERS_DIR}/* -print)
      while RES=$(inotifywait -q -e delete_self ${USERS_FILE}); do
        process_users $USERS_DIR
      done
    done
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-bootstrap-user
  namespace: default
stringData:
  password: changeme
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: true
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: true
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
    superusers:
    - kubernetes-controller
    - empty-mechanism
    - mechanism-256
    - mechanism-512
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        authentication_method: http_basic
        name: internal
        port: 8082
      - address: 0.0.0.0
        authentication_method: http_basic
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        authentication_method: sasl
        name: internal
        port: 9093
      - address: 0.0.0.0
        authentication_method: sasl
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        authentication_method: http_basic
        name: internal
        port: 8081
      - address: 0.0.0.0
        authentication_method: http_basic
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: true
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: 7c7f4a111865610cc9487cc076a984b8603c6ede97a620f4731d55bb0acde7b5
        checksum/config: 7c7f4a111865610cc9487cc076a984b8603c6ede97a620f4731d55bb0acde7b5
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command:
        - sh
        - -c
        - set -e; IFS=':' read -r KAFKA_SASL_USERNAME KAFKA_SASL_PASSWORD KAFKA_SASL_MECHANISM
          < <(grep "" $(find /mnt/users/* -print)); KAFKA_SASL_MECHANISM=${KAFKA_SASL_MECHANISM:-SCRAM-SHA-512};
          export KAFKA_SASL_USERNAME KAFKA_SASL_PASSWORD KAFKA_SASL_MECHANISM; export
          KAFKA_SCHEMAREGISTRY_USERNAME=$KAFKA_SASL_USERNAME; export KAFKA_SCHEMAREGISTRY_PASSWORD=$KAFKA_SASL_PASSWORD;
          export REDPANDA_ADMINAPI_USERNAME=$KAFKA_SASL_USERNAME; export REDPANDA_ADMINAPI_PASSWORD=$KAFKA_SASL_PASSWORD;
          /app/console $@
        - ' --'
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /mnt/users
          name: redpanda-users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-users
        secret:
          secretName: redpanda-users
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: ddcf6376732939f810acb684cafac205507b50b966e5714f128ed87a56fb10f6
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        - name: RP_BOOTSTRAP_USER
          value: $(RPK_USER):$(RPK_PASS):$(RPK_SASL_MECHANISM)
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env:
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: users
        secret:
          secretName: redpanda-users
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        - name: RP_BOOTSTRAP_USER
          value: $(RPK_USER):$(RPK_PASS):$(RPK_SASL_MECHANISM)
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: users
        secret:
          secretName: redpanda-users
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/default-v22.1.0-0.yaml.golden --
execution error at (redpanda/templates/entry-point.yaml:17:4): Error: The Redpanda version (22.1.0) is no longer supported 
To accept this risk, run the upgrade again adding `--force=true`

-- testdata/TestTemplate/default-v22.1.0-1.yaml.golden --
execution error at (redpanda/templates/entry-point.yaml:17:4): Error: The Redpanda version (22.1.0) is no longer supported 
To accept this risk, run the upgrade again adding `--force=true`

-- testdata/TestTemplate/default-v22.1.0-2.yaml.golden --
execution error at (redpanda/templates/entry-point.yaml:17:4): Error: The Redpanda version (22.1.0) is no longer supported 
To accept this risk, run the upgrade again adding `--force=true`

-- testdata/TestTemplate/default-v22.2.0-0.yaml.golden --
execution error at (redpanda/templates/entry-point.yaml:17:4): Redpanda version v22.2.0 does not support TLS on the RPC port. Please upgrade. See technical service bulletin 2023-01.
-- testdata/TestTemplate/default-v22.2.0-1.yaml.golden --
execution error at (redpanda/templates/entry-point.yaml:17:4): Redpanda version v22.2.0 does not support TLS on the RPC port. Please upgrade. See technical service bulletin 2023-01.
-- testdata/TestTemplate/default-v22.2.0-2.yaml.golden --
execution error at (redpanda/templates/entry-point.yaml:17:4): Redpanda version v22.2.0 does not support TLS on the RPC port. Please upgrade. See technical service bulletin 2023-01.
-- testdata/TestTemplate/default-v22.3.0-0.yaml.golden --
execution error at (redpanda/templates/entry-point.yaml:17:4): Redpanda version v22.3.0 does not support TLS on the RPC port. Please upgrade. See technical service bulletin 2023-01.
-- testdata/TestTemplate/default-v22.3.0-1.yaml.golden --
execution error at (redpanda/templates/entry-point.yaml:17:4): Redpanda version v22.3.0 does not support TLS on the RPC port. Please upgrade. See technical service bulletin 2023-01.
-- testdata/TestTemplate/default-v22.3.0-2.yaml.golden --
execution error at (redpanda/templates/entry-point.yaml:17:4): Redpanda version v22.3.0 does not support TLS on the RPC port. Please upgrade. See technical service bulletin 2023-01.
-- testdata/TestTemplate/default-v22.3.14-0.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_batch_max_bytes: 7777
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 99999
    log_segment_size_min: 100
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v22.3.14
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v22.3.14
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v22.3.14
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v22.3.14
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/default-v22.3.14-1.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
stringData:
  enterprise-license: ATOTALLYVALIDLICENSE
  kafka-protobuf-git-basicauth-password: ""
  kafka-sasl-aws-msk-iam-secret-key: ""
  kafka-sasl-password: ""
  kafka-schema-registry-password: ""
  kafka-schemaregistry-tls-ca: ""
  kafka-schemaregistry-tls-cert: ""
  kafka-schemaregistry-tls-key: ""
  kafka-tls-ca: ""
  kafka-tls-cert: ""
  kafka-tls-key: ""
  login-github-oauth-client-secret: ""
  login-github-personal-access-token: ""
  login-google-groups-service-account.json: ""
  login-google-oauth-client-secret: ""
  login-jwt-secret: SECRETKEY
  login-oidc-client-secret: ""
  login-okta-client-secret: ""
  login-okta-directory-api-token: ""
  redpanda-admin-api-password: ""
  redpanda-admin-api-tls-ca: ""
  redpanda-admin-api-tls-cert: ""
  redpanda-admin-api-tls-key: ""
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env:
        - name: LOGIN_JWTSECRET
          valueFrom:
            secretKeyRef:
              key: login-jwt-secret
              name: redpanda-console
        - name: LICENSE
          valueFrom:
            secretKeyRef:
              key: enterprise-license
              name: redpanda-console
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/console/secrets
          name: secrets
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: secrets
        secret:
          secretName: redpanda-console
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v22.3.14
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v22.3.14
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v22.3.14
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v22.3.14
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          value: ATOTALLYVALIDLICENSE
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/default-v22.3.14-2.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"

    # Configure Rack Awareness
    set +x
    RACK=$(curl --silent --cacert /run/secrets/kubernetes.io/serviceaccount/ca.crt --fail -H 'Authorization: Bearer '$(cat /run/secrets/kubernetes.io/serviceaccount/token) "https://${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT_HTTPS}/api/v1/nodes/${KUBERNETES_NODE_NAME}?pretty=true" | grep '"topology-label"' | grep -v '\"key\":' | sed 's/.*": "\([^"]\+\).*/\1/')
    set -x
    rpk --config "$CONFIG" redpanda config set redpanda.rack "${RACK}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: true
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v22.3.14
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v22.3.14
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v22.3.14
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v22.3.14
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
          name: kube-api-access
          readOnly: true
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
      - name: kube-api-access
        projected:
          defaultMode: 420
          sources:
          - serviceAccountToken:
              expirationSeconds: 3607
              path: token
          - configMap:
              items:
              - key: ca.crt
                path: ca.crt
              name: kube-root-ca.crt
          - downwardAPI:
              items:
              - fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.namespace
                path: namespace
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/default-v22.4.0-0.yaml.golden --
execution error at (redpanda/templates/entry-point.yaml:17:4): Redpanda version v22.4.0 does not support TLS on the RPC port. Please upgrade. See technical service bulletin 2023-01.
-- testdata/TestTemplate/default-v22.4.0-1.yaml.golden --
execution error at (redpanda/templates/entry-point.yaml:17:4): Redpanda version v22.4.0 does not support TLS on the RPC port. Please upgrade. See technical service bulletin 2023-01.
-- testdata/TestTemplate/default-v22.4.0-2.yaml.golden --
execution error at (redpanda/templates/entry-point.yaml:17:4): Redpanda version v22.4.0 does not support TLS on the RPC port. Please upgrade. See technical service bulletin 2023-01.
-- testdata/TestTemplate/default-v23.1.1-0.yaml.golden --
execution error at (redpanda/templates/entry-point.yaml:17:4): Redpanda version v23.1.1 does not support TLS on the RPC port. Please upgrade. See technical service bulletin 2023-01.
-- testdata/TestTemplate/default-v23.1.1-1.yaml.golden --
execution error at (redpanda/templates/entry-point.yaml:17:4): Redpanda version v23.1.1 does not support TLS on the RPC port. Please upgrade. See technical service bulletin 2023-01.
-- testdata/TestTemplate/default-v23.1.1-2.yaml.golden --
execution error at (redpanda/templates/entry-point.yaml:17:4): Redpanda version v23.1.1 does not support TLS on the RPC port. Please upgrade. See technical service bulletin 2023-01.
-- testdata/TestTemplate/default-v23.1.2-0.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_batch_max_bytes: 7777
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 99999
    log_segment_size_min: 100
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/default-v23.1.2-1.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
stringData:
  enterprise-license: ATOTALLYVALIDLICENSE
  kafka-protobuf-git-basicauth-password: ""
  kafka-sasl-aws-msk-iam-secret-key: ""
  kafka-sasl-password: ""
  kafka-schema-registry-password: ""
  kafka-schemaregistry-tls-ca: ""
  kafka-schemaregistry-tls-cert: ""
  kafka-schemaregistry-tls-key: ""
  kafka-tls-ca: ""
  kafka-tls-cert: ""
  kafka-tls-key: ""
  login-github-oauth-client-secret: ""
  login-github-personal-access-token: ""
  login-google-groups-service-account.json: ""
  login-google-oauth-client-secret: ""
  login-jwt-secret: SECRETKEY
  login-oidc-client-secret: ""
  login-okta-client-secret: ""
  login-okta-directory-api-token: ""
  redpanda-admin-api-password: ""
  redpanda-admin-api-tls-ca: ""
  redpanda-admin-api-tls-cert: ""
  redpanda-admin-api-tls-key: ""
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env:
        - name: LOGIN_JWTSECRET
          valueFrom:
            secretKeyRef:
              key: login-jwt-secret
              name: redpanda-console
        - name: LICENSE
          valueFrom:
            secretKeyRef:
              key: enterprise-license
              name: redpanda-console
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/console/secrets
          name: secrets
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: secrets
        secret:
          secretName: redpanda-console
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          value: ATOTALLYVALIDLICENSE
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/default-v23.1.2-2.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"

    # Configure Rack Awareness
    set +x
    RACK=$(curl --silent --cacert /run/secrets/kubernetes.io/serviceaccount/ca.crt --fail -H 'Authorization: Bearer '$(cat /run/secrets/kubernetes.io/serviceaccount/token) "https://${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT_HTTPS}/api/v1/nodes/${KUBERNETES_NODE_NAME}?pretty=true" | grep '"topology-label"' | grep -v '\"key\":' | sed 's/.*": "\([^"]\+\).*/\1/')
    set -x
    rpk --config "$CONFIG" redpanda config set redpanda.rack "${RACK}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: true
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
          name: kube-api-access
          readOnly: true
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
      - name: kube-api-access
        projected:
          defaultMode: 420
          sources:
          - serviceAccountToken:
              expirationSeconds: 3607
              path: token
          - configMap:
              items:
              - key: ca.crt
                path: ca.crt
              name: kube-root-ca.crt
          - downwardAPI:
              items:
              - fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.namespace
                path: namespace
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/default-v23.1.3-0.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_batch_max_bytes: 7777
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 99999
    log_segment_size_min: 100
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.3
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.3
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.3
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.3
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/default-v23.1.3-1.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
stringData:
  enterprise-license: ATOTALLYVALIDLICENSE
  kafka-protobuf-git-basicauth-password: ""
  kafka-sasl-aws-msk-iam-secret-key: ""
  kafka-sasl-password: ""
  kafka-schema-registry-password: ""
  kafka-schemaregistry-tls-ca: ""
  kafka-schemaregistry-tls-cert: ""
  kafka-schemaregistry-tls-key: ""
  kafka-tls-ca: ""
  kafka-tls-cert: ""
  kafka-tls-key: ""
  login-github-oauth-client-secret: ""
  login-github-personal-access-token: ""
  login-google-groups-service-account.json: ""
  login-google-oauth-client-secret: ""
  login-jwt-secret: SECRETKEY
  login-oidc-client-secret: ""
  login-okta-client-secret: ""
  login-okta-directory-api-token: ""
  redpanda-admin-api-password: ""
  redpanda-admin-api-tls-ca: ""
  redpanda-admin-api-tls-cert: ""
  redpanda-admin-api-tls-key: ""
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env:
        - name: LOGIN_JWTSECRET
          valueFrom:
            secretKeyRef:
              key: login-jwt-secret
              name: redpanda-console
        - name: LICENSE
          valueFrom:
            secretKeyRef:
              key: enterprise-license
              name: redpanda-console
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/console/secrets
          name: secrets
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: secrets
        secret:
          secretName: redpanda-console
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.3
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.3
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.3
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.3
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          value: ATOTALLYVALIDLICENSE
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/default-v23.1.3-2.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"

    # Configure Rack Awareness
    set +x
    RACK=$(curl --silent --cacert /run/secrets/kubernetes.io/serviceaccount/ca.crt --fail -H 'Authorization: Bearer '$(cat /run/secrets/kubernetes.io/serviceaccount/token) "https://${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT_HTTPS}/api/v1/nodes/${KUBERNETES_NODE_NAME}?pretty=true" | grep '"topology-label"' | grep -v '\"key\":' | sed 's/.*": "\([^"]\+\).*/\1/')
    set -x
    rpk --config "$CONFIG" redpanda config set redpanda.rack "${RACK}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: true
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.3
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.3
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.3
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.1.3
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
          name: kube-api-access
          readOnly: true
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
      - name: kube-api-access
        projected:
          defaultMode: 420
          sources:
          - serviceAccountToken:
              expirationSeconds: 3607
              path: token
          - configMap:
              items:
              - key: ca.crt
                path: ca.crt
              name: kube-root-ca.crt
          - downwardAPI:
              items:
              - fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.namespace
                path: namespace
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/default-v23.2.1-0.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_batch_max_bytes: 7777
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 99999
    log_segment_size_min: 100
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.2.1
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.2.1
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.2.1
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.2.1
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/default-v23.2.1-1.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
stringData:
  enterprise-license: ATOTALLYVALIDLICENSE
  kafka-protobuf-git-basicauth-password: ""
  kafka-sasl-aws-msk-iam-secret-key: ""
  kafka-sasl-password: ""
  kafka-schema-registry-password: ""
  kafka-schemaregistry-tls-ca: ""
  kafka-schemaregistry-tls-cert: ""
  kafka-schemaregistry-tls-key: ""
  kafka-tls-ca: ""
  kafka-tls-cert: ""
  kafka-tls-key: ""
  login-github-oauth-client-secret: ""
  login-github-personal-access-token: ""
  login-google-groups-service-account.json: ""
  login-google-oauth-client-secret: ""
  login-jwt-secret: SECRETKEY
  login-oidc-client-secret: ""
  login-okta-client-secret: ""
  login-okta-directory-api-token: ""
  redpanda-admin-api-password: ""
  redpanda-admin-api-tls-ca: ""
  redpanda-admin-api-tls-cert: ""
  redpanda-admin-api-tls-key: ""
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env:
        - name: LOGIN_JWTSECRET
          valueFrom:
            secretKeyRef:
              key: login-jwt-secret
              name: redpanda-console
        - name: LICENSE
          valueFrom:
            secretKeyRef:
              key: enterprise-license
              name: redpanda-console
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/console/secrets
          name: secrets
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: secrets
        secret:
          secretName: redpanda-console
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.2.1
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.2.1
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.2.1
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.2.1
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          value: ATOTALLYVALIDLICENSE
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/default-v23.2.1-2.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"

    # Configure Rack Awareness
    set +x
    RACK=$(curl --silent --cacert /run/secrets/kubernetes.io/serviceaccount/ca.crt --fail -H 'Authorization: Bearer '$(cat /run/secrets/kubernetes.io/serviceaccount/token) "https://${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT_HTTPS}/api/v1/nodes/${KUBERNETES_NODE_NAME}?pretty=true" | grep '"topology-label"' | grep -v '\"key\":' | sed 's/.*": "\([^"]\+\).*/\1/')
    set -x
    rpk --config "$CONFIG" redpanda config set redpanda.rack "${RACK}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: true
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.2.1
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.2.1
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.2.1
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.2.1
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
          name: kube-api-access
          readOnly: true
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
      - name: kube-api-access
        projected:
          defaultMode: 420
          sources:
          - serviceAccountToken:
              expirationSeconds: 3607
              path: token
          - configMap:
              items:
              - key: ca.crt
                path: ca.crt
              name: kube-root-ca.crt
          - downwardAPI:
              items:
              - fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.namespace
                path: namespace
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/default-v23.3.0-0.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_batch_max_bytes: 7777
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 99999
    log_segment_size_min: 100
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.3.0
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.3.0
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.3.0
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.3.0
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/default-v23.3.0-1.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
stringData:
  enterprise-license: ATOTALLYVALIDLICENSE
  kafka-protobuf-git-basicauth-password: ""
  kafka-sasl-aws-msk-iam-secret-key: ""
  kafka-sasl-password: ""
  kafka-schema-registry-password: ""
  kafka-schemaregistry-tls-ca: ""
  kafka-schemaregistry-tls-cert: ""
  kafka-schemaregistry-tls-key: ""
  kafka-tls-ca: ""
  kafka-tls-cert: ""
  kafka-tls-key: ""
  login-github-oauth-client-secret: ""
  login-github-personal-access-token: ""
  login-google-groups-service-account.json: ""
  login-google-oauth-client-secret: ""
  login-jwt-secret: SECRETKEY
  login-oidc-client-secret: ""
  login-okta-client-secret: ""
  login-okta-directory-api-token: ""
  redpanda-admin-api-password: ""
  redpanda-admin-api-tls-ca: ""
  redpanda-admin-api-tls-cert: ""
  redpanda-admin-api-tls-key: ""
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env:
        - name: LOGIN_JWTSECRET
          valueFrom:
            secretKeyRef:
              key: login-jwt-secret
              name: redpanda-console
        - name: LICENSE
          valueFrom:
            secretKeyRef:
              key: enterprise-license
              name: redpanda-console
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/console/secrets
          name: secrets
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: secrets
        secret:
          secretName: redpanda-console
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.3.0
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.3.0
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.3.0
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.3.0
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          value: ATOTALLYVALIDLICENSE
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/default-v23.3.0-2.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"

    # Configure Rack Awareness
    set +x
    RACK=$(curl --silent --cacert /run/secrets/kubernetes.io/serviceaccount/ca.crt --fail -H 'Authorization: Bearer '$(cat /run/secrets/kubernetes.io/serviceaccount/token) "https://${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT_HTTPS}/api/v1/nodes/${KUBERNETES_NODE_NAME}?pretty=true" | grep '"topology-label"' | grep -v '\"key\":' | sed 's/.*": "\([^"]\+\).*/\1/')
    set -x
    rpk --config "$CONFIG" redpanda config set redpanda.rack "${RACK}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: true
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.3.0
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.3.0
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v23.3.0
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v23.3.0
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
          name: kube-api-access
          readOnly: true
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
      - name: kube-api-access
        projected:
          defaultMode: 420
          sources:
          - serviceAccountToken:
              expirationSeconds: 3607
              path: token
          - configMap:
              items:
              - key: ca.crt
                path: ca.crt
              name: kube-root-ca.crt
          - downwardAPI:
              items:
              - fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.namespace
                path: namespace
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/default-v24.1.0-0.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_batch_max_bytes: 7777
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 99999
    log_segment_size_min: 100
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.1.0
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.1.0
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.1.0
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.1.0
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/default-v24.1.0-1.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
stringData:
  enterprise-license: ATOTALLYVALIDLICENSE
  kafka-protobuf-git-basicauth-password: ""
  kafka-sasl-aws-msk-iam-secret-key: ""
  kafka-sasl-password: ""
  kafka-schema-registry-password: ""
  kafka-schemaregistry-tls-ca: ""
  kafka-schemaregistry-tls-cert: ""
  kafka-schemaregistry-tls-key: ""
  kafka-tls-ca: ""
  kafka-tls-cert: ""
  kafka-tls-key: ""
  login-github-oauth-client-secret: ""
  login-github-personal-access-token: ""
  login-google-groups-service-account.json: ""
  login-google-oauth-client-secret: ""
  login-jwt-secret: SECRETKEY
  login-oidc-client-secret: ""
  login-okta-client-secret: ""
  login-okta-directory-api-token: ""
  redpanda-admin-api-password: ""
  redpanda-admin-api-tls-ca: ""
  redpanda-admin-api-tls-cert: ""
  redpanda-admin-api-tls-key: ""
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env:
        - name: LOGIN_JWTSECRET
          valueFrom:
            secretKeyRef:
              key: login-jwt-secret
              name: redpanda-console
        - name: LICENSE
          valueFrom:
            secretKeyRef:
              key: enterprise-license
              name: redpanda-console
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/console/secrets
          name: secrets
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: secrets
        secret:
          secretName: redpanda-console
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.1.0
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.1.0
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.1.0
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.1.0
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          value: ATOTALLYVALIDLICENSE
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/default-v24.1.0-2.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"

    # Configure Rack Awareness
    set +x
    RACK=$(curl --silent --cacert /run/secrets/kubernetes.io/serviceaccount/ca.crt --fail -H 'Authorization: Bearer '$(cat /run/secrets/kubernetes.io/serviceaccount/token) "https://${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT_HTTPS}/api/v1/nodes/${KUBERNETES_NODE_NAME}?pretty=true" | grep '"topology-label"' | grep -v '\"key\":' | sed 's/.*": "\([^"]\+\).*/\1/')
    set -x
    rpk --config "$CONFIG" redpanda config set redpanda.rack "${RACK}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: true
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.1.0
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.1.0
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.1.0
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.1.0
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
          name: kube-api-access
          readOnly: true
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
      - name: kube-api-access
        projected:
          defaultMode: 420
          sources:
          - serviceAccountToken:
              expirationSeconds: 3607
              path: token
          - configMap:
              items:
              - key: ca.crt
                path: ca.crt
              name: kube-root-ca.crt
          - downwardAPI:
              items:
              - fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.namespace
                path: namespace
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/disable-cert-manager-overriding-defaults.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: some-secret
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: some-secret
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: some-other-secret
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: some-secret
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: some-other-secret
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/disable-cert-manger-fully-specified.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/for-internal/tls.crt
        enabled: true
        key_file: /etc/tls/certs/for-internal/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/ssl/certs/ca-certificates.crt
      - cert_file: /etc/tls/certs/for-external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/for-external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/ssl/certs/ca-certificates.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/for-internal/tls.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/for-internal/tls.crt
        enabled: true
        key_file: /etc/tls/certs/for-internal/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/ssl/certs/ca-certificates.crt
      - cert_file: /etc/tls/certs/for-external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/for-external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/ssl/certs/ca-certificates.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/for-internal/tls.crt
        enabled: true
        key_file: /etc/tls/certs/for-internal/tls.key
        require_client_auth: false
        truststore_file: /etc/ssl/certs/ca-certificates.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/for-internal/tls.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/for-internal/tls.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/for-internal/tls.crt
        enabled: true
        key_file: /etc/tls/certs/for-internal/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/ssl/certs/ca-certificates.crt
      - cert_file: /etc/tls/certs/for-external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/for-external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/ssl/certs/ca-certificates.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/for-internal/tls.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/for-internal/tls.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/for-internal/tls.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: 854c7070cbfa5b36c96c1a3810bd6b94bc3cfee53f0fb0f4b09ba6fbba07a26f
        checksum/config: 854c7070cbfa5b36c96c1a3810bd6b94bc3cfee53f0fb0f4b09ba6fbba07a26f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/for-internal
          name: redpanda-for-internal-cert
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-for-internal-cert
        secret:
          defaultMode: 272
          secretName: some-secret
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: fd140d05574a4b21ce6b2a6395458401c1e6186bf8e96c7af882169f664768f8
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/for-external
          name: redpanda-for-external-cert
        - mountPath: /etc/tls/certs/for-internal
          name: redpanda-for-internal-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/for-external
          name: redpanda-for-external-cert
        - mountPath: /etc/tls/certs/for-internal
          name: redpanda-for-internal-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/for-external
          name: redpanda-for-external-cert
        - mountPath: /etc/tls/certs/for-internal
          name: redpanda-for-internal-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/for-external
          name: redpanda-for-external-cert
        - mountPath: /etc/tls/certs/for-internal
          name: redpanda-for-internal-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-for-external-cert
        secret:
          defaultMode: 288
          secretName: some-other-secret
      - name: redpanda-for-internal-cert
        secret:
          defaultMode: 288
          secretName: some-secret
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/for-external
          name: redpanda-for-external-cert
        - mountPath: /etc/tls/certs/for-internal
          name: redpanda-for-internal-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-for-external-cert
        secret:
          defaultMode: 288
          secretName: some-other-secret
      - name: redpanda-for-internal-cert
        secret:
          defaultMode: 288
          secretName: some-secret
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/disabled-service-account-automount-token-in-service-account-resource.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
rules:
- apiGroups:
  - ""
  resources:
  - nodes
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - persistentvolumes
  verbs:
  - delete
  - get
  - list
  - patch
  - update
  - watch
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
rules:
- apiGroups:
  - ""
  resources:
  - nodes
  verbs:
  - get
  - list
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk-bundle
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  - endpoints
  - events
  - limitranges
  - persistentvolumeclaims
  - pods
  - pods/log
  - replicationcontrollers
  - resourcequotas
  - serviceaccounts
  - services
  verbs:
  - get
  - list
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: redpanda-sidecar-controllers
subjects:
- kind: ServiceAccount
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: redpanda
subjects:
- kind: ServiceAccount
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk-bundle
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: redpanda-rpk-bundle
subjects:
- kind: ServiceAccount
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
  namespace: default
rules:
- apiGroups:
  - apps
  resources:
  - statefulsets/status
  verbs:
  - patch
  - update
- apiGroups:
  - ""
  resources:
  - secrets
  - pods
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - apps
  resources:
  - statefulsets
  verbs:
  - get
  - patch
  - update
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - persistentvolumeclaims
  verbs:
  - delete
  - get
  - list
  - patch
  - update
  - watch
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
  namespace: default
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: redpanda-sidecar-controllers
subjects:
- kind: ServiceAccount
  name: redpanda
  namespace: default
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      - args:
        - --operator-mode=false
        - --namespace=default
        - --health-probe-bind-address=:8085
        - --metrics-bind-address=:9082
        - --pprof-bind-address=:9083
        - --additional-controllers=all
        command:
        - /manager
        env:
        - name: REDPANDA_HELM_RELEASE_NAME
          value: redpanda
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: redpanda-controllers
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
          name: kube-api-access
          readOnly: true
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: redpanda
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
      - name: kube-api-access
        projected:
          defaultMode: 420
          sources:
          - serviceAccountToken:
              expirationSeconds: 3607
              path: token
          - configMap:
              items:
              - key: ca.crt
                path: ca.crt
              name: kube-root-ca.crt
          - downwardAPI:
              items:
              - fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.namespace
                path: namespace
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: redpanda
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/enable-connectors-sasl.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    while true; do
      echo "RUNNING: Monitoring and Updating SASL users"
      USERS_DIR="/etc/secrets/users"

      new_users_list(){
        LIST=$1
        NEW_USER=$2
        if [[ -n "${LIST}" ]]; then
          LIST="${NEW_USER},${LIST}"
        else
          LIST="${NEW_USER}"
        fi

        echo "${LIST}"
      }

      process_users() {
        USERS_DIR=${1-"/etc/secrets/users"}
        USERS_FILE=$(find ${USERS_DIR}/* -print)
        USERS_LIST="kubernetes-controller"
        READ_LIST_SUCCESS=0
        # Read line by line, handle a missing EOL at the end of file
        while read p || [ -n "$p" ] ; do
          IFS=":" read -r USER_NAME PASSWORD MECHANISM <<< $p
          # Do not process empty lines
          if [ -z "$USER_NAME" ]; then
            continue
          fi
          if [[ "${USER_NAME// /}" != "$USER_NAME" ]]; then
            continue
          fi
          echo "Creating user ${USER_NAME}..."
          MECHANISM=${MECHANISM:-SCRAM-SHA-512}
          creation_result=$(rpk acl user create ${USER_NAME} -p ${PASSWORD} --mechanism ${MECHANISM} 2>&1) && creation_result_exit_code=$? || creation_result_exit_code=$?  # On a non-success exit code
          if [[ $creation_result_exit_code -ne 0 ]]; then
            # Check if the stderr contains "User already exists"
            # this error occurs when password has changed
            if [[ $creation_result == *"User already exists"* ]]; then
              echo "Update user ${USER_NAME}"
              # we will try to update by first deleting
              deletion_result=$(rpk acl user delete ${USER_NAME} 2>&1) && deletion_result_exit_code=$? || deletion_result_exit_code=$?
              if [[ $deletion_result_exit_code -ne 0 ]]; then
                echo "deletion of user ${USER_NAME} failed: ${deletion_result}"
                READ_LIST_SUCCESS=1
                break
              fi
              # Now we update the user
              update_result=$(rpk acl user create ${USER_NAME} -p ${PASSWORD} --mechanism ${MECHANISM} 2>&1) && update_result_exit_code=$? || update_result_exit_code=$?  # On a non-success exit code
              if [[ $update_result_exit_code -ne 0 ]]; then
                echo "updating user ${USER_NAME} failed: ${update_result}"
                READ_LIST_SUCCESS=1
                break
              else
                echo "Updated user ${USER_NAME}..."
                USERS_LIST=$(new_users_list "${USERS_LIST}" "${USER_NAME}")
              fi
            else
              # Another error occurred, so output the original message and exit code
              echo "error creating user ${USER_NAME}: ${creation_result}"
              READ_LIST_SUCCESS=1
              break
            fi
          # On a success, the user was created so output that
          else
            echo "Created user ${USER_NAME}..."
            USERS_LIST=$(new_users_list "${USERS_LIST}" "${USER_NAME}")
          fi
        done < $USERS_FILE

        if [[ -n "${USERS_LIST}" && ${READ_LIST_SUCCESS} ]]; then
          echo "Setting superusers configurations with users [${USERS_LIST}]"
          superuser_result=$(rpk cluster config set superusers [${USERS_LIST}] 2>&1) && superuser_result_exit_code=$? || superuser_result_exit_code=$?
          if [[ $superuser_result_exit_code -ne 0 ]]; then
              echo "Setting superusers configurations failed: ${superuser_result}"
          else
              echo "Completed setting superusers configurations"
          fi
        fi
      }

      # before we do anything ensure we have the bootstrap user
      echo "Ensuring bootstrap user ${RPK_USER}..."
      creation_result=$(rpk acl user create ${RPK_USER} -p ${RPK_PASS} --mechanism ${RPK_SASL_MECHANISM} 2>&1) && creation_result_exit_code=$? || creation_result_exit_code=$?  # On a non-success exit code
      if [[ $creation_result_exit_code -ne 0 ]]; then
        if [[ $creation_result == *"User already exists"* ]]; then
          echo "Bootstrap user already created"
        else
          echo "error creating user ${RPK_USER}: ${creation_result}"
        fi
      fi

      # first time processing
      process_users $USERS_DIR

      # subsequent changes detected here
      # watching delete_self as documented in https://ahmet.im/blog/kubernetes-inotify/
      USERS_FILE=$(find ${USERS_DIR}/* -print)
      while RES=$(inotifywait -q -e delete_self ${USERS_FILE}); do
        process_users $USERS_DIR
      done
    done
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-bootstrap-user
  namespace: default
stringData:
  password: changeme
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: true
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: true
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
    superusers:
    - kubernetes-controller
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        authentication_method: http_basic
        name: internal
        port: 8082
      - address: 0.0.0.0
        authentication_method: http_basic
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        authentication_method: sasl
        name: internal
        port: 9093
      - address: 0.0.0.0
        authentication_method: sasl
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        authentication_method: http_basic
        name: internal
        port: 8081
      - address: 0.0.0.0
        authentication_method: http_basic
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    connect:
      clusters:
      - name: connectors
        password: ""
        tls:
          caFilepath: ""
          certFilepath: ""
          enabled: false
          insecureSkipTlsVerify: false
          keyFilepath: ""
        token: ""
        url: http://redpanda-connectors.default.svc.cluster.local:8083
        username: ""
      connectTimeout: 0
      enabled: true
      readTimeout: 0
      requestTimeout: 0
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: true
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/connectors/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: connectors
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: connectors
    helm.sh/chart: connectors-0.1.14
  name: redpanda-connectors
spec:
  ipFamilies:
  - IPv4
  ipFamilyPolicy: SingleStack
  ports:
  - name: rest-api
    port: 8083
    protocol: TCP
    targetPort: 8083
  - name: prometheus
    port: 9404
    protocol: TCP
    targetPort: 9404
  selector:
    app.kubernetes.io/component: connectors
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: connectors
  sessionAffinity: None
  type: ClusterIP
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: 5e53a21bf2aa20d9471169eeafe012a28cab465bff1ab9248550d6e44e7330f5
        checksum/config: 5e53a21bf2aa20d9471169eeafe012a28cab465bff1ab9248550d6e44e7330f5
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command:
        - sh
        - -c
        - set -e; IFS=':' read -r KAFKA_SASL_USERNAME KAFKA_SASL_PASSWORD KAFKA_SASL_MECHANISM
          < <(grep "" $(find /mnt/users/* -print)); KAFKA_SASL_MECHANISM=${KAFKA_SASL_MECHANISM:-SCRAM-SHA-512};
          export KAFKA_SASL_USERNAME KAFKA_SASL_PASSWORD KAFKA_SASL_MECHANISM; export
          KAFKA_SCHEMAREGISTRY_USERNAME=$KAFKA_SASL_USERNAME; export KAFKA_SCHEMAREGISTRY_PASSWORD=$KAFKA_SASL_PASSWORD;
          export REDPANDA_ADMINAPI_USERNAME=$KAFKA_SASL_USERNAME; export REDPANDA_ADMINAPI_PASSWORD=$KAFKA_SASL_PASSWORD;
          /app/console $@
        - ' --'
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /mnt/users
          name: redpanda-users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-users
        secret:
          secretName: redpanda-users
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: connectors
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: connectors
    helm.sh/chart: connectors-0.1.14
  name: redpanda-connectors
spec:
  progressDeadlineSeconds: 600
  replicas: null
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app.kubernetes.io/component: connectors
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: connectors
  strategy:
    type: RollingUpdate
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: connectors
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: connectors
    spec:
      affinity:
        nodeAffinity: {}
        podAffinity: {}
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: connectors
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: connectors
            namespaces:
            - default
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - bash
        - -c
        - set -e; IFS=':' read -r CONNECT_SASL_USERNAME CONNECT_SASL_PASSWORD CONNECT_SASL_MECHANISM
          < <(grep "" $(find /mnt/users/* -print)); CONNECT_SASL_MECHANISM=${CONNECT_SASL_MECHANISM:-SCRAM-SHA-512};
          export CONNECT_SASL_USERNAME CONNECT_SASL_PASSWORD CONNECT_SASL_MECHANISM;
          [[ $CONNECT_SASL_MECHANISM == "SCRAM-SHA-256" ]] && CONNECT_SASL_MECHANISM=scram-sha-256;
          [[ $CONNECT_SASL_MECHANISM == "SCRAM-SHA-512" ]] && CONNECT_SASL_MECHANISM=scram-sha-512;
          export CONNECT_SASL_MECHANISM; echo $CONNECT_SASL_PASSWORD > /opt/kafka/connect-password/rc-credentials/password;
          exec /opt/kafka/bin/kafka_connect_run.sh
        env:
        - name: CONNECT_CONFIGURATION
          value: |-
            rest.advertised.port=8083
            rest.port=8083
            key.converter=org.apache.kafka.connect.converters.ByteArrayConverter
            value.converter=org.apache.kafka.connect.converters.ByteArrayConverter
            group.id=connectors-cluster
            offset.storage.topic=_internal_connectors_offsets
            config.storage.topic=_internal_connectors_configs
            status.storage.topic=_internal_connectors_status
            offset.storage.redpanda.remote.read=false
            offset.storage.redpanda.remote.write=false
            config.storage.redpanda.remote.read=false
            config.storage.redpanda.remote.write=false
            status.storage.redpanda.remote.read=false
            status.storage.redpanda.remote.write=false
            offset.storage.replication.factor=-1
            config.storage.replication.factor=-1
            status.storage.replication.factor=-1
            producer.linger.ms=1
            producer.batch.size=131072
            config.providers=file,secretsManager,env
            config.providers.file.class=org.apache.kafka.common.config.provider.FileConfigProvider
            config.providers.env.class=org.apache.kafka.common.config.provider.EnvVarConfigProvider
        - name: CONNECT_ADDITIONAL_CONFIGURATION
          value: ""
        - name: CONNECT_BOOTSTRAP_SERVERS
          value: redpanda-0.redpanda.default.svc.cluster.local.:9093,redpanda-1.redpanda.default.svc.cluster.local.:9093,redpanda-2.redpanda.default.svc.cluster.local.:9093
        - name: CONNECT_GC_LOG_ENABLED
          value: "false"
        - name: CONNECT_HEAP_OPTS
          value: -Xms256M -Xmx2G
        - name: CONNECT_LOG_LEVEL
          value: warn
        - name: CONNECT_TLS_ENABLED
          value: "true"
        - name: CONNECT_TRUSTED_CERTS
          value: ca/ca.crt
        - name: CONNECT_SASL_PASSWORD_FILE
          value: rc-credentials/password
        envFrom: []
        image: docker.redpanda.com/redpandadata/connectors:v1.0.31
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /
            port: rest-api
            scheme: HTTP
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: connectors-cluster
        ports:
        - containerPort: 8083
          name: rest-api
          protocol: TCP
        - containerPort: 9404
          name: prometheus
          protocol: TCP
        readinessProbe:
          failureThreshold: 2
          httpGet:
            path: /connectors
            port: rest-api
            scheme: HTTP
          initialDelaySeconds: 60
          periodSeconds: 10
          successThreshold: 3
          timeoutSeconds: 5
        resources:
          limits:
            cpu: "1"
            memory: 2350Mi
          requests:
            cpu: "1"
            memory: 2350Mi
        securityContext:
          allowPrivilegeEscalation: false
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /opt/kafka/connect-certs/ca
          name: truststore
        - mountPath: /tmp
          name: rp-connect-tmp
        - mountPath: /mnt/users
          name: redpanda-users
          readOnly: true
        - mountPath: /opt/kafka/connect-password/rc-credentials
          name: redpanda-user-password
      dnsPolicy: ClusterFirst
      imagePullSecrets: []
      nodeSelector: {}
      restartPolicy: Always
      schedulerName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
        runAsUser: 101
      serviceAccountName: default
      terminationGracePeriodSeconds: 30
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: connectors
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: connectors
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: truststore
        secret:
          defaultMode: 292
          secretName: redpanda-default-cert
      - emptyDir:
          medium: Memory
          sizeLimit: 5Mi
        name: rp-connect-tmp
      - name: redpanda-users
        secret:
          secretName: redpanda-users
      - emptyDir: {}
        name: redpanda-user-password
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: ddcf6376732939f810acb684cafac205507b50b966e5714f128ed87a56fb10f6
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        - name: RP_BOOTSTRAP_USER
          value: $(RPK_USER):$(RPK_PASS):$(RPK_SASL_MECHANISM)
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env:
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: users
        secret:
          secretName: redpanda-users
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        - name: RP_BOOTSTRAP_USER
          value: $(RPK_USER):$(RPK_PASS):$(RPK_SASL_MECHANISM)
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: users
        secret:
          secretName: redpanda-users
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/enable-connectors.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    connect:
      clusters:
      - name: connectors
        password: ""
        tls:
          caFilepath: ""
          certFilepath: ""
          enabled: false
          insecureSkipTlsVerify: false
          keyFilepath: ""
        token: ""
        url: http://redpanda-connectors.default.svc.cluster.local:8083
        username: ""
      connectTimeout: 0
      enabled: true
      readTimeout: 0
      requestTimeout: 0
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/connectors/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: connectors
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: connectors
    helm.sh/chart: connectors-0.1.14
  name: redpanda-connectors
spec:
  ipFamilies:
  - IPv4
  ipFamilyPolicy: SingleStack
  ports:
  - name: rest-api
    port: 8083
    protocol: TCP
    targetPort: 8083
  - name: prometheus
    port: 9404
    protocol: TCP
    targetPort: 9404
  selector:
    app.kubernetes.io/component: connectors
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: connectors
  sessionAffinity: None
  type: ClusterIP
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: 1894d433f8a13a5d76ec09415a79b012be1f5fd3c528f7e41b040909a8092a28
        checksum/config: 1894d433f8a13a5d76ec09415a79b012be1f5fd3c528f7e41b040909a8092a28
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: connectors
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: connectors
    helm.sh/chart: connectors-0.1.14
  name: redpanda-connectors
spec:
  progressDeadlineSeconds: 600
  replicas: null
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app.kubernetes.io/component: connectors
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: connectors
  strategy:
    type: RollingUpdate
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: connectors
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: connectors
    spec:
      affinity:
        nodeAffinity: {}
        podAffinity: {}
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: connectors
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: connectors
            namespaces:
            - default
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command: null
        env:
        - name: CONNECT_CONFIGURATION
          value: |-
            rest.advertised.port=8083
            rest.port=8083
            key.converter=org.apache.kafka.connect.converters.ByteArrayConverter
            value.converter=org.apache.kafka.connect.converters.ByteArrayConverter
            group.id=connectors-cluster
            offset.storage.topic=_internal_connectors_offsets
            config.storage.topic=_internal_connectors_configs
            status.storage.topic=_internal_connectors_status
            offset.storage.redpanda.remote.read=false
            offset.storage.redpanda.remote.write=false
            config.storage.redpanda.remote.read=false
            config.storage.redpanda.remote.write=false
            status.storage.redpanda.remote.read=false
            status.storage.redpanda.remote.write=false
            offset.storage.replication.factor=-1
            config.storage.replication.factor=-1
            status.storage.replication.factor=-1
            producer.linger.ms=1
            producer.batch.size=131072
            config.providers=file,secretsManager,env
            config.providers.file.class=org.apache.kafka.common.config.provider.FileConfigProvider
            config.providers.env.class=org.apache.kafka.common.config.provider.EnvVarConfigProvider
        - name: CONNECT_ADDITIONAL_CONFIGURATION
          value: ""
        - name: CONNECT_BOOTSTRAP_SERVERS
          value: redpanda-0.redpanda.default.svc.cluster.local.:9093,redpanda-1.redpanda.default.svc.cluster.local.:9093,redpanda-2.redpanda.default.svc.cluster.local.:9093
        - name: CONNECT_GC_LOG_ENABLED
          value: "false"
        - name: CONNECT_HEAP_OPTS
          value: -Xms256M -Xmx2G
        - name: CONNECT_LOG_LEVEL
          value: warn
        - name: CONNECT_TLS_ENABLED
          value: "true"
        - name: CONNECT_TRUSTED_CERTS
          value: ca/ca.crt
        envFrom: []
        image: docker.redpanda.com/redpandadata/connectors:v1.0.31
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /
            port: rest-api
            scheme: HTTP
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: connectors-cluster
        ports:
        - containerPort: 8083
          name: rest-api
          protocol: TCP
        - containerPort: 9404
          name: prometheus
          protocol: TCP
        readinessProbe:
          failureThreshold: 2
          httpGet:
            path: /connectors
            port: rest-api
            scheme: HTTP
          initialDelaySeconds: 60
          periodSeconds: 10
          successThreshold: 3
          timeoutSeconds: 5
        resources:
          limits:
            cpu: "1"
            memory: 2350Mi
          requests:
            cpu: "1"
            memory: 2350Mi
        securityContext:
          allowPrivilegeEscalation: false
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /opt/kafka/connect-certs/ca
          name: truststore
        - mountPath: /tmp
          name: rp-connect-tmp
      dnsPolicy: ClusterFirst
      imagePullSecrets: []
      nodeSelector: {}
      restartPolicy: Always
      schedulerName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
        runAsUser: 101
      serviceAccountName: default
      terminationGracePeriodSeconds: 30
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: connectors
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: connectors
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: truststore
        secret:
          defaultMode: 292
          secretName: redpanda-default-cert
      - emptyDir:
          medium: Memory
          sizeLimit: 5Mi
        name: rp-connect-tmp
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/enabled-service-account-automount-token-in-service-account-resource.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: true
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
rules:
- apiGroups:
  - ""
  resources:
  - nodes
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - persistentvolumes
  verbs:
  - delete
  - get
  - list
  - patch
  - update
  - watch
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
rules:
- apiGroups:
  - ""
  resources:
  - nodes
  verbs:
  - get
  - list
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk-bundle
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  - endpoints
  - events
  - limitranges
  - persistentvolumeclaims
  - pods
  - pods/log
  - replicationcontrollers
  - resourcequotas
  - serviceaccounts
  - services
  verbs:
  - get
  - list
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: redpanda-sidecar-controllers
subjects:
- kind: ServiceAccount
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: redpanda
subjects:
- kind: ServiceAccount
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk-bundle
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: redpanda-rpk-bundle
subjects:
- kind: ServiceAccount
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
  namespace: default
rules:
- apiGroups:
  - apps
  resources:
  - statefulsets/status
  verbs:
  - patch
  - update
- apiGroups:
  - ""
  resources:
  - secrets
  - pods
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - apps
  resources:
  - statefulsets
  verbs:
  - get
  - patch
  - update
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - persistentvolumeclaims
  verbs:
  - delete
  - get
  - list
  - patch
  - update
  - watch
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
  namespace: default
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: redpanda-sidecar-controllers
subjects:
- kind: ServiceAccount
  name: redpanda
  namespace: default
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      - args:
        - --operator-mode=false
        - --namespace=default
        - --health-probe-bind-address=:8085
        - --metrics-bind-address=:9082
        - --pprof-bind-address=:9083
        - --additional-controllers=all
        command:
        - /manager
        env:
        - name: REDPANDA_HELM_RELEASE_NAME
          value: redpanda
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: redpanda-controllers
        resources: {}
        securityContext: {}
        volumeMounts: []
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: redpanda
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: redpanda
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/enabled-service-account-automount-token-with-volume-overwrite.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: true
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
rules:
- apiGroups:
  - ""
  resources:
  - nodes
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - persistentvolumes
  verbs:
  - delete
  - get
  - list
  - patch
  - update
  - watch
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
rules:
- apiGroups:
  - ""
  resources:
  - nodes
  verbs:
  - get
  - list
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk-bundle
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  - endpoints
  - events
  - limitranges
  - persistentvolumeclaims
  - pods
  - pods/log
  - replicationcontrollers
  - resourcequotas
  - serviceaccounts
  - services
  verbs:
  - get
  - list
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: redpanda-sidecar-controllers
subjects:
- kind: ServiceAccount
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: redpanda
subjects:
- kind: ServiceAccount
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk-bundle
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: redpanda-rpk-bundle
subjects:
- kind: ServiceAccount
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
  namespace: default
rules:
- apiGroups:
  - apps
  resources:
  - statefulsets/status
  verbs:
  - patch
  - update
- apiGroups:
  - ""
  resources:
  - secrets
  - pods
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - apps
  resources:
  - statefulsets
  verbs:
  - get
  - patch
  - update
  - list
  - watch
- apiGroups:
  - ""
  resources:
  - persistentvolumeclaims
  verbs:
  - delete
  - get
  - list
  - patch
  - update
  - watch
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sidecar-controllers
  namespace: default
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: redpanda-sidecar-controllers
subjects:
- kind: ServiceAccount
  name: redpanda
  namespace: default
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      - args:
        - --operator-mode=false
        - --namespace=default
        - --health-probe-bind-address=:8085
        - --metrics-bind-address=:9082
        - --pprof-bind-address=:9083
        - --additional-controllers=all
        command:
        - /manager
        env:
        - name: REDPANDA_HELM_RELEASE_NAME
          value: redpanda
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: redpanda-controllers
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
          name: kube-api-access-overwrite
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: redpanda
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
      - name: kube-api-access-overwrite
        projected:
          defaultMode: 420
          sources:
          - serviceAccountToken:
              expirationSeconds: 666
              path: token
          - configMap:
              items:
              - key: ca.crt
                path: ca.crt
              name: some-kube-root-ca-config-map.crt
          - downwardAPI:
              items:
              - fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.namespace
                path: namespace
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: redpanda
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/extra-volumes-and-volumesmounts.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-fs-validator
  namespace: default
stringData:
  fsValidator.sh: |-
    set -e
    EXPECTED_FS_TYPE=$1

    DATA_DIR="/var/lib/redpanda/data"
    TEST_FILE="testfile"

    echo "checking data directory exist..."
    if [ ! -d "${DATA_DIR}" ]; then
      echo "data directory does not exists, exiting"
      exit 1
    fi

    echo "checking filesystem type..."
    FS_TYPE=$(df -T $DATA_DIR  | tail -n +2 | awk '{print $2}')

    if [ "${FS_TYPE}" != "${EXPECTED_FS_TYPE}" ]; then
      echo "file system found to be ${FS_TYPE} when expected ${EXPECTED_FS_TYPE}"
      exit 1
    fi

    echo "checking if able to create a test file..."

    touch ${DATA_DIR}/${TEST_FILE}
    result=$(touch ${DATA_DIR}/${TEST_FILE} 2> /dev/null; echo $?)
    if [ "${result}" != "0" ]; then
      echo "could not write testfile, may not have write permission"
      exit 1
    fi

    echo "checking if able to delete a test file..."

    result=$(rm ${DATA_DIR}/${TEST_FILE} 2> /dev/null; echo $?)
    if [ "${result}" != "0" ]; then
      echo "could not delete testfile"
      exit 1
    fi

    echo "passed"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
        - mountPath: /fake/lifecycle
          name: test-extra-volume
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
        - mountPath: /fake/config-watcher
          name: test-extra-volume
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /fake/tuning
          name: test-extra-volume
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/sh
        - -c
        - chown 101:101 -R /var/lib/redpanda/data
        env: null
        image: busybox:latest
        name: set-datadir-ownership
        resources: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /fake/setDataDirOwnership
          name: test-extra-volume
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/fs-validator/scripts/fsValidator.sh
          xfs & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: fs-validator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /fake/fsValidator
          name: test-extra-volume
        - mountPath: /etc/secrets/fs-validator/scripts/
          name: redpanda-fs-validator
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /fake/configurator
          name: test-extra-volume
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      - args:
        - |-
          set -xe
          echo "Hello World!"
        command:
        - /bin/bash
        - -c
        env: null
        image: mintel/docker-alpine-bash-curl-jq:latest
        name: test-init-container
        volumeMounts: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: redpanda-fs-validator
        secret:
          defaultMode: 509
          secretName: redpanda-fs-validator
      - name: test-extra-volume
        secret:
          defaultMode: 508
          secretName: redpanda-sts-lifecycle
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/fix-tpl-generation-multiple-addresses.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE="$POD_ORDINAL-XYZ-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"rp0.REDPANDAREDPANDAREDPANDA-testing\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE="$POD_ORDINAL-XYZ-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"rp1.REDPANDAREDPANDAREDPANDA-testing\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE="$POD_ORDINAL-XYZ-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"rp2.REDPANDAREDPANDAREDPANDA-testing\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE="$POD_ORDINAL-XYZ-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"rp0.REDPANDAREDPANDAREDPANDA-testing\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE="$POD_ORDINAL-XYZ-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"rp1.REDPANDAREDPANDAREDPANDA-testing\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE="$POD_ORDINAL-XYZ-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"rp2.REDPANDAREDPANDAREDPANDA-testing\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - rp0.REDPANDAREDPANDAREDPANDA-testing:31644
      - rp1.REDPANDAREDPANDAREDPANDA-testing:31644
      - rp2.REDPANDAREDPANDAREDPANDA-testing:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - rp0.REDPANDAREDPANDAREDPANDA-testing:31092
      - rp1.REDPANDAREDPANDAREDPANDA-testing:31092
      - rp2.REDPANDAREDPANDAREDPANDA-testing:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - rp0.REDPANDAREDPANDAREDPANDA-testing:30081
      - rp1.REDPANDAREDPANDAREDPANDA-testing:30081
      - rp2.REDPANDAREDPANDAREDPANDA-testing:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations:
    external-dns.alpha.kubernetes.io/hostname: rp0.REDPANDAREDPANDAREDPANDA-testing
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    repdanda.com/type: loadbalancer
  name: lb-redpanda-0
  namespace: default
spec:
  externalTrafficPolicy: Local
  loadBalancerSourceRanges: null
  ports:
  - name: admin-default
    port: 31644
    protocol: TCP
    targetPort: 9645
  - name: kafka-default
    port: 31092
    protocol: TCP
    targetPort: 9094
  - name: http-default
    port: 30082
    protocol: TCP
    targetPort: 8083
  - name: schema-default
    port: 30081
    protocol: TCP
    targetPort: 8084
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
    statefulset.kubernetes.io/pod-name: redpanda-0
  sessionAffinity: None
  type: LoadBalancer
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations:
    external-dns.alpha.kubernetes.io/hostname: rp1.REDPANDAREDPANDAREDPANDA-testing
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    repdanda.com/type: loadbalancer
  name: lb-redpanda-1
  namespace: default
spec:
  externalTrafficPolicy: Local
  loadBalancerSourceRanges: null
  ports:
  - name: admin-default
    port: 31644
    protocol: TCP
    targetPort: 9645
  - name: kafka-default
    port: 31092
    protocol: TCP
    targetPort: 9094
  - name: http-default
    port: 30082
    protocol: TCP
    targetPort: 8083
  - name: schema-default
    port: 30081
    protocol: TCP
    targetPort: 8084
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
    statefulset.kubernetes.io/pod-name: redpanda-1
  sessionAffinity: None
  type: LoadBalancer
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations:
    external-dns.alpha.kubernetes.io/hostname: rp2.REDPANDAREDPANDAREDPANDA-testing
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    repdanda.com/type: loadbalancer
  name: lb-redpanda-2
  namespace: default
spec:
  externalTrafficPolicy: Local
  loadBalancerSourceRanges: null
  ports:
  - name: admin-default
    port: 31644
    protocol: TCP
    targetPort: 9645
  - name: kafka-default
    port: 31092
    protocol: TCP
    targetPort: 9094
  - name: http-default
    port: 30082
    protocol: TCP
    targetPort: 8083
  - name: schema-default
    port: 30081
    protocol: TCP
    targetPort: 8084
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
    statefulset.kubernetes.io/pod-name: redpanda-2
  sessionAffinity: None
  type: LoadBalancer
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: c78188d8cc1a290ac7796eded5f3a49988f7a44a5971aad33fe89b9b32293cfa
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  - REDPANDAREDPANDAREDPANDA-testing
  - '*.REDPANDAREDPANDAREDPANDA-testing'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  - REDPANDAREDPANDAREDPANDA-testing
  - '*.REDPANDAREDPANDAREDPANDA-testing'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/fix-tpl-generation.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE="$POD_ORDINAL-XYZ-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.REDPANDAREDPANDAREDPANDA-testing\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE="$POD_ORDINAL-XYZ-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.REDPANDAREDPANDAREDPANDA-testing\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE="$POD_ORDINAL-XYZ-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.REDPANDAREDPANDAREDPANDA-testing\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE="$POD_ORDINAL-XYZ-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.REDPANDAREDPANDAREDPANDA-testing\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE="$POD_ORDINAL-XYZ-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.REDPANDAREDPANDAREDPANDA-testing\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE="$POD_ORDINAL-XYZ-$(echo -n $HOST_IP_ADDRESS | sha256sum | head -c 7)"
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"$PREFIX_TEMPLATE.REDPANDAREDPANDAREDPANDA-testing\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - $PREFIX_TEMPLATE.REDPANDAREDPANDAREDPANDA-testing:31644
      - $PREFIX_TEMPLATE.REDPANDAREDPANDAREDPANDA-testing:31644
      - $PREFIX_TEMPLATE.REDPANDAREDPANDAREDPANDA-testing:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - $PREFIX_TEMPLATE.REDPANDAREDPANDAREDPANDA-testing:31092
      - $PREFIX_TEMPLATE.REDPANDAREDPANDAREDPANDA-testing:31092
      - $PREFIX_TEMPLATE.REDPANDAREDPANDAREDPANDA-testing:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - $PREFIX_TEMPLATE.REDPANDAREDPANDAREDPANDA-testing:30081
      - $PREFIX_TEMPLATE.REDPANDAREDPANDAREDPANDA-testing:30081
      - $PREFIX_TEMPLATE.REDPANDAREDPANDAREDPANDA-testing:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations:
    external-dns.alpha.kubernetes.io/hostname: $PREFIX_TEMPLATE.REDPANDAREDPANDAREDPANDA-testing
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    repdanda.com/type: loadbalancer
  name: lb-redpanda-0
  namespace: default
spec:
  externalTrafficPolicy: Local
  loadBalancerSourceRanges: null
  ports:
  - name: admin-default
    port: 31644
    protocol: TCP
    targetPort: 9645
  - name: kafka-default
    port: 31092
    protocol: TCP
    targetPort: 9094
  - name: http-default
    port: 30082
    protocol: TCP
    targetPort: 8083
  - name: schema-default
    port: 30081
    protocol: TCP
    targetPort: 8084
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
    statefulset.kubernetes.io/pod-name: redpanda-0
  sessionAffinity: None
  type: LoadBalancer
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations:
    external-dns.alpha.kubernetes.io/hostname: $PREFIX_TEMPLATE.REDPANDAREDPANDAREDPANDA-testing
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    repdanda.com/type: loadbalancer
  name: lb-redpanda-1
  namespace: default
spec:
  externalTrafficPolicy: Local
  loadBalancerSourceRanges: null
  ports:
  - name: admin-default
    port: 31644
    protocol: TCP
    targetPort: 9645
  - name: kafka-default
    port: 31092
    protocol: TCP
    targetPort: 9094
  - name: http-default
    port: 30082
    protocol: TCP
    targetPort: 8083
  - name: schema-default
    port: 30081
    protocol: TCP
    targetPort: 8084
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
    statefulset.kubernetes.io/pod-name: redpanda-1
  sessionAffinity: None
  type: LoadBalancer
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations:
    external-dns.alpha.kubernetes.io/hostname: $PREFIX_TEMPLATE.REDPANDAREDPANDAREDPANDA-testing
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    repdanda.com/type: loadbalancer
  name: lb-redpanda-2
  namespace: default
spec:
  externalTrafficPolicy: Local
  loadBalancerSourceRanges: null
  ports:
  - name: admin-default
    port: 31644
    protocol: TCP
    targetPort: 9645
  - name: kafka-default
    port: 31092
    protocol: TCP
    targetPort: 9094
  - name: http-default
    port: 30082
    protocol: TCP
    targetPort: 8083
  - name: schema-default
    port: 30081
    protocol: TCP
    targetPort: 8084
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
    statefulset.kubernetes.io/pod-name: redpanda-2
  sessionAffinity: None
  type: LoadBalancer
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 40b1555a526efc78caf3107b6358b05773b82d09ed9b9671ad6524e40176955a
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  - REDPANDAREDPANDAREDPANDA-testing
  - '*.REDPANDAREDPANDAREDPANDA-testing'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  - REDPANDAREDPANDAREDPANDA-testing
  - '*.REDPANDAREDPANDAREDPANDA-testing'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/internal-trust-stores.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"my-kafka\",\"port\":1234}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"my-kafka\",\"port\":1234}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"my-kafka\",\"port\":1234}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[2] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"my-http\",\"port\":1234}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"my-http\",\"port\":1234}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"my-http\",\"port\":1234}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[2] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      - address: 0.0.0.0
        name: my-http
        port: 1234
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/truststores/configmaps/http-cm-ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: my-http
        require_client_auth: false
        truststore_file: /etc/truststores/configmaps/http-cm-my-http.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      - address: 0.0.0.0
        name: my-admin
        port: 1234
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/truststores/configmaps/admin-cm-other.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: my-admin
        require_client_auth: false
        truststore_file: /etc/truststores/configmaps/admin-cm-my-admin.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      - address: 0.0.0.0
        name: my-kafka
        port: 1234
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/truststores/configmaps/my-ca-bundle-ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: my-kafka
        require_client_auth: false
        truststore_file: /etc/truststores/secrets/kafka-secret-my-kafka.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      - address: 0.0.0.0
        name: my-sr
        port: 1234
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/truststores/secrets/sr-secret-ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: my-sr
        require_client_auth: false
        truststore_file: /etc/truststores/secrets/sr-secret-my-sr.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: admin-my-admin
    nodePort: 1234
    port: 1234
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: kafka-my-kafka
    nodePort: 1234
    port: 1234
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: http-my-http
    nodePort: 1234
    port: 1234
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  - name: schema-my-sr
    nodePort: 1234
    port: 1234
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/truststores
          name: truststores
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: truststores
        projected:
          sources:
          - configMap:
              items:
              - key: other.crt
                path: configmaps/admin-cm-other.crt
              - key: my-admin.crt
                path: configmaps/admin-cm-my-admin.crt
              name: admin-cm
          - configMap:
              items:
              - key: ca.crt
                path: configmaps/http-cm-ca.crt
              - key: my-http.crt
                path: configmaps/http-cm-my-http.crt
              name: http-cm
          - configMap:
              items:
              - key: ca.crt
                path: configmaps/my-ca-bundle-ca.crt
              name: my-ca-bundle
          - secret:
              items:
              - key: my-kafka.crt
                path: secrets/kafka-secret-my-kafka.crt
              name: kafka-secret
          - secret:
              items:
              - key: ca.crt
                path: secrets/sr-secret-ca.crt
              - key: my-sr.crt
                path: secrets/sr-secret-my-sr.crt
              name: sr-secret
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 94c9073f00666e990b3c71fa079076ea050fb87cd0cc32f503bbe21fb198294e
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 1234
          name: admin-my-admin
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 1234
          name: http-my-http
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 1234
          name: kafka-my-kafka
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        - containerPort: 1234
          name: schema-my-sr
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
        - mountPath: /etc/truststores
          name: truststores
          readOnly: true
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: truststores
        projected:
          sources:
          - configMap:
              items:
              - key: other.crt
                path: configmaps/admin-cm-other.crt
              - key: my-admin.crt
                path: configmaps/admin-cm-my-admin.crt
              name: admin-cm
          - configMap:
              items:
              - key: ca.crt
                path: configmaps/http-cm-ca.crt
              - key: my-http.crt
                path: configmaps/http-cm-my-http.crt
              name: http-cm
          - configMap:
              items:
              - key: ca.crt
                path: configmaps/my-ca-bundle-ca.crt
              name: my-ca-bundle
          - secret:
              items:
              - key: my-kafka.crt
                path: secrets/kafka-secret-my-kafka.crt
              name: kafka-secret
          - secret:
              items:
              - key: ca.crt
                path: secrets/sr-secret-ca.crt
              - key: my-sr.crt
                path: secrets/sr-secret-my-sr.crt
              name: sr-secret
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/mtls-client-regression.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        cert_file: /etc/tls/certs/redpanda-client/tls.crt
        enabled: true
        key_file: /etc/tls/certs/redpanda-client/tls.key
        require_client_auth: true
        truststore_file: /etc/tls/certs/kafka-internal-0/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        authentication_method: none
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/kafka-internal-0/tls.crt
        enabled: true
        key_file: /etc/tls/certs/kafka-internal-0/tls.key
        name: internal
        require_client_auth: true
        truststore_file: /etc/tls/certs/kafka-internal-0/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/kafka-internal-0/ca.crt
          cert_file: /etc/tls/certs/redpanda-client/tls.crt
          key_file: /etc/tls/certs/redpanda-client/tls.key
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        cert_file: /etc/tls/certs/redpanda-client/tls.crt
        enabled: true
        key_file: /etc/tls/certs/redpanda-client/tls.key
        require_client_auth: true
        truststore_file: /etc/tls/certs/kafka-internal-0/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
        cert_file: /etc/tls/certs/redpanda-client/tls.crt
        key_file: /etc/tls/certs/redpanda-client/tls.key
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/kafka-internal-0/ca.crt
        certFilepath: /etc/tls/certs/kafka-internal-0/tls.crt
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: /etc/tls/certs/kafka-internal-0/tls.key
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: 76c131535732e862e4209226f3d94362a0a1b5c8276f68ffd2d3d27a86364289
        checksum/config: 76c131535732e862e4209226f3d94362a0a1b5c8276f68ffd2d3d27a86364289
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/kafka-internal-0
          name: redpanda-kafka-internal-0-cert
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-kafka-internal-0-cert
        secret:
          defaultMode: 272
          secretName: redpanda-kafka-internal-0-cert
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 321ff8691ac4f68ffb27c9740544981cf2a289b856d21a3d3eb6b8bab9fe4d05
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/tls/certs/kafka-internal-0
          name: redpanda-kafka-internal-0-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/tls/certs/kafka-internal-0
          name: redpanda-kafka-internal-0-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/tls/certs/kafka-internal-0
          name: redpanda-kafka-internal-0-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/tls/certs/kafka-internal-0
          name: redpanda-kafka-internal-0-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: redpanda-kafka-internal-0-cert
        secret:
          defaultMode: 288
          secretName: redpanda-kafka-internal-0-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-kafka-internal-0-root-certificate
  namespace: default
spec:
  commonName: redpanda-kafka-internal-0-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-kafka-internal-0-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-kafka-internal-0-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-kafka-internal-0-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-kafka-internal-0-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-kafka-internal-0-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-client
spec:
  commonName: redpanda-client
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-kafka-internal-0-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-client
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-kafka-internal-0-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-kafka-internal-0-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-kafka-internal-0-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/tls/certs/kafka-internal-0
          name: redpanda-kafka-internal-0-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: redpanda-kafka-internal-0-cert
        secret:
          defaultMode: 288
          secretName: redpanda-kafka-internal-0-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/node-config-boolean-type-regression.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      developer_mode: true
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b5b5d0fb08868933f0fea06ea634d950c13380b1e9ca7d5f944b9591eeeb2e41
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/service-monitor-with-tls-in-admin-api.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "true"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  endpoints:
  - enableHttp2: null
    interval: 30s
    path: /public_metrics
    port: admin
    scheme: https
    tlsConfig:
      ca: {}
      cert: {}
      insecureSkipVerify: true
  namespaceSelector: {}
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      monitoring.redpanda.com/enabled: "true"
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/service-monitor-without-tls-in-admin-api.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="http://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail  ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent  ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX}  ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX}  ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls: null
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls: null
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls: null
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: ""
          certFilepath: ""
          enabled: false
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - http://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "true"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: 3625f2840a697b642d4050810321c97582f99f49531381188ab86eb679f2d2b3
        checksum/config: 3625f2840a697b642d4050810321c97582f99f49531381188ab86eb679f2d2b3
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b8e0da1a021479fef4009079ccab692b64a4149233b6a0852c151097c6926cd8
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5  "http://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5  "http://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  endpoints:
  - enableHttp2: null
    interval: 30s
    path: /public_metrics
    port: admin
    scheme: http
  namespaceSelector: {}
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      monitoring.redpanda.com/enabled: "true"
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/some-company-1.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    while true; do
      echo "RUNNING: Monitoring and Updating SASL users"
      USERS_DIR="/etc/secrets/users"

      new_users_list(){
        LIST=$1
        NEW_USER=$2
        if [[ -n "${LIST}" ]]; then
          LIST="${NEW_USER},${LIST}"
        else
          LIST="${NEW_USER}"
        fi

        echo "${LIST}"
      }

      process_users() {
        USERS_DIR=${1-"/etc/secrets/users"}
        USERS_FILE=$(find ${USERS_DIR}/* -print)
        USERS_LIST="kubernetes-controller"
        READ_LIST_SUCCESS=0
        # Read line by line, handle a missing EOL at the end of file
        while read p || [ -n "$p" ] ; do
          IFS=":" read -r USER_NAME PASSWORD MECHANISM <<< $p
          # Do not process empty lines
          if [ -z "$USER_NAME" ]; then
            continue
          fi
          if [[ "${USER_NAME// /}" != "$USER_NAME" ]]; then
            continue
          fi
          echo "Creating user ${USER_NAME}..."
          MECHANISM=${MECHANISM:-SCRAM-SHA-512}
          creation_result=$(rpk acl user create ${USER_NAME} -p ${PASSWORD} --mechanism ${MECHANISM} 2>&1) && creation_result_exit_code=$? || creation_result_exit_code=$?  # On a non-success exit code
          if [[ $creation_result_exit_code -ne 0 ]]; then
            # Check if the stderr contains "User already exists"
            # this error occurs when password has changed
            if [[ $creation_result == *"User already exists"* ]]; then
              echo "Update user ${USER_NAME}"
              # we will try to update by first deleting
              deletion_result=$(rpk acl user delete ${USER_NAME} 2>&1) && deletion_result_exit_code=$? || deletion_result_exit_code=$?
              if [[ $deletion_result_exit_code -ne 0 ]]; then
                echo "deletion of user ${USER_NAME} failed: ${deletion_result}"
                READ_LIST_SUCCESS=1
                break
              fi
              # Now we update the user
              update_result=$(rpk acl user create ${USER_NAME} -p ${PASSWORD} --mechanism ${MECHANISM} 2>&1) && update_result_exit_code=$? || update_result_exit_code=$?  # On a non-success exit code
              if [[ $update_result_exit_code -ne 0 ]]; then
                echo "updating user ${USER_NAME} failed: ${update_result}"
                READ_LIST_SUCCESS=1
                break
              else
                echo "Updated user ${USER_NAME}..."
                USERS_LIST=$(new_users_list "${USERS_LIST}" "${USER_NAME}")
              fi
            else
              # Another error occurred, so output the original message and exit code
              echo "error creating user ${USER_NAME}: ${creation_result}"
              READ_LIST_SUCCESS=1
              break
            fi
          # On a success, the user was created so output that
          else
            echo "Created user ${USER_NAME}..."
            USERS_LIST=$(new_users_list "${USERS_LIST}" "${USER_NAME}")
          fi
        done < $USERS_FILE

        if [[ -n "${USERS_LIST}" && ${READ_LIST_SUCCESS} ]]; then
          echo "Setting superusers configurations with users [${USERS_LIST}]"
          superuser_result=$(rpk cluster config set superusers [${USERS_LIST}] 2>&1) && superuser_result_exit_code=$? || superuser_result_exit_code=$?
          if [[ $superuser_result_exit_code -ne 0 ]]; then
              echo "Setting superusers configurations failed: ${superuser_result}"
          else
              echo "Completed setting superusers configurations"
          fi
        fi
      }

      # before we do anything ensure we have the bootstrap user
      echo "Ensuring bootstrap user ${RPK_USER}..."
      creation_result=$(rpk acl user create ${RPK_USER} -p ${RPK_PASS} --mechanism ${RPK_SASL_MECHANISM} 2>&1) && creation_result_exit_code=$? || creation_result_exit_code=$?  # On a non-success exit code
      if [[ $creation_result_exit_code -ne 0 ]]; then
        if [[ $creation_result == *"User already exists"* ]]; then
          echo "Bootstrap user already created"
        else
          echo "error creating user ${RPK_USER}: ${creation_result}"
        fi
      fi

      # first time processing
      process_users $USERS_DIR

      # subsequent changes detected here
      # watching delete_self as documented in https://ahmet.im/blog/kubernetes-inotify/
      USERS_FILE=$(find ${USERS_DIR}/* -print)
      while RES=$(inotifywait -q -e delete_self ${USERS_FILE}); do
        process_users $USERS_DIR
      done
    done
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.redpanda.dev.somecustomer.net\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.redpanda.dev.somecustomer.net\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.redpanda.dev.somecustomer.net\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.redpanda.dev.somecustomer.net\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.redpanda.dev.somecustomer.net\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}.redpanda.dev.somecustomer.net\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-bootstrap-user
  namespace: default
stringData:
  password: changeme
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    election_timeout_ms: 5000
    enable_leader_balancer: true
    enable_rack_awareness: false
    enable_sasl: true
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: true
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    partition_autobalancing_mode: continuous
    raft_heartbeat_interval_ms: 500
    storage_min_free_bytes: 5368709120
    superusers:
    - kubernetes-controller
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        authentication_method: http_basic
        name: internal
        port: 8082
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        authentication_method: sasl
        name: internal
        port: 9093
      - address: 0.0.0.0
        authentication_method: sasl
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/ssl/certs/ca-certificates.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=16384M
      - --reserve-memory=240M
      - --smp=7
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: true
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        authentication_method: http_basic
        name: internal
        port: 8081
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0.redpanda.dev.somecustomer.net:31644
      - redpanda-1.redpanda.dev.somecustomer.net:31644
      - redpanda-2.redpanda.dev.somecustomer.net:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0.redpanda.dev.somecustomer.net:31092
      - redpanda-1.redpanda.dev.somecustomer.net:31092
      - redpanda-2.redpanda.dev.somecustomer.net:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0.redpanda.dev.somecustomer.net:30081
      - redpanda-1.redpanda.dev.somecustomer.net:30081
      - redpanda-2.redpanda.dev.somecustomer.net:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    connect:
      clusters:
      - name: connectors
        password: ""
        tls:
          caFilepath: ""
          certFilepath: ""
          enabled: false
          insecureSkipTlsVerify: false
          keyFilepath: ""
        token: ""
        url: http://redpanda-connectors.default.svc.cluster.local:8083
        username: ""
      connectTimeout: 15s
      enabled: true
      readTimeout: 60s
      requestTimeout: 6s
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: true
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/connectors/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: connectors
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: connectors
    helm.sh/chart: connectors-0.1.14
  name: redpanda-connectors
spec:
  ipFamilies:
  - IPv4
  ipFamilyPolicy: SingleStack
  ports:
  - name: rest-api
    port: 8083
    protocol: TCP
    targetPort: 8083
  - name: prometheus
    port: 9404
    protocol: TCP
    targetPort: 9404
  selector:
    app.kubernetes.io/component: connectors
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: connectors
  sessionAffinity: None
  type: ClusterIP
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "true"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations:
    external-dns.alpha.kubernetes.io/hostname: redpanda-0.redpanda.dev.somecustomer.net
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    repdanda.com/type: loadbalancer
  name: lb-redpanda-0
  namespace: default
spec:
  externalTrafficPolicy: Local
  loadBalancerSourceRanges: null
  ports:
  - name: kafka-default
    port: 31092
    protocol: TCP
    targetPort: 9094
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
    statefulset.kubernetes.io/pod-name: redpanda-0
  sessionAffinity: None
  type: LoadBalancer
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations:
    external-dns.alpha.kubernetes.io/hostname: redpanda-1.redpanda.dev.somecustomer.net
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    repdanda.com/type: loadbalancer
  name: lb-redpanda-1
  namespace: default
spec:
  externalTrafficPolicy: Local
  loadBalancerSourceRanges: null
  ports:
  - name: kafka-default
    port: 31092
    protocol: TCP
    targetPort: 9094
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
    statefulset.kubernetes.io/pod-name: redpanda-1
  sessionAffinity: None
  type: LoadBalancer
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations:
    external-dns.alpha.kubernetes.io/hostname: redpanda-2.redpanda.dev.somecustomer.net
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    repdanda.com/type: loadbalancer
  name: lb-redpanda-2
  namespace: default
spec:
  externalTrafficPolicy: Local
  loadBalancerSourceRanges: null
  ports:
  - name: kafka-default
    port: 31092
    protocol: TCP
    targetPort: 9094
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
    statefulset.kubernetes.io/pod-name: redpanda-2
  sessionAffinity: None
  type: LoadBalancer
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: 2e5a61ebd58223d2dbaa08e074d30bd546a33e7a518f02d852ef4c5988b10c13
        checksum/config: 2e5a61ebd58223d2dbaa08e074d30bd546a33e7a518f02d852ef4c5988b10c13
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command:
        - sh
        - -c
        - set -e; IFS=':' read -r KAFKA_SASL_USERNAME KAFKA_SASL_PASSWORD KAFKA_SASL_MECHANISM
          < <(grep "" $(find /mnt/users/* -print)); KAFKA_SASL_MECHANISM=${KAFKA_SASL_MECHANISM:-SCRAM-SHA-512};
          export KAFKA_SASL_USERNAME KAFKA_SASL_PASSWORD KAFKA_SASL_MECHANISM; export
          KAFKA_SCHEMAREGISTRY_USERNAME=$KAFKA_SASL_USERNAME; export KAFKA_SCHEMAREGISTRY_PASSWORD=$KAFKA_SASL_PASSWORD;
          export REDPANDA_ADMINAPI_USERNAME=$KAFKA_SASL_USERNAME; export REDPANDA_ADMINAPI_PASSWORD=$KAFKA_SASL_PASSWORD;
          /app/console $@
        - ' --'
        env:
        - name: LICENSE
          valueFrom:
            secretKeyRef:
              key: license
              name: redpanda-enterprise-license
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /mnt/users
          name: redpanda-users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-users
        secret:
          secretName: kafka-credentials
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: connectors
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: connectors
    helm.sh/chart: connectors-0.1.14
  name: redpanda-connectors
spec:
  progressDeadlineSeconds: 600
  replicas: null
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app.kubernetes.io/component: connectors
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: connectors
  strategy:
    type: Recreate
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: connectors
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: connectors
    spec:
      affinity:
        nodeAffinity: {}
        podAffinity: {}
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: connectors
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: connectors
            namespaces:
            - default
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - bash
        - -c
        - set -e; IFS=':' read -r CONNECT_SASL_USERNAME CONNECT_SASL_PASSWORD CONNECT_SASL_MECHANISM
          < <(grep "" $(find /mnt/users/* -print)); CONNECT_SASL_MECHANISM=${CONNECT_SASL_MECHANISM:-SCRAM-SHA-512};
          export CONNECT_SASL_USERNAME CONNECT_SASL_PASSWORD CONNECT_SASL_MECHANISM;
          [[ $CONNECT_SASL_MECHANISM == "SCRAM-SHA-256" ]] && CONNECT_SASL_MECHANISM=scram-sha-256;
          [[ $CONNECT_SASL_MECHANISM == "SCRAM-SHA-512" ]] && CONNECT_SASL_MECHANISM=scram-sha-512;
          export CONNECT_SASL_MECHANISM; echo $CONNECT_SASL_PASSWORD > /opt/kafka/connect-password/rc-credentials/password;
          exec /opt/kafka/bin/kafka_connect_run.sh
        env:
        - name: CONNECT_CONFIGURATION
          value: |-
            rest.advertised.port=8083
            rest.port=8083
            key.converter=org.apache.kafka.connect.converters.ByteArrayConverter
            value.converter=org.apache.kafka.connect.converters.ByteArrayConverter
            group.id=connectors-cluster
            offset.storage.topic=_internal_connectors_offsets
            config.storage.topic=_internal_connectors_configs
            status.storage.topic=_internal_connectors_status
            offset.storage.redpanda.remote.read=false
            offset.storage.redpanda.remote.write=false
            config.storage.redpanda.remote.read=false
            config.storage.redpanda.remote.write=false
            status.storage.redpanda.remote.read=false
            status.storage.redpanda.remote.write=false
            offset.storage.replication.factor=-1
            config.storage.replication.factor=-1
            status.storage.replication.factor=-1
            producer.linger.ms=1
            producer.batch.size=131072
            config.providers=file,secretsManager,env
            config.providers.file.class=org.apache.kafka.common.config.provider.FileConfigProvider
            config.providers.env.class=org.apache.kafka.common.config.provider.EnvVarConfigProvider
        - name: CONNECT_ADDITIONAL_CONFIGURATION
          value: ""
        - name: CONNECT_BOOTSTRAP_SERVERS
          value: redpanda-0.redpanda.default.svc.cluster.local.:9093,redpanda-1.redpanda.default.svc.cluster.local.:9093,redpanda-2.redpanda.default.svc.cluster.local.:9093
        - name: CONNECT_GC_LOG_ENABLED
          value: "false"
        - name: CONNECT_HEAP_OPTS
          value: -Xms256M -Xmx2G
        - name: CONNECT_LOG_LEVEL
          value: warn
        - name: CONNECT_TLS_ENABLED
          value: "true"
        - name: CONNECT_TRUSTED_CERTS
          value: ca/ca.crt
        - name: CONNECT_PLUGIN_PATH
          value: /opt/kafka/connect-plugins
        - name: CONNECT_SASL_PASSWORD_FILE
          value: rc-credentials/password
        envFrom: []
        image: docker.redpanda.com/redpandadata/connectors:v1.0.31
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /
            port: rest-api
            scheme: HTTP
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: connectors-cluster
        ports:
        - containerPort: 8083
          name: rest-api
          protocol: TCP
        - containerPort: 9404
          name: prometheus
          protocol: TCP
        readinessProbe:
          failureThreshold: 2
          httpGet:
            path: /connectors
            port: rest-api
            scheme: HTTP
          initialDelaySeconds: 60
          periodSeconds: 10
          successThreshold: 3
          timeoutSeconds: 5
        resources:
          limits:
            cpu: "1"
            memory: 2350Mi
          requests:
            cpu: "1"
            memory: 2350Mi
        securityContext:
          allowPrivilegeEscalation: false
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /opt/kafka/connect-certs/ca
          name: truststore
        - mountPath: /opt/kafka/connect-plugins
          name: plugins
          readOnly: false
        - mountPath: /mnt/users
          name: redpanda-users
          readOnly: true
        - mountPath: /opt/kafka/connect-password/rc-credentials
          name: redpanda-user-password
      dnsPolicy: ClusterFirst
      imagePullSecrets: []
      nodeSelector: {}
      restartPolicy: Always
      schedulerName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
        runAsUser: 101
      serviceAccountName: default
      terminationGracePeriodSeconds: 30
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: connectors
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: connectors
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: truststore
        secret:
          defaultMode: 292
          secretName: redpanda-default-cert
      - name: plugins
        persistentVolumeClaim:
          claimName: plugins-redpanda-connectors-redpanda
      - name: redpanda-users
        secret:
          secretName: kafka-credentials
      - emptyDir: {}
        name: redpanda-user-password
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: 5cbd0fb4b580d08f9aff2db9d0f18ddecdd179d785b6e8892b220066521c5d05
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        - name: RP_BOOTSTRAP_USER
          value: $(RPK_USER):$(RPK_PASS):$(RPK_SASL_MECHANISM)
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 8082
          name: http
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: "7"
            memory: 25Gi
          requests:
            cpu: "7"
            memory: 20Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env:
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources:
          limits:
            cpu: "1"
            memory: 1Gi
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/sh
        - -c
        - chown 101:101 -R /var/lib/redpanda/data
        env: null
        image: busybox:latest
        name: set-datadir-ownership
        resources: {}
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources:
          limits:
            cpu: "1"
            memory: 1Gi
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: users
        secret:
          secretName: kafka-credentials
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 500Gi
    status: {}
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-production
    nginx.ingress.kubernetes.io/auth-realm: '"Authentication required"'
    nginx.ingress.kubernetes.io/auth-secret: ingress-basic-auth-credentials
    nginx.ingress.kubernetes.io/auth-type: basic
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
spec:
  ingressClassName: nginx
  rules:
  - host: console.redpanda.dev.somecustomer.net
    http:
      paths:
      - backend:
          service:
            name: redpanda-console
            port:
              number: 8080
        path: /
        pathType: ImplementationSpecific
  tls:
  - hosts:
    - console.redpanda.dev.somecustomer.net
    secretName: redpanda-console-production-tls
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  - redpanda.dev.somecustomer.net
  - '*.redpanda.dev.somecustomer.net'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda.dev.somecustomer.net
  - '*.redpanda.dev.somecustomer.net'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    kind: ClusterIssuer
    name: letsencrypt-production
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/connectors/templates/entry-point.yaml
apiVersion: monitoring.coreos.com/v1
kind: PodMonitor
metadata:
  annotations: {}
  creationTimestamp: null
  labels: {}
  name: redpanda-connectors
spec:
  namespaceSelector:
    any: true
  podMetricsEndpoints:
  - bearerTokenSecret:
      key: ""
    path: /
    port: prometheus
  selector:
    matchLabels:
      app.kubernetes.io/component: connectors
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: connectors
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  endpoints:
  - enableHttp2: null
    interval: 30s
    path: /public_metrics
    port: admin
    scheme: https
    tlsConfig:
      ca: {}
      cert: {}
      insecureSkipVerify: true
  namespaceSelector: {}
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      monitoring.redpanda.com/enabled: "true"
---
# Source: redpanda/charts/connectors/templates/tests/01-mm2-values.yaml
apiVersion: v1
kind: Pod
metadata:
  name: redpanda-connectors-mm2-test
  namespace: "default"
  labels:
    app.kubernetes.io/component: connectors
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: connectors
    helm.sh/chart: connectors-0.1.14
  annotations:
    "helm.sh/hook": test
    "helm.sh/hook-delete-policy": before-hook-creation
spec:
  restartPolicy: Never
  containers:
    - name: create-mm2
      image: docker.redpanda.com/redpandadata/redpanda:latest
      command:
        - /bin/bash
        - -c
        - |
          set -xe

          trap connectorsState ERR

          connectorsState () {
            echo check connectors expand status
            curl  -svm3 --fail --retry "120" --retry-max-time "120" --retry-all-errors -o - -w "\nstatus=%{http_code} %{redirect_url} size=%{size_download} time=%{time_total} content-type=\"%{content_type}\"\n"  http://redpanda-connectors:8083/connectors?expand=status
            echo check connectors expand info
            curl  -svm3 --fail --retry "120" --retry-max-time "120" --retry-all-errors -o - -w "\nstatus=%{http_code} %{redirect_url} size=%{size_download} time=%{time_total} content-type=\"%{content_type}\"\n"  http://redpanda-connectors:8083/connectors?expand=info
            echo check connector configuration
            curl  -svm3 --fail --retry "120" --retry-max-time "120" --retry-all-errors -o - -w "\nstatus=%{http_code} %{redirect_url} size=%{size_download} time=%{time_total} content-type=\"%{content_type}\"\n"  http://redpanda-connectors:8083/connectors/$CONNECTOR_NAME
            echo check connector topics
            curl  -svm3 --fail --retry "120" --retry-max-time "120" --retry-all-errors -o - -w "\nstatus=%{http_code} %{redirect_url} size=%{size_download} time=%{time_total} content-type=\"%{content_type}\"\n"  http://redpanda-connectors:8083/connectors/$CONNECTOR_NAME/topics
          }

          curl  -svm3 --fail --retry "120" --retry-max-time "120" --retry-all-errors -o - -w "\nstatus=%{http_code} %{redirect_url} size=%{size_download} time=%{time_total} content-type=\"%{content_type}\"\n"  http://redpanda-connectors:8083/connectors

          SASL_MECHANISM="PLAIN"

          rpk profile create test
          rpk profile set tls.enabled=false brokers=
          CONNECT_TLS_ENABLED=false
          SECURITY_PROTOCOL=PLAINTEXT
          if [[ -n "$CONNECT_SASL_MECHANISM" && $CONNECT_TLS_ENABLED == "true" ]]; then
            SECURITY_PROTOCOL="SASL_SSL"
          elif [[ -n "$CONNECT_SASL_MECHANISM" ]]; then
            SECURITY_PROTOCOL="SASL_PLAINTEXT"
          elif [[ $CONNECT_TLS_ENABLED == "true" ]]; then
            SECURITY_PROTOCOL="SSL"
          fi

          rpk topic list
          rpk topic create test-topic
          rpk topic list
          echo "Test message!" | rpk topic produce test-topic

          CONNECTOR_NAME=mm2-$RANDOM
          cat << 'EOF' > /tmp/mm2-conf.json
          {
            "name": "CONNECTOR_NAME",
            "config": {
              "connector.class": "org.apache.kafka.connect.mirror.MirrorSourceConnector",
              "topics": "test-topic",
              "replication.factor": "1",
              "tasks.max": "1",
              "source.cluster.bootstrap.servers": "",
              "target.cluster.bootstrap.servers": "",
              "target.cluster.alias": "test-only",
              "source.cluster.alias": "source",
              "key.converter": "org.apache.kafka.connect.converters.ByteArrayConverter",
              "value.converter": "org.apache.kafka.connect.converters.ByteArrayConverter",
              "source->target.enabled": "true",
              "target->source.enabled": "false",
              "sync.topic.configs.interval.seconds": "5",
              "sync.topics.configs.enabled": "true",
              "source.cluster.ssl.truststore.type": "PEM",
              "target.cluster.ssl.truststore.type": "PEM",
              "source.cluster.ssl.truststore.location": "/opt/kafka/connect-certs/ca/ca.crt",
              "target.cluster.ssl.truststore.location": "/opt/kafka/connect-certs/ca/ca.crt",
              JAAS_CONFIG_SOURCE
              JAAS_CONFIG_TARGET
              "source.cluster.security.protocol": "SECURITY_PROTOCOL",
              "target.cluster.security.protocol": "SECURITY_PROTOCOL",
              "source.cluster.sasl.mechanism": "SASL_MECHANISM",
              "target.cluster.sasl.mechanism": "SASL_MECHANISM",
              "offset-syncs.topic.replication.factor": 1
            }
          }
          EOF

          sed -i "s/CONNECTOR_NAME/$CONNECTOR_NAME/g" /tmp/mm2-conf.json
          sed -i "s/SASL_MECHANISM/$SASL_MECHANISM/g" /tmp/mm2-conf.json
          sed -i "s/SECURITY_PROTOCOL/$SECURITY_PROTOCOL/g" /tmp/mm2-conf.json
          set +x
          sed -i "s/JAAS_CONFIG_SOURCE/$JAAS_CONFIG_SOURCE/g" /tmp/mm2-conf.json
          sed -i "s/JAAS_CONFIG_TARGET/$JAAS_CONFIG_TARGET/g" /tmp/mm2-conf.json
          set -x

          curl  -svm3 --fail --retry "120" --retry-max-time "120" --retry-all-errors -o - -w "\nstatus=%{http_code} %{redirect_url} size=%{size_download} time=%{time_total} content-type=\"%{content_type}\"\n"  -H 'Content-Type: application/json' http://redpanda-connectors:8083/connectors -d @/tmp/mm2-conf.json

          # The rpk topic consume could fail for the first few times as kafka connect needs
          # to spawn the task and copy one message from the source topic. To solve this race condition
          # the retry should be implemented in bash for rpk topic consume or other mechanism that
          # can confirm source connectors started its execution. As a fast fix fixed 30 second fix is added.
          sleep 30

          rpk topic consume source.test-topic -n 1 | grep "Test message!"

          curl  -svm3 --fail --retry "120" --retry-max-time "120" --retry-all-errors -o - -w "\nstatus=%{http_code} %{redirect_url} size=%{size_download} time=%{time_total} content-type=\"%{content_type}\"\n"  -X DELETE http://redpanda-connectors:8083/connectors/$CONNECTOR_NAME

          curl  -svm3 --fail --retry "120" --retry-max-time "120" --retry-all-errors -o - -w "\nstatus=%{http_code} %{redirect_url} size=%{size_download} time=%{time_total} content-type=\"%{content_type}\"\n"  http://redpanda-connectors:8083/connectors

          rpk topic delete test-topic source.test-topic mm2-offset-syncs.test-only.internal
      volumeMounts:
        - mountPath: /opt/kafka/connect-plugins
          name: plugins
          readOnly: false
  volumes:
    - name: plugins
      persistentVolumeClaim:
        claimName: plugins-redpanda-connectors-redpanda
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          valueFrom:
            secretKeyRef:
              key: license
              name: redpanda-enterprise-license
        - name: RPK_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: redpanda-bootstrap-user
        - name: RPK_USER
          value: kubernetes-controller
        - name: RPK_SASL_MECHANISM
          value: SCRAM-SHA-256
        - name: RP_BOOTSTRAP_USER
          value: $(RPK_USER):$(RPK_PASS):$(RPK_SASL_MECHANISM)
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/secrets/users
          name: users
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: users
        secret:
          secretName: kafka-credentials
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/somecustomrepo-v23.2.8-0.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_batch_max_bytes: 7777
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 99999
    log_segment_size_min: 100
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: somecustomrepo:v23.2.8
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: somecustomrepo:v23.2.8
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: somecustomrepo:v23.2.8
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: somecustomrepo:v23.2.8
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/somecustomrepo-v23.2.8-1.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
stringData:
  enterprise-license: ATOTALLYVALIDLICENSE
  kafka-protobuf-git-basicauth-password: ""
  kafka-sasl-aws-msk-iam-secret-key: ""
  kafka-sasl-password: ""
  kafka-schema-registry-password: ""
  kafka-schemaregistry-tls-ca: ""
  kafka-schemaregistry-tls-cert: ""
  kafka-schemaregistry-tls-key: ""
  kafka-tls-ca: ""
  kafka-tls-cert: ""
  kafka-tls-key: ""
  login-github-oauth-client-secret: ""
  login-github-personal-access-token: ""
  login-google-groups-service-account.json: ""
  login-google-oauth-client-secret: ""
  login-jwt-secret: SECRETKEY
  login-oidc-client-secret: ""
  login-okta-client-secret: ""
  login-okta-directory-api-token: ""
  redpanda-admin-api-password: ""
  redpanda-admin-api-tls-ca: ""
  redpanda-admin-api-tls-cert: ""
  redpanda-admin-api-tls-key: ""
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env:
        - name: LOGIN_JWTSECRET
          valueFrom:
            secretKeyRef:
              key: login-jwt-secret
              name: redpanda-console
        - name: LICENSE
          valueFrom:
            secretKeyRef:
              key: enterprise-license
              name: redpanda-console
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/console/secrets
          name: secrets
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: secrets
        secret:
          secretName: redpanda-console
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: somecustomrepo:v23.2.8
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: somecustomrepo:v23.2.8
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: somecustomrepo:v23.2.8
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: somecustomrepo:v23.2.8
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          value: ATOTALLYVALIDLICENSE
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/somecustomrepo-v23.2.8-2.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"

    # Configure Rack Awareness
    set +x
    RACK=$(curl --silent --cacert /run/secrets/kubernetes.io/serviceaccount/ca.crt --fail -H 'Authorization: Bearer '$(cat /run/secrets/kubernetes.io/serviceaccount/token) "https://${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT_HTTPS}/api/v1/nodes/${KUBERNETES_NODE_NAME}?pretty=true" | grep '"topology-label"' | grep -v '\"key\":' | sed 's/.*": "\([^"]\+\).*/\1/')
    set -x
    rpk --config "$CONFIG" redpanda config set redpanda.rack "${RACK}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: true
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: somecustomrepo:v23.2.8
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: somecustomrepo:v23.2.8
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: somecustomrepo:v23.2.8
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: somecustomrepo:v23.2.8
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
          name: kube-api-access
          readOnly: true
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
      - name: kube-api-access
        projected:
          defaultMode: 420
          sources:
          - serviceAccountToken:
              expirationSeconds: 3607
              path: token
          - configMap:
              items:
              - key: ca.crt
                path: ca.crt
              name: kube-root-ca.crt
          - downwardAPI:
              items:
              - fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.namespace
                path: namespace
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/somecustomrepo-v24.1.0-0.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_batch_max_bytes: 7777
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 99999
    log_segment_size_min: 100
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: somecustomrepo:v24.1.0
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: somecustomrepo:v24.1.0
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: somecustomrepo:v24.1.0
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: somecustomrepo:v24.1.0
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/somecustomrepo-v24.1.0-1.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
stringData:
  enterprise-license: ATOTALLYVALIDLICENSE
  kafka-protobuf-git-basicauth-password: ""
  kafka-sasl-aws-msk-iam-secret-key: ""
  kafka-sasl-password: ""
  kafka-schema-registry-password: ""
  kafka-schemaregistry-tls-ca: ""
  kafka-schemaregistry-tls-cert: ""
  kafka-schemaregistry-tls-key: ""
  kafka-tls-ca: ""
  kafka-tls-cert: ""
  kafka-tls-key: ""
  login-github-oauth-client-secret: ""
  login-github-personal-access-token: ""
  login-google-groups-service-account.json: ""
  login-google-oauth-client-secret: ""
  login-jwt-secret: SECRETKEY
  login-oidc-client-secret: ""
  login-okta-client-secret: ""
  login-okta-directory-api-token: ""
  redpanda-admin-api-password: ""
  redpanda-admin-api-tls-ca: ""
  redpanda-admin-api-tls-cert: ""
  redpanda-admin-api-tls-key: ""
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env:
        - name: LOGIN_JWTSECRET
          valueFrom:
            secretKeyRef:
              key: login-jwt-secret
              name: redpanda-console
        - name: LICENSE
          valueFrom:
            secretKeyRef:
              key: enterprise-license
              name: redpanda-console
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/console/secrets
          name: secrets
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: secrets
        secret:
          secretName: redpanda-console
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: somecustomrepo:v24.1.0
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: somecustomrepo:v24.1.0
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: somecustomrepo:v24.1.0
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: somecustomrepo:v24.1.0
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env:
        - name: REDPANDA_LICENSE
          value: ATOTALLYVALIDLICENSE
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/somecustomrepo-v24.1.0-2.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"

    # Configure Rack Awareness
    set +x
    RACK=$(curl --silent --cacert /run/secrets/kubernetes.io/serviceaccount/ca.crt --fail -H 'Authorization: Bearer '$(cat /run/secrets/kubernetes.io/serviceaccount/token) "https://${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT_HTTPS}/api/v1/nodes/${KUBERNETES_NODE_NAME}?pretty=true" | grep '"topology-label"' | grep -v '\"key\":' | sed 's/.*": "\([^"]\+\).*/\1/')
    set -x
    rpk --config "$CONFIG" redpanda config set redpanda.rack "${RACK}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: true
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: somecustomrepo:v24.1.0
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: somecustomrepo:v24.1.0
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: somecustomrepo:v24.1.0
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: somecustomrepo:v24.1.0
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
          name: kube-api-access
          readOnly: true
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
      - name: kube-api-access
        projected:
          defaultMode: 420
          sources:
          - serviceAccountToken:
              expirationSeconds: 3607
              path: token
          - configMap:
              items:
              - key: ca.crt
                path: ca.crt
              name: kube-root-ca.crt
          - downwardAPI:
              items:
              - fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.namespace
                path: namespace
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/template-console-examples.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
  role-bindings.yaml: |-
    roleBindings:
    - metadata:
        creator: John Doe
        name: Developers
      roleName: admin
      subjects:
      - kind: 'USERUSER'
        name: john.doe@redpanda.com
        provider: Google
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: 3007625e3139d9dda2c9c0eda193ef8a62313a6ed6f5fda29a5f4f8e867b6d80
        checksum/config: 3007625e3139d9dda2c9c0eda193ef8a62313a6ed6f5fda29a5f4f8e867b6d80
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers:
      - args:
        - echo "Hello World! Hello World! "
        command:
        - /bin/bash
        - -c
        image: mintel/docker-alpine-bash-curl-jq:latest
        name: test-init-container
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
spec:
  ingressClassName: null
  rules:
  - host: redpanda-console-first-rule-host
    http:
      paths: null
  - host: redpanda-console-second-rule-host
    http:
      paths: null
  tls:
  - hosts:
    - redpanda-console-tls-first-host
    - redpanda-console-tls-second-host
    secretName: test
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
-- testdata/TestTemplate/trust-stores-ca-enabled.yaml.golden --
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
      redpanda.com/poddisruptionbudget: redpanda
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
automountServiceAccountToken: false
kind: ServiceAccount
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-sts-lifecycle
  namespace: default
stringData:
  common.sh: |-
    #!/usr/bin/env bash

    # the SERVICE_NAME comes from the metadata.name of the pod, essentially the POD_NAME
    CURL_URL="https://${SERVICE_NAME}.redpanda.default.svc.cluster.local:9644"

    # commands used throughout
    CURL_NODE_ID_CMD="curl --silent --fail --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/node_config"

    CURL_MAINTENANCE_DELETE_CMD_PREFIX='curl -X DELETE --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_PUT_CMD_PREFIX='curl -X PUT --silent -o /dev/null -w "%{http_code}"'
    CURL_MAINTENANCE_GET_CMD="curl -X GET --silent --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/maintenance"
  postStart.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    postStartHook () {
      set -x

      touch /tmp/postStartHookStarted

      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Clearing maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_DELETE_CMD="${CURL_MAINTENANCE_DELETE_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      # a 400 here would mean not in maintenance mode
      until [ "${status:-}" = '"200"' ] || [ "${status:-}" = '"400"' ]; do
          status=$(${CURL_MAINTENANCE_DELETE_CMD})
          sleep 0.5
      done

      touch /tmp/postStartHookFinished
    }

    postStartHook
    true
  preStop.sh: |-
    #!/usr/bin/env bash
    # This code should be similar if not exactly the same as that found in the panda-operator, see
    # https://github.com/redpanda-data/redpanda/blob/e51d5b7f2ef76d5160ca01b8c7a8cf07593d29b6/src/go/k8s/pkg/resources/secret.go

    touch /tmp/preStopHookStarted

    # path below should match the path defined on the statefulset
    source /var/lifecycle/common.sh

    set -x

    preStopHook () {
      until NODE_ID=$(${CURL_NODE_ID_CMD} | grep -o '\"node_id\":[^,}]*' | grep -o '[^: ]*$'); do
          sleep 0.5
      done

      echo "Setting maintenance mode on node ${NODE_ID}"
      CURL_MAINTENANCE_PUT_CMD="${CURL_MAINTENANCE_PUT_CMD_PREFIX} --cacert /etc/tls/certs/default/ca.crt ${CURL_URL}/v1/brokers/${NODE_ID}/maintenance"
      until [ "${status:-}" = '"200"' ]; do
          status=$(${CURL_MAINTENANCE_PUT_CMD})
          sleep 0.5
      done

      until [ "${finished:-}" = "true" ] || [ "${draining:-}" = "false" ]; do
          res=$(${CURL_MAINTENANCE_GET_CMD})
          finished=$(echo $res | grep -o '\"finished\":[^,}]*' | grep -o '[^: ]*$')
          draining=$(echo $res | grep -o '\"draining\":[^,}]*' | grep -o '[^: ]*$')
          sleep 0.5
      done

      touch /tmp/preStopHookFinished
    }
    preStopHook
    true
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-config-watcher
  namespace: default
stringData:
  sasl-user.sh: |-
    #!/usr/bin/env bash

    trap 'error_handler $? $LINENO' ERR

    error_handler() {
      echo "Error: ($1) occurred at line $2"
    }

    set -e

    # rpk cluster health can exit non-zero if it's unable to dial brokers. This
    # can happen for many reasons but we never want this script to crash as it
    # would take down yet another broker and make a bad situation worse.
    # Instead, just wait for the command to eventually exit zero.
    echo "Waiting for cluster to be ready"
    until rpk cluster health --watch --exit-when-healthy; do
      echo "rpk cluster health failed. Waiting 5 seconds before trying again..."
      sleep 5
    done
    echo "Nothing to do. Sleeping..."
    sleep infinity
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Secret
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configurator
  namespace: default
stringData:
  configurator.sh: |-
    set -xe
    SERVICE_NAME=$1
    KUBERNETES_NODE_NAME=$2
    POD_ORDINAL=${SERVICE_NAME##*-}
    BROKER_INDEX=`expr $POD_ORDINAL + 1`

    CONFIG=/etc/redpanda/redpanda.yaml

    # Setup config files
    cp /tmp/base-config/redpanda.yaml "${CONFIG}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":9093}"
    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[0] "$LISTENER"

    ADVERTISED_KAFKA_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    PREFIX_TEMPLATE=""
    ADVERTISED_KAFKA_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":31092}")

    rpk redpanda config --config "$CONFIG" set redpanda.advertised_kafka_api[1] "${ADVERTISED_KAFKA_ADDRESSES[$POD_ORDINAL]}"

    LISTENER="{\"address\":\"${SERVICE_NAME}.redpanda.default.svc.cluster.local.\",\"name\":\"internal\",\"port\":8082}"
    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[0] "$LISTENER"

    ADVERTISED_HTTP_ADDRESSES=()

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    PREFIX_TEMPLATE=""
    ADVERTISED_HTTP_ADDRESSES+=("{\"address\":\"${SERVICE_NAME}\",\"name\":\"default\",\"port\":30082}")

    rpk redpanda config --config "$CONFIG" set pandaproxy.advertised_pandaproxy_api[1] "${ADVERTISED_HTTP_ADDRESSES[$POD_ORDINAL]}"
type: Opaque
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  bootstrap.yaml: |-
    audit_enabled: false
    cloud_storage_cache_size: 5368709120
    cloud_storage_enable_remote_read: true
    cloud_storage_enable_remote_write: true
    cloud_storage_enabled: false
    compacted_log_segment_size: 67108864
    default_topic_replications: 3
    enable_rack_awareness: false
    enable_sasl: false
    kafka_connection_rate_limit: 1000
    kafka_enable_authorization: false
    log_segment_size_max: 268435456
    log_segment_size_min: 16777216
    max_compacted_log_segment_size: 536870912
    storage_min_free_bytes: 1073741824
  redpanda.yaml: |-
    config_file: /etc/redpanda/redpanda.yaml
    pandaproxy:
      pandaproxy_api:
      - address: 0.0.0.0
        name: internal
        port: 8082
      - address: 0.0.0.0
        name: default
        port: 8083
      pandaproxy_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    pandaproxy_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
    redpanda:
      admin:
      - address: 0.0.0.0
        name: internal
        port: 9644
      - address: 0.0.0.0
        name: default
        port: 9645
      admin_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      crash_loop_limit: 5
      empty_seed_starts_cluster: false
      kafka_api:
      - address: 0.0.0.0
        name: internal
        port: 9093
      - address: 0.0.0.0
        name: default
        port: 9094
      kafka_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
      rpc_server:
        address: 0.0.0.0
        port: 33145
      rpc_server_tls:
        cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      seed_servers:
      - host:
          address: redpanda-0.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-1.redpanda.default.svc.cluster.local.
          port: 33145
      - host:
          address: redpanda-2.redpanda.default.svc.cluster.local.
          port: 33145
    rpk:
      additional_start_flags:
      - --default-log-level=info
      - --memory=2048M
      - --reserve-memory=205M
      - --smp=1
      admin_api:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:9644
        - redpanda-1.redpanda.default.svc.cluster.local.:9644
        - redpanda-2.redpanda.default.svc.cluster.local.:9644
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      enable_memory_locking: false
      kafka_api:
        brokers:
        - redpanda-0.redpanda.default.svc.cluster.local.:9093
        - redpanda-1.redpanda.default.svc.cluster.local.:9093
        - redpanda-2.redpanda.default.svc.cluster.local.:9093
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      overprovisioned: false
      schema_registry:
        addresses:
        - redpanda-0.redpanda.default.svc.cluster.local.:8081
        - redpanda-1.redpanda.default.svc.cluster.local.:8081
        - redpanda-2.redpanda.default.svc.cluster.local.:8081
        tls:
          ca_file: /etc/tls/certs/default/ca.crt
      tune_aio_events: true
    schema_registry:
      schema_registry_api:
      - address: 0.0.0.0
        name: internal
        port: 8081
      - address: 0.0.0.0
        name: default
        port: 8084
      schema_registry_api_tls:
      - cert_file: /etc/tls/certs/default/tls.crt
        enabled: true
        key_file: /etc/tls/certs/default/tls.key
        name: internal
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      - cert_file: /etc/tls/certs/external/tls.crt
        enabled: true
        key_file: /etc/tls/certs/external/tls.key
        name: default
        require_client_auth: false
        truststore_file: /etc/tls/certs/external/ca.crt
    schema_registry_client:
      broker_tls:
        enabled: true
        require_client_auth: false
        truststore_file: /etc/tls/certs/default/ca.crt
      brokers:
      - address: redpanda-0.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-1.redpanda.default.svc.cluster.local.
        port: 9093
      - address: redpanda-2.redpanda.default.svc.cluster.local.
        port: 9093
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  profile: |-
    admin_api:
      addresses:
      - redpanda-0:31644
      - redpanda-1:31644
      - redpanda-2:31644
      tls:
        ca_file: ca.crt
    kafka_api:
      brokers:
      - redpanda-0:31092
      - redpanda-1:31092
      - redpanda-2:31092
      tls:
        ca_file: ca.crt
    name: default
    schema_registry:
      addresses:
      - redpanda-0:30081
      - redpanda-1:30081
      - redpanda-2:30081
      tls:
        ca_file: ca.crt
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-rpk
  namespace: default
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
data:
  config.yaml: |
    # from .Values.console.config
    kafka:
      brokers:
      - redpanda-0.redpanda.default.svc.cluster.local.:9093
      - redpanda-1.redpanda.default.svc.cluster.local.:9093
      - redpanda-2.redpanda.default.svc.cluster.local.:9093
      sasl:
        enabled: false
      schemaRegistry:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda-0.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-1.redpanda.default.svc.cluster.local.:8081
        - https://redpanda-2.redpanda.default.svc.cluster.local.:8081
      tls:
        caFilepath: /etc/tls/certs/default/ca.crt
        certFilepath: ""
        enabled: true
        insecureSkipTlsVerify: false
        keyFilepath: ""
    redpanda:
      adminApi:
        enabled: true
        tls:
          caFilepath: /etc/tls/certs/default/ca.crt
          certFilepath: ""
          enabled: true
          insecureSkipTlsVerify: false
          keyFilepath: ""
        urls:
        - https://redpanda.default.svc.cluster.local.:9644
kind: ConfigMap
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
---
# Source: redpanda/charts/console/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  ports:
  - name: http
    port: 8080
    protocol: TCP
    targetPort: 0
  selector:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: console
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external
  namespace: default
spec:
  externalTrafficPolicy: Local
  ports:
  - name: admin-default
    nodePort: 31644
    port: 9645
    protocol: TCP
    targetPort: 0
  - name: kafka-default
    nodePort: 31092
    port: 9094
    protocol: TCP
    targetPort: 0
  - name: http-default
    nodePort: 30082
    port: 8083
    protocol: TCP
    targetPort: 0
  - name: schema-default
    nodePort: 30081
    port: 8084
    protocol: TCP
    targetPort: 0
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  sessionAffinity: None
  type: NodePort
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: v1
kind: Service
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
    monitoring.redpanda.com/enabled: "false"
  name: redpanda
  namespace: default
spec:
  clusterIP: None
  ports:
  - appProtocol: null
    name: admin
    port: 9644
    protocol: TCP
    targetPort: 9644
  - name: http
    port: 8082
    protocol: TCP
    targetPort: 8082
  - name: kafka
    port: 9093
    protocol: TCP
    targetPort: 9093
  - name: rpc
    port: 33145
    protocol: TCP
    targetPort: 33145
  - name: schemaregistry
    port: 8081
    protocol: TCP
    targetPort: 8081
  publishNotReadyAddresses: true
  selector:
    app.kubernetes.io/component: redpanda-statefulset
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/name: redpanda
  type: ClusterIP
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations: {}
  creationTimestamp: null
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  name: redpanda-console
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: console
  strategy: {}
  template:
    metadata:
      annotations:
        checksum-redpanda-chart/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
        checksum/config: fe98669030bb7281f6ae4f27a63ae8e758f50359502f97c00d5b34d60dceba5f
      creationTimestamp: null
      labels:
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: console
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - args:
        - --config.filepath=/etc/console/configs/config.yaml
        command: null
        env: []
        envFrom: []
        image: docker.redpanda.com/redpandadata/console:v2.8.0
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: console
        ports:
        - containerPort: 8080
          name: http
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /admin/health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext:
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /etc/console/configs
          name: configs
          readOnly: true
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
      imagePullSecrets: []
      initContainers: null
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 99
        runAsUser: 99
      serviceAccountName: redpanda-console
      tolerations: []
      topologySpreadConstraints: []
      volumes:
      - configMap:
          name: redpanda-console
        name: configs
      - name: redpanda-default-cert
        secret:
          defaultMode: 272
          secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda
  namespace: default
spec:
  podManagementPolicy: Parallel
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/component: redpanda-statefulset
      app.kubernetes.io/instance: redpanda
      app.kubernetes.io/name: redpanda
  serviceName: redpanda
  template:
    metadata:
      annotations:
        config.redpanda.com/checksum: b689e1074337a6b597b8b9725e277cec5fd5a95b3031e546d96640232ca30ca3
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda-statefulset
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: redpanda
        helm.sh/chart: redpanda-5.9.18
        redpanda.com/poddisruptionbudget: redpanda
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: redpanda-statefulset
                app.kubernetes.io/instance: redpanda
                app.kubernetes.io/name: redpanda
            topologyKey: kubernetes.io/hostname
      automountServiceAccountToken: false
      containers:
      - command:
        - rpk
        - redpanda
        - start
        - --advertise-rpc-addr=$(SERVICE_NAME).redpanda.default.svc.cluster.local.:33145
        env:
        - name: SERVICE_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        lifecycle:
          postStart:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/postStart.sh 2>&1 | sed "s/^/lifecycle-hook
                post-start $(date): /" | tee /proc/1/fd/1; true'
          preStop:
            exec:
              command:
              - bash
              - -c
              - 'timeout -v 45 bash -x /var/lifecycle/preStop.sh 2>&1 | sed "s/^/lifecycle-hook
                pre-stop $(date): /" | tee /proc/1/fd/1; true'
        livenessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt
              "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready"
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
        name: redpanda
        ports:
        - containerPort: 9644
          name: admin
        - containerPort: 9645
          name: admin-default
        - containerPort: 8082
          name: http
        - containerPort: 8083
          name: http-default
        - containerPort: 9093
          name: kafka
        - containerPort: 9094
          name: kafka-default
        - containerPort: 33145
          name: rpc
        - containerPort: 8081
          name: schemaregistry
        - containerPort: 8084
          name: schema-default
        readinessProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -x
              RESULT=$(rpk cluster health)
              echo $RESULT
              echo $RESULT | grep 'Healthy:.*true'
          failureThreshold: 3
          initialDelaySeconds: 1
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 0
        resources:
          limits:
            cpu: 1
            memory: 2.5Gi
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        startupProbe:
          exec:
            command:
            - /bin/sh
            - -c
            - |
              set -e
              RESULT=$(curl --silent --fail -k -m 5 --cacert /etc/tls/certs/default/ca.crt "https://${SERVICE_NAME}.redpanda.default.svc.cluster.local.:9644/v1/status/ready")
              echo $RESULT
              echo $RESULT | grep ready
          failureThreshold: 120
          initialDelaySeconds: 1
          periodSeconds: 10
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /var/lifecycle
          name: lifecycle-scripts
        - mountPath: /var/lib/redpanda/data
          name: datadir
      - args:
        - -c
        - trap "exit 0" TERM; exec /etc/secrets/config-watcher/scripts/sasl-user.sh
          & wait $!
        command:
        - /bin/sh
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: config-watcher
        resources: {}
        securityContext: {}
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /etc/secrets/config-watcher/scripts
          name: redpanda-config-watcher
      initContainers:
      - command:
        - /bin/bash
        - -c
        - rpk redpanda tune all
        env: null
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: tuning
        resources: {}
        securityContext:
          capabilities:
            add:
            - SYS_RESOURCE
          privileged: true
          runAsGroup: 0
          runAsUser: 0
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: base-config
      - command:
        - /bin/bash
        - -c
        - trap "exit 0" TERM; exec $CONFIGURATOR_SCRIPT "${SERVICE_NAME}" "${KUBERNETES_NODE_NAME}"
          & wait $!
        env:
        - name: CONFIGURATOR_SCRIPT
          value: /etc/secrets/configurator/scripts/configurator.sh
        - name: SERVICE_NAME
          valueFrom:
            configMapKeyRef: null
            fieldRef:
              fieldPath: metadata.name
            resourceFieldRef: null
            secretKeyRef: null
        - name: KUBERNETES_NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        - name: HOST_IP_ADDRESS
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
        image: docker.redpanda.com/redpandadata/redpanda:v24.3.2
        name: redpanda-configurator
        resources: {}
        securityContext:
          allowPrivilegeEscalation: null
          runAsGroup: 101
          runAsNonRoot: null
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /etc/redpanda
          name: config
        - mountPath: /tmp/base-config
          name: base-config
        - mountPath: /etc/secrets/configurator/scripts/
          name: redpanda-configurator
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      priorityClassName: ""
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      terminationGracePeriodSeconds: 90
      tolerations: []
      topologySpreadConstraints:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: redpanda-statefulset
            app.kubernetes.io/instance: redpanda
            app.kubernetes.io/name: redpanda
        maxSkew: 1
        topologyKey: topology.kubernetes.io/zone
        whenUnsatisfiable: ScheduleAnyway
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - name: lifecycle-scripts
        secret:
          defaultMode: 509
          secretName: redpanda-sts-lifecycle
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
      - name: redpanda-configurator
        secret:
          defaultMode: 509
          secretName: redpanda-configurator
      - name: redpanda-config-watcher
        secret:
          defaultMode: 509
          secretName: redpanda-config-watcher
      - name: datadir
        persistentVolumeClaim:
          claimName: datadir
  updateStrategy:
    type: RollingUpdate
  volumeClaimTemplates:
  - metadata:
      annotations: null
      creationTimestamp: null
      labels:
        app.kubernetes.io/component: redpanda
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
      name: datadir
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 20Gi
    status: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-certificate
  namespace: default
spec:
  commonName: redpanda-default-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-certificate
  namespace: default
spec:
  commonName: redpanda-external-root-certificate
  duration: 43800h0m0s
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-selfsigned-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-default-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-default-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-cert
  namespace: default
spec:
  dnsNames:
  - redpanda-cluster.redpanda.default.svc.cluster.local
  - redpanda-cluster.redpanda.default.svc
  - redpanda-cluster.redpanda.default
  - '*.redpanda-cluster.redpanda.default.svc.cluster.local'
  - '*.redpanda-cluster.redpanda.default.svc'
  - '*.redpanda-cluster.redpanda.default'
  - redpanda.default.svc.cluster.local
  - redpanda.default.svc
  - redpanda.default
  - '*.redpanda.default.svc.cluster.local'
  - '*.redpanda.default.svc'
  - '*.redpanda.default'
  duration: 43800h0m0s
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: redpanda-external-root-issuer
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: redpanda-external-cert
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-default-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-default-root-certificate
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-selfsigned-issuer
  namespace: default
spec:
  selfSigned: {}
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-external-root-issuer
  namespace: default
spec:
  ca:
    secretName: redpanda-external-root-certificate
---
# Source: redpanda/charts/console/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "redpanda-console-test-connection"
  namespace: "default"
  labels:
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: console
    app.kubernetes.io/version: v2.8.0
    helm.sh/chart: console-0.7.31
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['redpanda-console:8080']
  restartPolicy: Never
  priorityClassName:
---
# Source: redpanda/templates/entry-point.yaml
apiVersion: batch/v1
kind: Job
metadata:
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation
    helm.sh/hook-weight: "-5"
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: redpanda
    app.kubernetes.io/instance: redpanda
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: redpanda
    helm.sh/chart: redpanda-5.9.18
  name: redpanda-configuration
  namespace: default
spec:
  template:
    metadata:
      annotations: {}
      creationTimestamp: null
      generateName: redpanda-post-
      labels:
        app.kubernetes.io/component: redpanda-post-install
        app.kubernetes.io/instance: redpanda
        app.kubernetes.io/name: redpanda
    spec:
      affinity: {}
      automountServiceAccountToken: false
      containers:
      - command:
        - /redpanda-operator
        - sync-cluster-config
        - --users-directory
        - /etc/secrets/users
        - --redpanda-yaml
        - /tmp/base-config/redpanda.yaml
        - --bootstrap-yaml
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: post-install
        resources: {}
        securityContext:
          runAsGroup: 101
          runAsUser: 101
        volumeMounts:
        - mountPath: /etc/tls/certs/default
          name: redpanda-default-cert
        - mountPath: /etc/tls/certs/external
          name: redpanda-external-cert
        - mountPath: /tmp/config
          name: config
        - mountPath: /tmp/base-config
          name: base-config
      initContainers:
      - command:
        - /redpanda-operator
        - envsubst
        - /tmp/base-config/bootstrap.yaml
        - --output
        - /tmp/config/.bootstrap.yaml
        env: null
        image: docker.redpanda.com/redpandadata/redpanda-operator:v2.3.5-24.3.2
        name: bootstrap-yaml-envsubst
        resources:
          limits:
            cpu: 100m
            memory: 125Mi
          requests:
            cpu: 100m
            memory: 125Mi
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          runAsNonRoot: true
        volumeMounts:
        - mountPath: /tmp/config/
          name: config
        - mountPath: /tmp/base-config/
          name: base-config
      nodeSelector: {}
      restartPolicy: Never
      securityContext:
        fsGroup: 101
        fsGroupChangePolicy: OnRootMismatch
      serviceAccountName: default
      tolerations: []
      volumes:
      - name: redpanda-default-cert
        secret:
          defaultMode: 288
          secretName: redpanda-default-cert
      - name: redpanda-external-cert
        secret:
          defaultMode: 288
          secretName: redpanda-external-cert
      - configMap:
          name: redpanda
        name: base-config
      - emptyDir: {}
        name: config
